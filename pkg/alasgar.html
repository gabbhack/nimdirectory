<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">alasgar</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">game</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">engine</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">3d</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">graphics</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">gles</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">opengl</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("Game Engine")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install alasgar" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><p>  <img src="docs/files/screen-size.gif" style="max-width: 100%;" alt="" /></p>
<h1>alasgar</h1>
<p>alasgar is a pure nim game engine based on OpenGL. The main reason to start developing a new game engine, was to learn graphics programming (first challenge) using nim programming language (second challenge). You can write the whole game logic and also shaders in nim. It supports a few platforms including mobile, web, and desktop. It performs well in the performance tests. It is the journey of a backend/system developer through graphics/game programming.</p>
<h1>Platforms</h1>
<ul>
<li>Linux</li>
<li>Windows</li>
<li>Android</li>
<li>WebAssembly</li>
<li>Mac (work in progress)</li>
<li>iOS (not supoorted)</li>
</ul>
<h2>Experimental game engine</h2>
<p>alasgar is a basic game engine, and it is limited, so it is not ready for production use.</p>
<h2>nimx and vmath</h2>
<p>Most of nimx build system has been copied here, just removed and reformed some parts. This part will be rewritten later to use nimble instead of nake. nimx is a UI library (and game framework) for nim, check it out <a href="https://github.com/yglukhov/nimx">here</a>.</p>
<p>For game mathematics, vmath is used. vmath has a good convention, check it out for more information <a href="https://github.com/treeform/vmath">here</a>.</p>
<h2>Installation</h2>
<pre>  <code class="language-bash">nimble install alasgar
</code></pre>
<p>or simply the latest version:</p>
<pre>  <code class="language-bash">nimble install https://github.com/abisxir/alasgar
</code></pre>
<h2>Quick start</h2>
<pre>  <code class="language-bash">git clone https://github.com/abisxir/alasgar.git
cd alasgar/examples
nim c -r hello.nim
</code></pre>
<h1>Table of Contents</h1>
<ul>
<li>  <a href="#window-and-scene-creation">Window and scene creation</a></li>
<li>  <a href="#background">Change background color</a></li>
<li>  <a href="#first-mesh">First mesh</a></li>
<li>  <a href="#point-light">Point light</a></li>
<li>  <a href="#scripts">Scripts</a></li>
<li>  <a href="#rotation">Rotation and transform</a></li>
<li>  <a href="#material">Material</a></li>
<li>  <a href="#texture">Texture</a></li>
<li>  <a href="#more-lights">More lights</a></li>
<li>  <a href="#access-components">Access components</a></li>
<li>  <a href="#screen-size">Screen size</a></li>
<li>  <a href="#environment-variables">Environment variables</a></li>
<li>  <a href="#normal-maps">Normal maps</a></li>
<li>  <a href="#interactive-objects">Interactive objects</a></li>
<li>  <a href="#shadows">Shadows</a></li>
<li>  <a href="#effects">Effects</a></li>
<li>  <a href="#custom-effects">Custom effects</a></li>
<li>  <a href="#shaders">Shaders</a></li>
</ul>
<h1>Window and scene creation</h1>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">alasgar</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates a window named Hello</span></div></div><div class="line"><div class="line-content"><span class="ide">window</span>(<span class="str">&quot;Hello&quot;</span>, <span class="num">960</span>, <span class="num">540</span>)</div></div><div class="line"><div class="line-content">   </div></div><div class="line"><div class="line-content"><span class="com"># Creates a new scene</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">scene</span> <span class="op">=</span> <span class="ide">newScene</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates camera entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">cameraEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Camera&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets camera position</span></div></div><div class="line"><div class="line-content"><span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">5</span>, <span class="num">5</span>, <span class="num">5</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a perspective camera component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newPerspectiveCamera</span>(</div></div><div class="line"><div class="line-content">        <span class="num">75</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">runtime</span><span class="op">.</span><span class="ide">ratio</span>, </div></div><div class="line"><div class="line-content">        <span class="num">0.1</span>, </div></div><div class="line"><div class="line-content">        <span class="num">100.0</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">vec3</span>(<span class="num">0</span>) <span class="op">-</span> <span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the camera entity child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cameraEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Renders an empty sceene</span></div></div><div class="line"><div class="line-content"><span class="ide">render</span>(<span class="ide">scene</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Runs game main loop</span></div></div><div class="line"><div class="line-content"><span class="ide">loop</span>()</div></div>  </code></pre>
<p>As you see, we instantiate a scene, add a camera to that, and render the created scene. If everything goes right, you will see an empty window with the given size. Run it using the nim compiler:</p>
<pre>  <code class="language-bash">nim c -r main.nim
</code></pre>
<p>Check the <a href="https://abisxir.github.io/alasgar/step1/build">example</a> here.</p>
<p>When you create a window by defult it runs in window mode, you can easily enable fullscreen mode:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># Creates a window named Hello and enables fullscreen mode.</span></div></div><div class="line"><div class="line-content"><span class="ide">window</span>(<span class="str">&quot;Hello&quot;</span>, <span class="num">960</span>, <span class="num">540</span>, <span class="ide">fullscreen</span><span class="op">=</span><span class="ide">true</span>)</div></div>  </code></pre>
<p>Let us add a cube to our scene, but to see the cube, it is better if we give a brighter background to our window, it will make it easier to see our meshes before we add lights. To set the background color, we need to introduce the environment component:</p>
<h1>Background</h1>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> </div></div><div class="line"><div class="line-content">    <span class="com"># Creates a new scene</span></div></div><div class="line"><div class="line-content">    <span class="ide">scene</span> <span class="op">=</span> <span class="ide">newScene</span>()</div></div><div class="line"><div class="line-content">    <span class="com"># Creates an environment component</span></div></div><div class="line"><div class="line-content">    <span class="ide">env</span> <span class="op">=</span> <span class="ide">newEnvironmentComponent</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Sets background color</span></div></div><div class="line"><div class="line-content"><span class="ide">setBackground</span>(<span class="ide">env</span>, <span class="ide">parseHex</span>(<span class="str">&quot;d7d1bf&quot;</span>))</div></div><div class="line"><div class="line-content"><span class="com"># Adds environment component to scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">scene</span>, <span class="ide">env</span>)</div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>That was all you need to do. If you compile and execute it, you will see an empty window with a slightly better <a href="https://abisxir.github.io/alasgar/step2/build">color</a>.</p>
<h1>First mesh</h1>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates cube entity, by default position is 0, 0, 0</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">cubeEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Cube&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Add a cube mesh component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newCubeMesh</span>())</div></div><div class="line"><div class="line-content"><span class="com"># Makes the cube enity child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cubeEntity</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Scale it up</span></div></div><div class="line"><div class="line-content"><span class="ide">cubeEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">scale</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">2</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>When you execute the program, you will see an ugly black <a href="https://abisxir.github.io/alasgar/step3/build">cube</a>. As you guess we need to have a light in our scene so let us add a point light to our scene:</p>
<h1>Point light</h1>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates light entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">lightEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Light&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets light position</span></div></div><div class="line"><div class="line-content"><span class="ide">lightEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="op">-</span><span class="num">5</span>, <span class="num">5</span>, <span class="num">5</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a point light component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">lightEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newPointLightComponent</span>()</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the light entity child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">lightEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>That is all we needed, our ugly cube maybe is <a href="https://abisxir.github.io/alasgar/step4/build">less ugly</a> now. Lights have some properties, like color, luminance, etc. You change it and you will shade the cube differently.</p>
<h1>Scripts</h1>
<p>To program an entity, we need to add a ScriptComponent to our light entity. Each component has access to an entity, the entity&apos;s transform, and the component&apos;s data. We can add a script to any entity using the &quot;program&quot; function or directly by instantiating a ScriptComponent using the &quot;newScriptComponent&quot; function.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates light entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">lightEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Light&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a point light component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">lightEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newPointLightComponent</span>()</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a script component to light entity</span></div></div><div class="line"><div class="line-content"><span class="ide">program</span>(<span class="ide">lightEntity</span>, <span class="kwd">proc</span>(<span class="ide">script</span>: <span class="ide">ScriptComponent</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="kwd">const</span> <span class="ide">r</span> <span class="op">=</span> <span class="num">7.0</span> </div></div><div class="line"><div class="line-content">    <span class="com"># Change position on transform</span></div></div><div class="line"><div class="line-content">    <span class="ide">script</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">r</span> <span class="op">*</span> <span class="ide">vec3</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>),</div></div><div class="line"><div class="line-content">        <span class="ide">cos</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>),</div></div><div class="line"><div class="line-content">        <span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>) <span class="op">*</span> <span class="ide">cos</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>),</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the light entity child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">lightEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>  <img src="docs/files/step5.gif" style="max-width: 100%;" alt="" /></p>
<p><a href="https://abisxir.github.io/alasgar/step5/build">See</a> now our light moves around our scene and lights our cube from different directions. As you see in the source code, we used an anonymous function to change light&apos;s position. You can define a function and use that here. Feel free to play with nim features. As you notice, we directly access transform component from script component. Each entity has a  reference to the transform component, and all entity components have a reference to that.
In the script we used runtime variable, it is a readonly variable that gives us some good information about engine, also has an instance to engine inside it:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">type</span> </div></div><div class="line"><div class="line-content">    <span class="ide">Runtime</span> <span class="op">=</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">        <span class="ide">engine</span>: <span class="ide">Engine</span>   <span class="com"># engine instance</span></div></div><div class="line"><div class="line-content">        <span class="ide">age</span>: <span class="ide">float32</span>     <span class="com"># total seconds engine is running</span></div></div><div class="line"><div class="line-content">        <span class="ide">frames</span>: <span class="ide">int</span>      <span class="com"># total frames rendered</span></div></div><div class="line"><div class="line-content">        <span class="ide">fps</span>: <span class="ide">float32</span>     <span class="com"># current fps</span></div></div><div class="line"><div class="line-content">        <span class="ide">delta</span>: <span class="ide">float32</span>   <span class="com"># delta between last two frames</span></div></div><div class="line"><div class="line-content">        <span class="ide">input</span>: <span class="ide">Input</span>     <span class="com"># last input state</span></div></div><div class="line"><div class="line-content">        <span class="ide">ratio</span>: <span class="ide">float32</span>   <span class="com"># screen ratio</span></div></div><div class="line"><div class="line-content">        <span class="ide">windowSize</span>: <span class="ide">Vec2</span> <span class="com"># window size</span></div></div><div class="line"><div class="line-content">        <span class="ide">screenSize</span>: <span class="ide">Vec2</span> <span class="com"># screen size</span></div></div>  </code></pre>
<h1>Rotation</h1>
<p>Let us rotate the cube. To do that we need a script component attached to the cube entity:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a script component to cube entity, we use this helpful function:</span></div></div><div class="line"><div class="line-content"><span class="ide">program</span>(<span class="ide">cubeEntity</span>, <span class="kwd">proc</span>(<span class="ide">script</span>: <span class="ide">ScriptComponent</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="com"># We can rotate an object using euler also it is possible to directly set rotation property which is a quaternion.</span></div></div><div class="line"><div class="line-content">    <span class="ide">script</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">euler</span> <span class="op">=</span> <span class="ide">vec3</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>) <span class="op">*</span> <span class="ide">cos</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>), </div></div><div class="line"><div class="line-content">        <span class="ide">cos</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>), </div></div><div class="line"><div class="line-content">        <span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>)</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you <a href="https://abisxir.github.io/alasgar/step6/build">see</a> our ugly cube is rotating and we used Euler angles to change rotation. But also rotation as quat is enabled in TransformComponent and you can use it if you are looking for troubles. Transform component has some useful functions and properties:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">type</span></div></div><div class="line"><div class="line-content">    <span class="ide">TransformComponent</span> <span class="op">=</span> <span class="kwd">ref</span> <span class="kwd">object</span> <span class="kwd">of</span> <span class="ide">RootObj</span></div></div><div class="line"><div class="line-content">        <span class="ide">position</span>: <span class="ide">Vec3</span>              <span class="com"># position in local space</span></div></div><div class="line"><div class="line-content">        <span class="ide">scale</span>: <span class="ide">Vec3</span>                 <span class="com"># scale in local space</span></div></div><div class="line"><div class="line-content">        <span class="ide">rotation</span>: <span class="ide">Quat</span>              <span class="com"># rotation in local space</span></div></div><div class="line"><div class="line-content">        <span class="ide">euler</span>: <span class="ide">Vec3</span>                 <span class="com"># write only euler angles in local space</span></div></div><div class="line"><div class="line-content">        <span class="ide">globalPosition</span>: <span class="ide">Vec3</span>        <span class="com"># position in global space</span></div></div><div class="line"><div class="line-content">        <span class="ide">globalScale</span>: <span class="ide">Vec3</span>           <span class="com"># scale in global space</span></div></div><div class="line"><div class="line-content">        <span class="ide">globalRotation</span>: <span class="ide">Quat</span>        <span class="com"># rotation in global space</span></div></div><div class="line"><div class="line-content">        <span class="ide">parent</span>: <span class="ide">TransformComponent</span>  <span class="com"># parent transform, read only</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">lookAt</span><span class="op">*</span>(<span class="ide">t</span>: <span class="ide">TransformComponent</span>, <span class="ide">target</span>: <span class="ide">Vec3</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">lookAt</span><span class="op">*</span>(<span class="ide">t</span>: <span class="ide">TransformComponent</span>, <span class="ide">target</span>: <span class="ide">TransformComponent</span>)</div></div>  </code></pre>
<h1>Material</h1>
<p>We can change the cube color using material components. So what we need is to add a material component to define the cube&apos;s material.
I used the chroma library to manipulate colors, it is a great library, <a href="https://abisxir.github.io/alasgar/step7/build">here</a> you can see how to use it.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a material to cube</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newMaterialComponent</span>(<span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;Tomato&quot;</span>)))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>Material component in alasgar is instantiated using &quot;newMaterialComponent&quot; that accepts these parameters:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">newMaterialComponent</span><span class="op">*</span>(<span class="ide">diffuseColor</span>: <span class="ide">Color</span><span class="op">=</span><span class="ide">COLOR_WHITE</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">specularColor</span>: <span class="ide">Color</span><span class="op">=</span><span class="ide">COLOR_WHITE</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">emissiveColor</span>: <span class="ide">Color</span><span class="op">=</span><span class="ide">COLOR_BLACK</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">albedoMap</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">normalMap</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">metallicMap</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">roughnessMap</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">aoMap</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">emissiveMap</span>: <span class="ide">Texture</span> <span class="op">=</span> <span class="kwd">nil</span>, </div></div><div class="line"><div class="line-content">                           <span class="ide">metallic</span>: <span class="ide">float32</span> <span class="op">=</span> <span class="num">0.0</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">roughness</span>: <span class="ide">float32</span> <span class="op">=</span> <span class="num">0.0</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">reflectance</span>: <span class="ide">float32</span> <span class="op">=</span> <span class="num">0.0</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">shininess</span>: <span class="ide">float32</span> <span class="op">=</span> <span class="num">128.0</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">ao</span>: <span class="ide">float32</span> <span class="op">=</span> <span class="num">1.0</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">frame</span>: <span class="ide">int</span><span class="op">=</span><span class="num">0</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">vframes</span>: <span class="ide">int</span><span class="op">=</span><span class="num">1</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">hframes</span>: <span class="ide">int</span><span class="op">=</span><span class="num">1</span>,</div></div><div class="line"><div class="line-content">                           <span class="ide">castShadow</span>: <span class="ide">bool</span><span class="op">=</span><span class="ide">false</span>)</div></div>  </code></pre>
<p>If roughness and metallic factors are zero also there is no metallic map and roughness map provided then the shader will use shininess and shades with phong model otherwise will be PBR. vfames, hframes, and frame is used to offset texture, very helpful for sprites or animations, will discuss it later in the sprites section.</p>
<h1>Texture</h1>
<p>It is time to give texture to our cube. To make it multi-platform you need to make &quot;res&quot; folder in your project root and copy your assets inside.
The assets are accessible using a relative path by res like &quot;res://stone-texture.png&quot;. It applies to all other assets like obj files or audio files.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a material to cube</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newMaterialComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;white&quot;</span>),</div></div><div class="line"><div class="line-content">    <span class="ide">specularColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;grey&quot;</span>),</div></div><div class="line"><div class="line-content">    <span class="ide">albedoMap</span><span class="op">=</span><span class="ide">newTexture</span>(<span class="str">&quot;res://stone-texture.png&quot;</span>)</div></div><div class="line"><div class="line-content">))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>If you run the sample, you will see a <a href="https://abisxir.github.io/alasgar/step8/build">textured</a> cube which is not that much ugly this time but there are a lot to improve.</p>
<p>The texture used here grabbed from: https://opengameart.org/content/handpainted-stone-floor-texture</p>
<h1>More lights</h1>
<p>As you see our scene has just one light and the light is moving. Let us add a new light to try another type of lights:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creats spot point light entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">spotLightEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;SpotLight&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets position to (-6, 6, 6)</span></div></div><div class="line"><div class="line-content"><span class="ide">spotLightEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="op">-</span><span class="num">6</span>, <span class="num">6</span>, <span class="num">6</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a spot point light component</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">spotLightEntity</span>, <span class="ide">newSpotPointLightComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">vec3</span>(<span class="num">0</span>) <span class="op">-</span> <span class="ide">spotLightEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span>, <span class="com"># Light direction</span></div></div><div class="line"><div class="line-content">    <span class="ide">color</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;Tomato&quot;</span>)                 <span class="com"># Light color</span></div></div><div class="line"><div class="line-content">    <span class="ide">luminance</span><span class="op">=</span><span class="num">100.0</span>                               <span class="com"># Luminance amount</span></div></div><div class="line"><div class="line-content">    <span class="ide">shadow</span><span class="op">=</span><span class="ide">false</span>,                                 <span class="com"># Casts shadow or not</span></div></div><div class="line"><div class="line-content">    <span class="ide">innerCutoff</span><span class="op">=</span><span class="num">30</span>,                               <span class="com"># Inner circle of light</span></div></div><div class="line"><div class="line-content">    <span class="ide">outerCutoff</span><span class="op">=</span><span class="num">90</span>                                <span class="com"># Outer circle of light</span></div></div><div class="line"><div class="line-content">))</div></div><div class="line"><div class="line-content"><span class="com"># Makes the new light child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">spotLightEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creats direct light entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">directLightEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;DirectLight&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a direct light component, and select camera direction for lighting</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">directLightEntity</span>, <span class="ide">newDirectLightComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">vec3</span>(<span class="num">0</span>) <span class="op">-</span> <span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span>,    <span class="com"># Light direction</span></div></div><div class="line"><div class="line-content">    <span class="ide">color</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;Aqua&quot;</span>),                  <span class="com"># Light color</span></div></div><div class="line"><div class="line-content">    <span class="ide">luminance</span><span class="op">=</span><span class="num">150.0</span>,                              <span class="com"># Light intensity</span></div></div><div class="line"><div class="line-content">    <span class="ide">shadow</span><span class="op">=</span><span class="ide">false</span>,                                 <span class="com"># Casts shadow or not</span></div></div><div class="line"><div class="line-content">))</div></div><div class="line"><div class="line-content"><span class="com"># Makes the new light child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">directLightEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you <a href="https://abisxir.github.io/alasgar/step9/build">see</a> now, our cube is shaded by three different kinds of lights, not that much ugly anymore. However, our scene with just one cube is boring. Before we add another objects to our scene, let us see how we can access components when we program an entity.</p>
<h1>Access components</h1>
<p>Let us program the direct light&apos;s entity and access to the direct light&apos;s component and just for fun change the light color and luminance. To access a component we can call getComponent[T] on an entity or a component. Also, it is possible to access it using the index operator on any entity or component:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">c</span> <span class="op">=</span> <span class="ide">getComponent</span>[<span class="ide">MyComponent</span>](<span class="ide">e</span>)</div></div>  </code></pre>
<p>Or simply using an index operator:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">c</span> <span class="op">=</span> <span class="ide">e</span>[<span class="ide">MyComponent</span>]</div></div>  </code></pre>
<p>If there is no such a component, it will return nil. Let us try it by adding a script component to our spot light to program it:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a script component to direct light entity</span></div></div><div class="line"><div class="line-content"><span class="ide">program</span>(<span class="ide">directLightEntity</span>, <span class="kwd">proc</span>(<span class="ide">script</span>: <span class="ide">ScriptComponent</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="com"># Access to direct light component.</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">light</span> <span class="op">=</span> <span class="ide">script</span>[<span class="ide">DirectLightComponent</span>]</div></div><div class="line"><div class="line-content">    <span class="com"># Or you can access it by calling getComponent function:</span></div></div><div class="line"><div class="line-content">    <span class="com"># let light = getComponent[DirectLightComponent](script)</span></div></div><div class="line"><div class="line-content">    <span class="com"># Changes light color</span></div></div><div class="line"><div class="line-content">    <span class="ide">light</span><span class="op">.</span><span class="ide">color</span> <span class="op">=</span> <span class="ide">color</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">abs</span>(<span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>)), </div></div><div class="line"><div class="line-content">        <span class="ide">abs</span>(<span class="ide">cos</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>)), </div></div><div class="line"><div class="line-content">        <span class="ide">abs</span>(<span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>) <span class="op">*</span> <span class="ide">cos</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>))</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">    <span class="com"># Change luminance, will be between 250 and 750</span></div></div><div class="line"><div class="line-content">    <span class="ide">light</span><span class="op">.</span><span class="ide">luminance</span> <span class="op">=</span> <span class="num">500.0</span> <span class="op">+</span> <span class="num">250.0</span> <span class="op">*</span> <span class="ide">sin</span>(<span class="ide">runtime</span><span class="op">.</span><span class="ide">age</span>)</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>If you <a href="https://abisxir.github.io/alasgar/step10/build">execute</a> the program, you will notice that the color is changing.</p>
<h1>Screen size</h1>
<p>By default the screen size is equal with window size, but maybe you like to have a lower resolution:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">alasgar</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates a window named Hello, and sets screen size to (160, 90)</span></div></div><div class="line"><div class="line-content"><span class="ide">screen</span>(<span class="num">160</span>, <span class="num">90</span>)</div></div><div class="line"><div class="line-content"><span class="ide">window</span>(<span class="str">&quot;Hello&quot;</span>, <span class="num">640</span>, <span class="num">360</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>You need to specify it before creating window, after window creation there is no effect.</p>
<h1>Environment variables</h1>
<p>We already used envionment variable to change background color. We can set these attributes:
- Background color
- Fog
- Ambient light color
- Skybox</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># Sets background color</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setBackground</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">color</span>: <span class="ide">Color</span>) </div></div><div class="line"><div class="line-content"><span class="com"># Sets ambient light color</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setAmbient</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">color</span>: <span class="ide">Color</span>, <span class="ide">intense</span>: <span class="ide">float32</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets fog density</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setFogDensity</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">density</span>: <span class="ide">float32</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets fog gradient</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setFogGradient</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">gradient</span>: <span class="ide">float32</span>) </div></div><div class="line"><div class="line-content"><span class="com"># Sets skybox, for each side totally 6 images</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setSkybox</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">px</span>, <span class="ide">nx</span>, <span class="ide">py</span>, <span class="ide">ny</span>, <span class="ide">pz</span>, <span class="ide">nz</span>: <span class="ide">string</span>, <span class="ide">size</span>: <span class="ide">int</span>) </div></div><div class="line"><div class="line-content"><span class="com"># Sets skybox, takes panroma image and converts it to a cube box texture, accepts hdr images</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setSkybox</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">url</span>: <span class="ide">string</span>, <span class="ide">size</span>: <span class="ide">int</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets environment intensity, for IBL</span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setEnvironmentIntensity</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">value</span>: <span class="ide">float32</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets envirnoment blurrity, the higher it gets, skybox will get much blur </span></div></div><div class="line"><div class="line-content"><span class="kwd">func</span> <span class="ide">setEnvironmentBlurrity</span>(<span class="ide">env</span>: <span class="ide">EnvironmentComponent</span>, <span class="ide">value</span>: <span class="ide">float32</span>)</div></div>  </code></pre>
<p>We will discuss postprocessing effects later on a dedicated section. You can see and example of environment variables in shadows section.</p>
<h1>Normal maps</h1>
<p>It is easy to add a normal map, we need to specify it in material component:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a material to cube</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newMaterialComponent</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;white&quot;</span>),</div></div><div class="line"><div class="line-content">        <span class="ide">albedoMap</span><span class="op">=</span><span class="ide">newTexture</span>(<span class="str">&quot;res://stone-texture.png&quot;</span>),</div></div><div class="line"><div class="line-content">        <span class="ide">normalMap</span><span class="op">=</span><span class="ide">newTexture</span>(<span class="str">&quot;res://stone-texture-normal.png&quot;</span>)</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the cube enity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cubeEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>  <img src="docs/files/cube-normal.gif" style="max-width: 100%;" alt="" /></p>
<p>See normal sample <a href="examples/normal.nim">here</a>.</p>
<h1>Interactive objects</h1>
<p>It is nice if we can select an object with mouse or by touch on mobile platforms, let us add a InteractiveComponent to our cube:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Handles mouse hover in</span></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">onCubeHover</span>(<span class="ide">interactive</span>: <span class="ide">InteractiveComponent</span>, <span class="ide">collision</span>: <span class="ide">Collision</span>)<span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">material</span> <span class="op">=</span> <span class="ide">interactive</span>[<span class="ide">MaterialComponent</span>]</div></div><div class="line"><div class="line-content">    <span class="ide">material</span><span class="op">.</span><span class="ide">diffuseColor</span> <span class="op">=</span> <span class="ide">parseHtmlName</span>(<span class="str">&quot;yellow&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Handles mouse hover out</span></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">onCubeOut</span>(<span class="ide">interactive</span>: <span class="ide">InteractiveComponent</span>)<span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">material</span> <span class="op">=</span> <span class="ide">interactive</span>[<span class="ide">MaterialComponent</span>]</div></div><div class="line"><div class="line-content">    <span class="ide">material</span><span class="op">.</span><span class="ide">diffuseColor</span> <span class="op">=</span> <span class="ide">parseHtmlName</span>(<span class="str">&quot;green&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates cube entity, by default position is 0, 0, 0</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">cubeEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Cube&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Set scale to 2</span></div></div><div class="line"><div class="line-content"><span class="ide">cubeEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">scale</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">2</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Add a cube mesh component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newCubeMesh</span>())</div></div><div class="line"><div class="line-content"><span class="com"># Adds a material to cube</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newMaterialComponent</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;green&quot;</span>)</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a collision compnent to cube entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newCollisionComponent</span>(<span class="ide">vec3</span>(<span class="op">-</span><span class="num">1</span>, <span class="op">-</span><span class="num">1</span>, <span class="op">-</span><span class="num">1</span>), <span class="ide">vec3</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>)))</div></div><div class="line"><div class="line-content"><span class="com"># Adds an interactive</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cubeEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newInteractiveComponent</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">onHover</span><span class="op">=</span><span class="ide">onCubeHover</span>,</div></div><div class="line"><div class="line-content">        <span class="ide">onOut</span><span class="op">=</span><span class="ide">onCubeOut</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the cube enity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cubeEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you see, we have two functions to handle mouse&apos;s in and out (hover) functionalities. To make interactive components working, you need to add a collision component.
Alsgar supports just two types, AABB and sphere. We also changed the spot light position, stopped point light moving and set our cube diffuse color to green. It is the final result:</p>
<p>  <img src="docs/files/interactive.gif" style="max-width: 100%;" alt="" /></p>
<p>When you add interactive component, you have: onPress, onRelease, onHover, onOut and onMotion. Except onOut, all of the functions pass collision information.</p>
<p>See interactive sample <a href="examples/interactive.nim">here</a>.</p>
<h1>Shadows</h1>
<p>For now, shadows are just implemented for SpotPointLight components, also it is limited to just one light.
Let us setup our scene in a way that we can observe shadows, after setup window, scene and setting up our camera, we create a big platform:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates platform entity, by default position is (0, 0, 0)</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">platformEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Platform&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Set scale to 20</span></div></div><div class="line"><div class="line-content"><span class="ide">platformEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">scale</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">20</span>)</div></div><div class="line"><div class="line-content"><span class="ide">platformEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">euler</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">0</span>, <span class="num">0</span>, <span class="op">-</span><span class="ide">PI</span> <span class="op">/</span> <span class="num">2</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Add a cube mesh component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">platformEntity</span>, <span class="ide">newPlaneMesh</span>(<span class="num">1</span>, <span class="num">1</span>))</div></div><div class="line"><div class="line-content"><span class="com"># Adds a material to cube</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">platformEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newMaterialComponent</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;grey&quot;</span>),</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the cube enity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">platformEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you see we created a plane mesh and scaled it to 20, and we rotated it as we want to see it from top. Then we make a simple function to add cubes, we need two cubes so this is our function:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">createCube</span>(<span class="ide">name</span>: <span class="ide">string</span>, <span class="ide">position</span>: <span class="ide">Vec3</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="com"># Creates cube entity</span></div></div><div class="line"><div class="line-content">    <span class="kwd">var</span> <span class="ide">cubeEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="ide">name</span>)</div></div><div class="line"><div class="line-content">    <span class="com"># Positions cube to (0, 2, 0)</span></div></div><div class="line"><div class="line-content">    <span class="ide">cubeEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">position</span></div></div><div class="line"><div class="line-content">    <span class="com"># Add a cube mesh component to entity</span></div></div><div class="line"><div class="line-content">    <span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newCubeMesh</span>())</div></div><div class="line"><div class="line-content">    <span class="com"># Adds a script component to cube entity</span></div></div><div class="line"><div class="line-content">    <span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newScriptComponent</span>(<span class="kwd">proc</span>(<span class="ide">script</span>: <span class="ide">ScriptComponent</span>, <span class="ide">input</span>: <span class="ide">Input</span>, <span class="ide">delta</span>: <span class="ide">float32</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">        <span class="com"># We can rotate an object using euler also we can directly set rotation property that is a quaternion.</span></div></div><div class="line"><div class="line-content">        <span class="ide">script</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">euler</span> <span class="op">=</span> <span class="ide">vec3</span>(</div></div><div class="line"><div class="line-content">            <span class="ide">runtime</span><span class="op">.</span><span class="ide">engine</span><span class="op">.</span><span class="ide">age</span> <span class="op">*</span> <span class="num">0.1</span>, </div></div><div class="line"><div class="line-content">            <span class="ide">runtime</span><span class="op">.</span><span class="ide">engine</span><span class="op">.</span><span class="ide">age</span> <span class="op">*</span> <span class="num">0.3</span>, </div></div><div class="line"><div class="line-content">            <span class="ide">runtime</span><span class="op">.</span><span class="ide">engine</span><span class="op">.</span><span class="ide">age</span> <span class="op">*</span> <span class="num">0.2</span>,</div></div><div class="line"><div class="line-content">        )</div></div><div class="line"><div class="line-content">    ))</div></div><div class="line"><div class="line-content">    <span class="com"># Adds a material to cube and specifies that the cube casts shadow.</span></div></div><div class="line"><div class="line-content">    <span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">cubeEntity</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">newMaterialComponent</span>(</div></div><div class="line"><div class="line-content">            <span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;grey&quot;</span>),</div></div><div class="line"><div class="line-content">            <span class="ide">castShadow</span><span class="op">=</span><span class="ide">true</span>,                    <span class="com"># Here we specify that this object casts shadow, default is false</span></div></div><div class="line"><div class="line-content">        )</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">    <span class="com"># Makes the cube enity child of scene</span></div></div><div class="line"><div class="line-content">    <span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cubeEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">createCube</span>(<span class="str">&quot;Cube1&quot;</span>, <span class="ide">vec3</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">0</span>))</div></div><div class="line"><div class="line-content"><span class="ide">createCube</span>(<span class="str">&quot;Cube2&quot;</span>, <span class="ide">vec3</span>(<span class="op">-</span><span class="num">4</span>, <span class="num">2</span>, <span class="num">0</span>))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you see, we created two cubes in different positions. The important part is that we need to define in object material that it casts shadow.
Now we create a spot light component and we need to enable shadow for this light source:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creats spot point light entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">spotLightEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;SpotLight&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Sets position to (-6, 6, 6)</span></div></div><div class="line"><div class="line-content"><span class="ide">spotLightEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">12</span>, <span class="num">12</span>, <span class="num">0</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a spot point light component</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">spotLightEntity</span>, <span class="ide">newSpotPointLightComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">vec3</span>(<span class="num">0</span>) <span class="op">-</span> <span class="ide">spotLightEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span>, <span class="com"># Light direction</span></div></div><div class="line"><div class="line-content">    <span class="ide">color</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;LemonChiffon&quot;</span>),          <span class="com"># Light color</span></div></div><div class="line"><div class="line-content">    <span class="ide">shadow</span><span class="op">=</span><span class="ide">true</span>,                                  <span class="com"># Enables shadow</span></div></div><div class="line"><div class="line-content">    <span class="ide">innerCutoff</span><span class="op">=</span><span class="num">30</span>,                               <span class="com"># Inner circle of light</span></div></div><div class="line"><div class="line-content">    <span class="ide">outerCutoff</span><span class="op">=</span><span class="num">90</span>                                <span class="com"># Outer circle of light</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the new light child of the scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">spotLightEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>  <img src="docs/files/shadow.gif" style="max-width: 100%;" alt="" /></p>
<p>That is all, if you run shadow sample you will see the effects. I hope you also notice the artifacts, light bleeding and so on, I like them :)
Here I used variance shadow map, but this part needs many improvements specially batching is not enabled for shadow casting objects so the performance is not going to be satisfying. There are going to be many improvements in near future.</p>
<p>See shadow sample <a href="examples/shadow.nim">here</a>.</p>
<h1>Effects</h1>
<p>There are some effects already developed to use in alasgar:</p>
<ul>
<li>FXAA</li>
<li>SSAO</li>
<li>HBAO</li>
<li>Bloom</li>
</ul>
<p>To use them we need to import and add it to camera as a post processing effect:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">alasgar</span><span class="op">/</span><span class="ide">private</span><span class="op">/</span><span class="ide">effects</span><span class="op">/</span><span class="ide">fxaa</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="com"># Creates camera entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> </div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Camera&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Sets camera position</span></div></div><div class="line"><div class="line-content"><span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="op">-</span><span class="num">5</span>, <span class="num">4</span>, <span class="op">-</span><span class="num">5</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates a camera component to later add it to camera entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> </div></div><div class="line"><div class="line-content">    <span class="ide">camera</span> <span class="op">=</span> <span class="ide">newPerspectiveCamera</span>(</div></div><div class="line"><div class="line-content">        <span class="num">75</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">runtime</span><span class="op">.</span><span class="ide">ratio</span>, </div></div><div class="line"><div class="line-content">        <span class="num">0.1</span>, </div></div><div class="line"><div class="line-content">        <span class="num">100.0</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">vec3</span>(<span class="num">0</span>) <span class="op">-</span> <span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds fxaa effect</span></div></div><div class="line"><div class="line-content"><span class="ide">addEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;FXAA&quot;</span>, <span class="ide">newFXAAEffect</span>())</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a perspective camera component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">camera</span>,</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Makes the camera entity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cameraEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>This effects come with some parameters to adjust the result. Also you can write custom effects if you like. There are some functions to manipulate effects:</p>
<ul>
<li>removeEffect(c: CamereEntity, name: string)</li>
<li>disableEffect(c: CamereEntity, name: string)</li>
<li>enableEffect(c: CamereEntity, name: string)</li>
<li>getEffect(c: CamereEntity, name: string): Shader</li>
</ul>
<h1>Custom effects</h1>
<p>Adding post processing effect or custom effect is as easy as writing a glsl function. Predefined effects like bloom or FXAA are also custom effect that just provided to make it accessable for most of the use-cases. So what we need is a camera:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">alasgar</span><span class="op">/</span><span class="ide">private</span><span class="op">/</span><span class="ide">effects</span><span class="op">/</span><span class="ide">fxaa</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="com"># Creates camera entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> </div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Camera&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Sets camera position</span></div></div><div class="line"><div class="line-content"><span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="op">-</span><span class="num">5</span>, <span class="num">4</span>, <span class="op">-</span><span class="num">5</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates a camera component to later add it to camera entity</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> </div></div><div class="line"><div class="line-content">    <span class="ide">camera</span> <span class="op">=</span> <span class="ide">newPerspectiveCamera</span>(</div></div><div class="line"><div class="line-content">        <span class="num">75</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">runtime</span><span class="op">.</span><span class="ide">ratio</span>, </div></div><div class="line"><div class="line-content">        <span class="num">0.1</span>, </div></div><div class="line"><div class="line-content">        <span class="num">100.0</span>, </div></div><div class="line"><div class="line-content">        <span class="ide">vec3</span>(<span class="num">0</span>) <span class="op">-</span> <span class="ide">cameraEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">position</span></div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds custom effect</span></div></div><div class="line"><div class="line-content"><span class="ide">addEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;MY-EFFECT&quot;</span>, """
void fragment() {
    COLOR.r = 1.0;
}
""")</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a perspective camera component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">camera</span>,</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Makes the camera entity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cameraEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you see we just set the red channel to 1.0, you can run and see how it works. Unfortunately alasgar is not mature to provide a compiling feature on adding effects, so you will get error if your function has any error. But there some good libraries for nim, like shady. Maybe someday it is integerated into alasgar. Back to the main topic, there are some variables provided here:</p>
<ul>
<li>vec2 UV: readonly</li>
<li>vec4 COLOR: read/write</li>
<li>frame: readonly</li>
<li>camera: readonly</li>
</ul>
<p>Frame definition:</p>
<p>struct {
vec3 resolution;
float time;
float time_delta;
float frame;
vec4 mouse;
vec4 date;
}</p>
<p>Camera definition:</p>
<p>struct {
vec3 position;
mat4 view;
mat4 view_inversed;
mat4 projection;
mat4 projection_inversed;
float exposure;
float gamma;
float near;
float far;
}</p>
<p>There are also some function available like:</p>
<ul>
<li>vec4 get_color(vec2)</li>
<li>vec3 get_normal(vec2)</li>
<li>vec3 get_position(vec2)</li>
<li>float snoise(vec2)</li>
</ul>
<p>The post-processing effect is a simple shader, so you can define your functions, variable and uniforms. Let us try to pass a uniform variable:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="com"># Adds custom effect</span></div></div><div class="line"><div class="line-content"><span class="ide">addEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;MY-EFFECT&quot;</span>, """

uniform vec3 u_add; 

void fragment() {
    COLOR.rgb += u_add;
}
""")</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a perspective camera component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">camera</span>,</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a script component to control camera effect</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cameraEntity</span>, <span class="ide">newScriptComponent</span>(<span class="kwd">proc</span>(<span class="ide">script</span>: <span class="ide">ScriptComponent</span>, <span class="ide">input</span>: <span class="ide">Input</span>, <span class="ide">delta</span>: <span class="ide">float32</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="com"># Access to camera component and get our effect.</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">effect</span> <span class="op">=</span> <span class="ide">getEffect</span>(<span class="ide">script</span>[<span class="ide">CameraEntity</span>], <span class="str">&quot;MY-EFFECT&quot;</span>)</div></div><div class="line"><div class="line-content">    <span class="com"># Shader will keep this value and before render will pass it to gpu.</span></div></div><div class="line"><div class="line-content">    <span class="ide">set</span>(<span class="ide">effect</span>, <span class="str">&quot;u_add&quot;</span>, <span class="ide">delta</span> <span class="op">*</span> <span class="ide">vec3</span>(<span class="num">0.9</span>, <span class="num">0.7</span>, <span class="num">0.5</span>))</div></div><div class="line"><div class="line-content">))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Makes the camera entity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cameraEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>Predefined textures are limited to 4 channels:</p>
<ul>
<li>channel0</li>
<li>channel1</li>
<li>channel2</li>
<li>channel3</li>
</ul>
<p>They are exactly like uniform values but predefined so to set it we will need a texture:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="com"># Adds custom effect</span></div></div><div class="line"><div class="line-content"><span class="ide">addEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;MY-EFFECT&quot;</span>, """
void fragment() {
    COLOR.rgb *= texture(channel0, UV);
}
""")</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Create a texture</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">texture</span> <span class="op">=</span> <span class="ide">newTexture</span>(<span class="str">&quot;res://stone-texture.png&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Gets effect instance that is a shader</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">effect</span> <span class="op">=</span> <span class="ide">getEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;MY-EFFECT&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Attachs the texture to channel0</span></div></div><div class="line"><div class="line-content"><span class="ide">set</span>(<span class="ide">effect</span>, <span class="str">&quot;channel0&quot;</span>, <span class="ide">texture</span>, <span class="num">0</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Adds a perspective camera component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cameraEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">camera</span>,</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Makes the camera entity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cameraEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>If you like a different sampler like cube or you need extra samples you can still define them but you should start binding them from slot 8:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"><span class="com"># Adds custom effect</span></div></div><div class="line"><div class="line-content"><span class="ide">addEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;MY-EFFECT&quot;</span>, """

layout(binding = 8) uniform sampler2D my_channel;

void fragment() {
    ...
}
""")</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Create a texture</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">texture</span> <span class="op">=</span> <span class="ide">newTexture</span>(<span class="str">&quot;res://stone-texture.png&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Gets effect instance that is a shader</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">effect</span> <span class="op">=</span> <span class="ide">getEffect</span>(<span class="ide">camera</span>, <span class="str">&quot;MY-EFFECT&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Attachs the texture to my_channel at slot 8</span></div></div><div class="line"><div class="line-content"><span class="ide">set</span>(<span class="ide">effect</span>, <span class="str">&quot;my_channel&quot;</span>, <span class="ide">texture</span>, <span class="num">8</span>)</div></div>  </code></pre>
<h1>Shaders</h1>
<p>It is easy to define to customize the way that one mesh renders. However it needs to be used just in case that the default shader cannot do it. As each shader has it&apos;s own parameters and switching between shader when rendering will come with big performance cost when there a lot of meshes with custom shader.
Adding a fragment shader to a mesh is possible using ShaderComponent:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Creates cube entity, by default position is 0, 0, 0</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">cubeEntity</span> <span class="op">=</span> <span class="ide">newEntity</span>(<span class="ide">scene</span>, <span class="str">&quot;Cube&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Set scale to 2</span></div></div><div class="line"><div class="line-content"><span class="ide">cubeEntity</span><span class="op">.</span><span class="ide">transform</span><span class="op">.</span><span class="ide">scale</span> <span class="op">=</span> <span class="ide">vec3</span>(<span class="num">2</span>)</div></div><div class="line"><div class="line-content"><span class="com"># Add a cube mesh component to entity</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, <span class="ide">newCubeMesh</span>())</div></div><div class="line"><div class="line-content"><span class="com"># Adds a material to cube</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(<span class="ide">cubeEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newMaterialComponent</span>(</div></div><div class="line"><div class="line-content">        <span class="ide">diffuseColor</span><span class="op">=</span><span class="ide">parseHtmlName</span>(<span class="str">&quot;green&quot;</span>)</div></div><div class="line"><div class="line-content">    )</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Adds a shader component</span></div></div><div class="line"><div class="line-content"><span class="ide">addComponent</span>(</div></div><div class="line"><div class="line-content">    <span class="ide">cubeEntity</span>, </div></div><div class="line"><div class="line-content">    <span class="ide">newFragmentShaderComponent</span>("""
    void fragment() {
        COLOR.g = 0.0;
    }
""")</div></div><div class="line"><div class="line-content">)</div></div><div class="line"><div class="line-content"><span class="com"># Makes the cube enity child of scene</span></div></div><div class="line"><div class="line-content"><span class="ide">addChild</span>(<span class="ide">scene</span>, <span class="ide">cubeEntity</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="op">...</span></div></div>  </code></pre>
<p>As you see, we deleted the green channel from color.</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/abisxir/alasgar">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-09-06T01:06:57Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
