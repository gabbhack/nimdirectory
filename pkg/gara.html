<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">gara</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">nim</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">pattern</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("A pattern matching library")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install gara" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><p>  <a href="https://travis-ci.org/alehander42/gara">    <img src="https://img.shields.io/travis/alehander42/gara/master.svg" style="max-width: 100%;" alt="Build Status (Travis)" title="build status" />  </a></p>
<h1>gara</h1>
<p>A nim macro-based pattern matching library.</p>
<h3>DSL</h3>
<p>A library that provides a <code>match</code> macro which can be used as a pattern matching construct.</p>
<p>A <code>matches</code> macro which returns true if a value is matched.</p>
<p>A <code>maybeMatches</code> macro which returns an <code>Option[tuple]</code> of the matched &quot;variables&quot;.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">rectangles</span> <span class="op">=</span> <span class="op">@</span>[<span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="num">0</span>, <span class="ide">b</span>: <span class="num">2</span>), <span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="num">4</span>, <span class="ide">b</span>: <span class="num">4</span>), <span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="num">4</span>, <span class="ide">b</span>: <span class="num">4</span>), <span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="num">4</span>, <span class="ide">b</span>: <span class="num">4</span>)]</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">rectangles</span>):</div></div><div class="line"><div class="line-content">  <span class="op">@</span>[]:</div></div><div class="line"><div class="line-content">    <span class="ide">fail</span>()</div></div><div class="line"><div class="line-content">  <span class="op">@</span>[<span class="ide">_</span>, <span class="op">*</span>(<span class="ide">a</span>: <span class="num">4</span>, <span class="ide">b</span>: <span class="num">4</span>) <span class="op">@</span><span class="ide">others</span>]: <span class="com"># (a: 4, b: 4) is a shorthand for `TypeName(field: value)`, see the next examples</span></div></div><div class="line"><div class="line-content">    <span class="ide">check</span>(<span class="ide">others</span> <span class="op">==</span> <span class="ide">a</span>[<span class="num">1</span> <span class="op">..</span> <span class="op">^</span><span class="num">1</span>]) <span class="com"># we match the rest, because they all match subpattern</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">fail</span>()</div></div>  </code></pre>
<p>It&apos;s still experimental, there are some bugs left and the design of the DSL might still change depending on feedback of the community. For now it&apos;s a personal project, but I&apos;d love if other people would join as contributors. It&apos;s inspired by @andreaferretti &apos;s <a href="https://github.com/andreaferretti/patty">patty</a> and @krux02 &apos;s <a href="https://github.com/krux02/ast-pattern-matching">ast-pattern-matching</a> (and more stuff, there is a credits section!)</p>
<h3>Features</h3>
<p>Matching</p>
<ul>
<li>values</li>
<li>types</li>
<li>objects</li>
<li>nested subpatterns</li>
<li>capture subpatterns and values with <code>@name</code></li>
<li>variants</li>
<li>wildcard</li>
<li>seq</li>
<li>match many elements in seq with <code>*</code></li>
<li>two kinds of custom unpackers (thanks to @krux02 for making me aware of the scala pattern matching design and apply/unapply: they work differently here though)</li>
<li>support for recognizing other types as variant</li>
<li>if guards</li>
<li>unification</li>
<li>matches expression</li>
<li>option matching</li>
</ul>
<h3>Rationale</h3>
<p>Goals:</p>
<ul>
<li>Ability to generate code with zero overhead compared to manually written if/case/for equivalents</li>
<li>Expressive and flexible syntax for patterns and extensible hooks</li>
<li>Nice error reporting and pretty understandable generated code</li>
</ul>
<p>The goals are ordered by priority.</p>
<p>Speed is very important: the goal is to be able to use matching everywhere where you&apos;d use a complicated <code>if</code>/<code>case</code>.
If there are cases, when we&apos;re slower:</p>
<p>This should be considered a bug.</p>
<p>or</p>
<p>This is a limitation of the library: which is not cool.</p>
<p>Currently not every feature is optimized well(there are some blockers, and some features are still experimental).</p>
<p>The library is supposed to be extensible: please take a look at the unpackers section. For example we already implement the option matching with a <code>Some</code> unpacker.</p>
<p>I have a plan about the error reporting part: basically with several hooks inside the current code we should be able to produce
good messages. My plan API is</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">matchDebug</span>(<span class="ide">a</span>): <span class="com"># generates an error message describing the comparisons we had and raises it if we hit unimplemented else</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># or</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">lastMatchError</span>() <span class="com"># if we detect this call, we generate an error message: we don&apos;t do it by default to not slow down the code</span></div></div>  </code></pre>
<p>With some discipline we can generate pretty readable code from our macro.
This would be also beneficial for the end user, as we can map his invocation with the generated code and help him
see the problem easily.</p>
<p>There are 3 cases:</p>
<ul>
<li>The user had a logical error in his patterns: easily seen with the generated code</li>
<li>The user used a pattern in an unexpected way: this way he can see how its expansion differs from his expectation</li>
<li>Our patterns worked incorrectly: the user can issue a bug</li>
</ul>
<h3>Values</h3>
<p>Just test for equality with the value. Works also if you pass an existing variable instead of 2. For now you can&apos;t just pass various expressions tho (2 + 2), as I want to reserve syntax for the patterns</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">a</span> <span class="op">=</span> <span class="num">2</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="num">2</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;2&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;no 2&quot;</span></div></div>  </code></pre>
<h3>Types</h3>
<p>The library tests with <code>is</code></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">Rectangle</span>: <span class="com"># matches Rectangle(a: 0), Rectangle(a: 2, b: 4)</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;rectangle&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;other&quot;</span></div></div>  </code></pre>
<h3>Objects</h3>
<p>We have a shorthand syntax for objects. You can type only the fields, and then we check only them: this is a good idea because usually
you know the type of the object that you are passing, so there is rarely ambiguity.
Of course you can still add the type if you want. You can use this for tuples too.</p>
<p>You can pass just some of the fields!</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">rectangle</span> <span class="op">=</span> <span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="num">0</span>, <span class="ide">b</span>: <span class="num">0</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">rectangle</span>):</div></div><div class="line"><div class="line-content">  (<span class="ide">a</span>: <span class="num">0</span>, <span class="ide">b</span>: <span class="num">0</span>): <span class="com"># matches Rectangle(a: 0, b: 0)</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;ok&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="op">-</span><span class="num">2</span>): <span class="com"># matches Rectangle(a: -2) (a: -2, e: 4)</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;weird&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="num">0</span></div></div>  </code></pre>
<h3>Subpatterns</h3>
<p>You can match subpatterns.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">a</span> <span class="op">=</span> <span class="ide">A</span>(<span class="ide">b</span>: <span class="ide">B</span>(<span class="ide">c</span>: <span class="num">0</span>, <span class="ide">e</span>: <span class="num">2</span>))</div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">A</span>(<span class="ide">b</span>: <span class="ide">B</span>(<span class="ide">c</span>: <span class="num">0</span>)):</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;ok&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;fail&quot;</span></div></div>  </code></pre>
<h3>Capturing</h3>
<p>We capture with <code>@name</code> for all our usecases: wsubpatterns and values.
You write <code>stuff @name</code> which shouldn&apos;t be ambigious in general(please read the answers and questions section)</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">C</span>(<span class="ide">e</span>: <span class="ide">E</span>(<span class="ide">f</span>: <span class="op">@</span><span class="ide">f</span>) <span class="op">@</span><span class="ide">e</span>): <span class="com"># matches C(e: E(f: 0)) and creates local variables f = 0 and e = E(..)</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">e</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">f</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;fail&quot;</span></div></div>  </code></pre>
<h3>Variants</h3>
<p>We recognize when you do <code>enumLabel(..)</code> and we match variants then. That&apos;s very nice if you are threating them as abstract data types.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">Merge</span>(<span class="ide">original</span>: <span class="op">@</span><span class="ide">original</span>, <span class="ide">other</span>: <span class="op">@</span><span class="ide">other</span>):</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">original</span></div></div><div class="line"><div class="line-content">  <span class="ide">Normal</span>(<span class="ide">message</span>: <span class="op">@</span><span class="ide">message</span>):</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">message</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">a</span></div></div>  </code></pre>
<h3>Wildcards</h3>
<p>You can use <code>_</code> as a wildcard, it always succeeds. It&apos;s also used as <code>otherwise</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="op">@</span>[<span class="ide">_</span>]: <span class="com"># matches any value</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">a</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;nope&quot;</span></div></div>  </code></pre>
<h3>seq</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="op">@</span>[<span class="num">4</span>, <span class="num">5</span>]: <span class="com"># matches @[4, 5]</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;ok&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;no&quot;</span></div></div>  </code></pre>
<h3>Many elements in seq</h3>
<p>You can match repeated properties</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">rectangles</span> <span class="op">=</span> <span class="op">@</span>[<span class="ide">e</span>, <span class="ide">e</span>, <span class="ide">Rectangle</span>(<span class="ide">a</span>: <span class="num">0</span>)]</div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="op">@</span>[<span class="ide">_</span>, <span class="ide">_</span>, <span class="op">*</span>(<span class="ide">a</span>: <span class="op">@</span><span class="ide">list</span>)]: <span class="com"># creates a local variable list which collects the a fields in the matches elements : @[0]</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">list</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="op">@</span>[]</div></div>  </code></pre>
<p>Here we match the elements after 1 and collect their a fields. You can also just <code>@name</code> the whole subpattern: it should be always a seq.
We use <code>allIt</code> for the test, but in a case like this, we optimize it out, as it is always true(we just load values).</p>
<h3>Unpackers</h3>
<p>We can have unpackers for types: you define <code>proc unpack(t: Type): T</code> for your type.
The powerful thing is, <code>T</code> can be anything that has a len and <code>[int]</code>(we will add a concept for that later, but it covers seq, tuple).
For example we do this for Rectangle</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">unpack</span>(<span class="ide">rectangle</span>: <span class="ide">Rectangle</span>): <span class="ide">seq</span>[<span class="ide">int</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="op">@</span>[<span class="ide">rectangle</span><span class="op">.</span><span class="ide">a</span>, <span class="ide">rectangle</span><span class="op">.</span><span class="ide">b</span>]</div></div>  </code></pre>
<p>Of course we are lucky here, but you can do transformations for more complicated cases.</p>
<p>When you do this, you can use the unpacked values like <code>Type(value, value)</code> .
We even recognize the enum case, so you can do it for variants too.</p>
<p>we also have function unpackers: <code>proc name(t: Type): T</code>. This way you can have many unpackers for the same type. This is useful , especially if a builtin type already has a default unpacker, and you need a custom one.
You match passing them as calls with their expected values: <code>name(res)</code></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">data</span>(<span class="ide">email</span>: <span class="ide">Email</span>): <span class="kwd">tuple</span>[<span class="ide">name</span>: <span class="ide">string</span>, <span class="ide">domain</span>: <span class="ide">string</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">words</span> <span class="op">=</span> <span class="ide">email</span><span class="op">.</span><span class="ide">raw</span><span class="op">.</span><span class="ide">split</span>('@', <span class="num">1</span>)</div></div><div class="line"><div class="line-content">  (<span class="ide">name</span>: <span class="ide">words</span>[<span class="num">0</span>], <span class="ide">domain</span>: <span class="ide">words</span>[<span class="num">1</span>])</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">tokens</span>(<span class="ide">email</span>: <span class="ide">Email</span>): <span class="ide">seq</span>[<span class="ide">string</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="com"># slow</span></div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="op">@</span>[]</div></div><div class="line"><div class="line-content">  <span class="kwd">var</span> <span class="ide">token</span> <span class="op">=</span> <span class="str">&quot;&quot;</span></div></div><div class="line"><div class="line-content">  <span class="kwd">for</span> <span class="ide">i</span>, <span class="ide">c</span> <span class="kwd">in</span> <span class="ide">email</span><span class="op">.</span><span class="ide">raw</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="kwd">not</span> <span class="ide">c</span><span class="op">.</span><span class="ide">isAlphaNumeric</span>():</div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="ide">token</span><span class="op">.</span><span class="ide">len</span> <span class="op">&gt;</span> <span class="num">0</span>:</div></div><div class="line"><div class="line-content">        <span class="ide">result</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">token</span>)</div></div><div class="line"><div class="line-content">        <span class="ide">token</span> <span class="op">=</span> <span class="str">&quot;&quot;</span></div></div><div class="line"><div class="line-content">      <span class="ide">result</span><span class="op">.</span><span class="ide">add</span>(<span class="op">$</span><span class="ide">c</span>)</div></div><div class="line"><div class="line-content">    <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">token</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">c</span>)</div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">token</span><span class="op">.</span><span class="ide">len</span> <span class="op">&gt;</span> <span class="num">0</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">token</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">email</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">data</span>(<span class="ide">name</span>: <span class="str">&quot;academy&quot;</span>): <span class="com"># matches data(email) with (name: &quot;academy&quot;)</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">email</span></div></div><div class="line"><div class="line-content">  <span class="ide">tokens</span>(<span class="op">@</span>[<span class="ide">_</span>, <span class="ide">_</span>, <span class="ide">_</span>, <span class="ide">_</span>, <span class="op">@</span><span class="ide">token</span>]): <span class="com"># matches tokens(email)</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">token</span></div></div>  </code></pre>
<p>(I got the idea for the email example from @andreaferretti&apos;s patty)</p>
<h3>Support for types as variants</h3>
<p>Sometimes a type acts like a variant, but isn&apos;t defined like one: you can teach the library to do it.
It uses internally <code>eKind</code> to get the kind field of a variant, so you just need to override it</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">eKind</span><span class="op">*</span>(<span class="ide">a</span>: <span class="ide">A</span>): <span class="ide">AKind</span> <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="ide">a</span><span class="op">.</span><span class="ide">stuff</span></div></div>  </code></pre>
<h3>If guards</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>);</div></div><div class="line"><div class="line-content">  (<span class="ide">b</span>: <span class="op">@</span><span class="ide">e</span>) <span class="kwd">and</span> <span class="ide">e</span> <span class="op">==</span> <span class="num">4</span>: <span class="com"># generates local variable e and checks e</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">e</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="op">-</span><span class="num">1</span></div></div>  </code></pre>
<p>We can add <code>or</code> too: does it make sense?</p>
<h3>Unification</h3>
<p>inspired by @andreaferretti&apos;s patty ideas</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">a</span> <span class="op">=</span> <span class="op">@</span>[<span class="num">0</span>, <span class="num">0</span>]</div></div><div class="line"><div class="line-content"><span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="op">@</span>[<span class="op">@</span><span class="ide">x</span>, <span class="op">@</span><span class="ide">x</span>]: <span class="com"># creates a local variable x only if both values are equal</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;equal&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;not&quot;</span></div></div>  </code></pre>
<p>We check if all the subvalues are equal: that wasn&apos;t very easy to implement</p>
<h3>Match expressions</h3>
<p>In general, <code>match</code> can be used as an expression:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">a</span> <span class="op">=</span> <span class="num">2</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">s</span> <span class="op">=</span> <span class="ide">match</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="num">2</span>:</div></div><div class="line"><div class="line-content">    <span class="str">&quot;it&apos;s a 2&quot;</span></div></div><div class="line"><div class="line-content">  <span class="ide">_</span>:</div></div><div class="line"><div class="line-content">    <span class="str">&quot;it&apos;s not a 2&quot;</span></div></div>  </code></pre>
<p>The <code>matches</code> macro allows to match against a single expression:
it returns a boolean value which is <code>true</code> when it matches the value.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">if</span> <span class="ide">a</span><span class="op">.</span><span class="ide">matches</span>((<span class="ide">b</span>: <span class="num">2</span>, <span class="ide">c</span>: <span class="num">4</span>)):</div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="num">0</span></div></div>  </code></pre>
<p>You can also have captures with <code>maybeMatches</code>: it returns an <code>Option[tuple]</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">c</span> <span class="op">=</span> <span class="ide">a</span><span class="op">.</span><span class="ide">maybeMatches</span>((<span class="ide">a</span>: <span class="op">@</span><span class="ide">a</span>, <span class="ide">b</span>: <span class="op">@</span><span class="ide">b</span>))</div></div><div class="line"><div class="line-content"><span class="kwd">if</span> <span class="ide">c</span><span class="op">.</span><span class="ide">isSome</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="ide">c</span><span class="op">.</span><span class="ide">a</span></div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="ide">c</span><span class="op">.</span><span class="ide">b</span></div></div>  </code></pre>
<h3>Plan</h3>
<ul>
<li>error reporting</li>
<li>fixes</li>
</ul>
<h3>Name</h3>
<p>gara means a train station in bulgarian. why a train station? I am travelling with trains these days, and I like bulgarian words.</p>
<h3>Questions and answers</h3>
<p>  <strong>I don&apos;t like @name : it&apos;s bizarre and surprising for users</strong></p>
<p>I like it, but I&apos;d welcome ideas for a better syntax! Please, first check this list:</p>
<ul>
<li><code>expr @ name</code> I can&apos;t see how to make it consistent with the <code>(field: capture)</code> case, the same with other binary</li>
<li><code>expr @ ``name`` </code> I think this is more surprising, as it&apos;s used for 2 different puproses in quotes and in names</li>
</ul>
<p>  <strong>It&apos;s not type safe</strong></p>
<p>I want to leave all the type checking to the Nim compiler. The library translates your patterns to Nim code, so the only problem should be that sometimes it might be hard to debug why something is failing: I&apos;ll try to improve that with error messages.</p>
<p>  <strong>It is too complicated</strong></p>
<p>I like to think it is relatively simple: I&apos;ve tried to limit new syntax and to optimize it for variants, so e.g. in <code>name(..)</code> we first check if name is enum, then type, then we assume it might be an unpacker. In the beginning I even had <code>~enum</code> syntax for matching variants, but it seemed crazy.
Otherwise a lot of custom or new functionality should be doable with unpackers or with a bit upgraded unpackers, please check them out</p>
<p>FAITH</p>
<h3>Credits</h3>
<p><a href="https://github.com/krux02/">@krux02</a> and <a href="https://github.com/andreaferretti">@andreaferretti</a> are authors of the original nim pattern matching libs:</p>
<ul>
<li>@krux02 &apos;s <a href="https://github.com/krux02/ast-pattern-matching">ast-pattern-matching</a></li>
<li>@andreaferretti &apos;s <a href="https://github.com/andreaferretti/patty">patty</a></li>
</ul>
<p>I took inspiration from their libraries and discussions (An early version of this dsl was even a PR to @krux02 &apos;s lib).</p>
<p>Thanks to <a href="https://github.com/mratsim">@mratsim</a> for giving me the <code>@name</code> idea with one of his <a href="https://github.com/nim-lang/Nim/issues/8649#issuecomment-413318800">github comments on possible nim pattern matching syntax</a>, I initially had way more inconsistent notation in mind.</p>
<p>Thanks to <a href="https://github.com/narimiran/">@narimiran</a> for giving design ideas and doc fixes!</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/alehander42/gara">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-09-01T01:11:25Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
