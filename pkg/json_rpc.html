<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">json_rpc</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">library</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">json-rpc</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">server</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">client</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">rpc</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">json</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("Nim library for implementing JSON-RPC clients and servers")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install json_rpc" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>json-rpc</h1>
<p><a href="https://opensource.org/licenses/Apache-2.0">  <img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" style="max-width: 100%;" alt="License: Apache" /></a>
<a href="https://opensource.org/licenses/MIT">  <img src="https://img.shields.io/badge/License-MIT-blue.svg" style="max-width: 100%;" alt="License: MIT" /></a>
<img src="https://img.shields.io/badge/stability-experimental-orange.svg" style="max-width: 100%;" alt="Stability: experimental" /><img src="https://github.com/status-im/nim-json-rpc/workflows/CI/badge.svg" style="max-width: 100%;" alt="Github action" /></p>
<p>Json-Rpc is a library designed to provide an easier interface for working with remote procedure calls.</p>
<h1>Usage</h1>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># In your nimble file</span></div></div><div class="line"><div class="line-content"><span class="ide">requires</span> <span class="str">&quot;json_rpc&quot;</span></div></div>  </code></pre>
<h1>Introduction</h1>
<p>Json-Rpc is a library for routing JSON 2.0 format remote procedure calls over different transports.
It is designed to automatically generate marshalling and parameter checking code based on the RPC parameter types.</p>
<h2>Routing</h2>
<p>Remote procedure calls are created using the <code>rpc</code> macro on an instance of <code>RpcRouter</code>.</p>
<p><code>rpc</code> allows you to provide a list of native Nim type parameters and a return type, generates marshalling to and from json for you, so you can concentrate on using native Nim types for your call.</p>
<p>Routing is then performed by the <code>route</code> procedure.</p>
<p>When an error occurs, the <code>error</code> is populated, otherwise <code>result</code> will be populated.</p>
<h3><code>rpc</code> Parameters</h3>
<p><code>path</code>: The string to match for the <code>method</code>.</p>
<p><code>body</code>: The parameters and code to execute for this call.</p>
<h3>Example</h3>
<p>Here&apos;s a simple example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">json_rpc</span><span class="op">/</span><span class="ide">rpcserver</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">router</span> <span class="op">=</span> <span class="ide">newRpcRouter</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">router</span><span class="op">.</span><span class="ide">rpc</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="op">%</span><span class="str">&quot;Hello&quot;</span></div></div>  </code></pre>
<p>As no return type was specified in this example, <code>result</code> defaults to the <code>JsonNode</code> type.
A JSON string is returned by passing a string though the <code>%</code> operator, which converts simple types to <code>JsonNode</code>.</p>
<p>The <code>body</code> parameters can be defined by using <a href="https://nim-lang.org/docs/manual.html#procedures-do-notation">do notation</a>.
This allows full Nim types to be used as RPC parameters.</p>
<p>Here we pass a string to an RPC and return a string.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">router</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;hello&quot;</span>) <span class="kwd">do</span>(<span class="ide">input</span>: <span class="ide">string</span>) <span class="op">-&gt;</span> <span class="ide">string</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="str">&quot;Hello &quot;</span> <span class="op">&amp;</span> <span class="ide">input</span></div></div>  </code></pre>
<p>Json-Rpc will recursively parse the Nim types in order to produce marshalling code.
This marshalling code uses the types to check the incoming JSON fields to ensure they exist and are of the correct kind.</p>
<p>The return type then performs the opposite process, converting Nim types to Json for transport.</p>
<p>Here is a more complex parameter example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">type</span></div></div><div class="line"><div class="line-content">  <span class="ide">HeaderKind</span> <span class="op">=</span> <span class="kwd">enum</span> <span class="ide">hkOne</span>, <span class="ide">hkTwo</span>, <span class="ide">hkThree</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="ide">Header</span> <span class="op">=</span> <span class="kwd">ref</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">    <span class="ide">kind</span>: <span class="ide">HeaderKind</span></div></div><div class="line"><div class="line-content">    <span class="ide">size</span>: <span class="ide">int64</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="ide">DataBlob</span> <span class="op">=</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">    <span class="ide">items</span>: <span class="ide">seq</span>[<span class="ide">byte</span>]</div></div><div class="line"><div class="line-content">    <span class="ide">headers</span>: <span class="ide">array</span>[<span class="num">3</span>, <span class="ide">Header</span>]</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="ide">MyObject</span> <span class="op">=</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">    <span class="ide">data</span>: <span class="ide">DataBlob</span></div></div><div class="line"><div class="line-content">    <span class="ide">name</span>: <span class="ide">string</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">router</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;updateData&quot;</span>) <span class="kwd">do</span>(<span class="ide">myObj</span>: <span class="ide">MyObject</span>, <span class="ide">newData</span>: <span class="ide">DataBlob</span>) <span class="op">-&gt;</span> <span class="ide">DataBlob</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="ide">myObj</span><span class="op">.</span><span class="ide">data</span></div></div><div class="line"><div class="line-content">  <span class="ide">myObj</span><span class="op">.</span><span class="ide">data</span> <span class="op">=</span> <span class="ide">newData</span></div></div>  </code></pre>
<p>Behind the scenes, all RPC calls take a single json parameter <code>param</code> that must be of kind <code>JArray</code>.
At runtime, the json is checked to ensure that it contains the correct number and type of your parameters to match the <code>rpc</code> definition.</p>
<p>Compiling with <code>-d:nimDumpRpcs</code> will show the output code for the RPC call. To see the output of the <code>async</code> generation, add <code>-d:nimDumpAsync</code>.</p>
<h3>Special type :  <code>Option[T] </code></h3>
<p>Option[T] is a special type indicating that parameter may have value or not.</p>
<ul>
<li>If optional parameters located in the middle of parameters list, you set it to <code>null</code> to tell the server that it has no value.</li>
<li>If optional parameters located at the end of parameter list and there are no more mandatory parameters after that, those optional parameters can be omitted altogether.</li>
</ul>
<pre>  <code class="language-Nim"><div class="line"><div class="line-content"><span class="com"># d can be omitted, b should use null to indicate it has no value</span></div></div><div class="line"><div class="line-content"><span class="ide">router</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;updateData&quot;</span>) <span class="kwd">do</span>(<span class="ide">a</span>: <span class="ide">int</span>, <span class="ide">b</span>: <span class="ide">Option</span>[<span class="ide">int</span>], <span class="ide">c</span>: <span class="ide">string</span>, <span class="ide">d</span>: <span class="ide">Option</span>[<span class="ide">T</span>]):</div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">b</span><span class="op">.</span><span class="ide">isSome</span>:</div></div><div class="line"><div class="line-content">    <span class="com"># do something</span></div></div><div class="line"><div class="line-content">  <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">    <span class="com"># do something else</span></div></div>  </code></pre>
<ul>
<li>If Option[T] used as return type, it also denotes the returned value might not available.</li>
</ul>
<pre>  <code class="language-Nim"><div class="line"><div class="line-content"><span class="ide">router</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;getData&quot;</span>) <span class="kwd">do</span>(<span class="ide">name</span>: <span class="ide">string</span>) <span class="op">-&gt;</span> <span class="ide">Option</span>[<span class="ide">int</span>]:</div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">name</span> <span class="op">==</span> <span class="str">&quot;monkey&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">=</span> <span class="ide">some</span>(<span class="num">4</span>)</div></div>  </code></pre>
<ul>
<li>If Option[T] used as field type of an object, it also tell us that field might be present or not, and the rpc mechanism will automatically set it to some value if it available.</li>
</ul>
<pre>  <code class="language-Nim"><div class="line"><div class="line-content"><span class="kwd">type</span></div></div><div class="line"><div class="line-content">  <span class="ide">MyOptional</span> <span class="op">=</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">    <span class="ide">maybeInt</span>: <span class="ide">Option</span>[<span class="ide">int</span>]</div></div>  </code></pre>
<h2>Marshalling</h2>
<p>Note that <code>array</code> parameters are explicitly checked for length, and will return an error node if the length differs from their declaration size.</p>
<p>If you wish to support custom types in a particular way, you can provide matching <code>fromJson</code> and <code>%</code> procedures.</p>
<h3>  <code>fromJson</code></h3>
<p>This takes a Json type and returns the Nim type.</p>
<h4>Parameters</h4>
<p><code>n: JsonNode</code>: The current node being processed</p>
<p><code>argName: string</code>: The name of the field in <code>n</code></p>
<p><code>result</code>: The type of this must be <code>var X</code> where <code>X</code> is the Nim type you wish to handle</p>
<h4>Example</h4>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">fromJson</span>[<span class="ide">T</span>](<span class="ide">n</span>: <span class="ide">JsonNode</span>, <span class="ide">argName</span>: <span class="ide">string</span>, <span class="ide">result</span>: <span class="kwd">var</span> <span class="ide">seq</span>[<span class="ide">T</span>]) <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="ide">n</span><span class="op">.</span><span class="ide">kind</span><span class="op">.</span><span class="ide">expect</span>(<span class="ide">JArray</span>, <span class="ide">argName</span>)</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="ide">newSeq</span>[<span class="ide">T</span>](<span class="ide">n</span><span class="op">.</span><span class="ide">len</span>)</div></div><div class="line"><div class="line-content">  <span class="kwd">for</span> <span class="ide">i</span> <span class="kwd">in</span> <span class="num">0</span> <span class="op">..&lt;</span> <span class="ide">n</span><span class="op">.</span><span class="ide">len</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">fromJson</span>(<span class="ide">n</span>[<span class="ide">i</span>], <span class="ide">argName</span>, <span class="ide">result</span>[<span class="ide">i</span>])</div></div>  </code></pre>
<h3>  <code>%</code></h3>
<p>This is the standard way to provide translations from a Nim type to a <code>JsonNode</code>.</p>
<h4>Parameters</h4>
<p><code>n</code>: The type you wish to convert</p>
<h4>Returns</h4>
<p><code>JsonNode</code>: The newly encoded <code>JsonNode</code> type from the parameter type.</p>
<h3>  <code>expect</code></h3>
<p>This is a simple procedure to state your expected type.</p>
<p>If the actual type doesn&apos;t match the expected type, an exception is thrown mentioning which field caused the failure.</p>
<h4>Parameters</h4>
<p><code>actual: JsonNodeKind</code>: The actual type of the <code>JsonNode</code>.</p>
<p><code>expected: JsonNodeKind</code>: The desired type.</p>
<p><code>argName: string</code>: The current field name.</p>
<h4>Example</h4>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">myNode</span><span class="op">.</span><span class="ide">kind</span><span class="op">.</span><span class="ide">expect</span>(<span class="ide">JArray</span>, <span class="ide">argName</span>)</div></div>  </code></pre>
<h2>JSON Format</h2>
<p>The router expects either a string or <code>JsonNode</code> with the following structure:</p>
<pre>  <code class="language-json">{
  &quot;id&quot;: JInt,
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;method&quot;: JString,
  &quot;params&quot;: JArray
}
</code></pre>
<p>Return values use the following node structure:</p>
<pre>  <code class="language-json">{
  &quot;id&quot;: JInt,
  &quot;jsonrpc&quot;: &quot;2.0&quot;,
  &quot;result&quot;: JsonNode,
  &quot;error&quot;: JsonNode
}
</code></pre>
<h2>Performing a route</h2>
<p>To call and RPC through the router, use the <code>route</code> procedure.</p>
<p>There are three variants of <code>route</code>.</p>
<p>Note that once invoked all RPC calls are error trapped and any exceptions raised are passed back with the error message encoded as a <code>JsonNode</code>.</p>
<h3><code>route</code> by string</h3>
<p>This <code>route</code> variant will handle all the conversion of <code>string</code> to <code>JsonNode</code> and check the format and type of the input data.</p>
<h4>Parameters</h4>
<p><code>router: RpcRouter</code>: The router object that contains the RPCs.</p>
<p><code>data: string</code>: A string ready to be processed into a <code>JsonNode</code>.</p>
<h4>Returns</h4>
<p><code>Future[string]</code>: This will be the stringified JSON response, which can be the JSON RPC result or a JSON wrapped error.</p>
<h3><code>route</code> by <code>JsonNode</code></h3>
<p>This variant allows simplified processing if you already have a <code>JsonNode</code>. However if the required fields are not present within <code>node</code>, exceptions will be raised.</p>
<h4>Parameters</h4>
<p><code>router: RpcRouter</code>: The router object that contains the RPCs.</p>
<p><code>node: JsonNode</code>: A pre-processed <code>JsonNode</code> that matches the expected format as defined above.</p>
<h4>Returns</h4>
<p><code>Future[JsonNode]</code>: The JSON RPC result or a JSON wrapped error.</p>
<h3>  <code>tryRoute</code></h3>
<p>This <code>route</code> variant allows you to invoke a call if possible, without raising an exception.</p>
<h4>Parameters</h4>
<p><code>router: RpcRouter</code>: The router object that contains the RPCs.</p>
<p><code>node: JsonNode</code>: A pre-processed <code>JsonNode</code> that matches the expected format as defined above.</p>
<p><code>fut: var Future[JsonNode]</code>: The JSON RPC result or a JSON wrapped error.</p>
<h4>Returns</h4>
<p><code>bool</code>: <code>true</code> if the <code>method</code> field provided in <code>node</code> matches an available route. Returns <code>false</code> when the <code>method</code> cannot be found, or if <code>method</code> or <code>params</code> field cannot be found within <code>node</code>.</p>
<p>To see the result of a call, we need to provide Json in the expected format.
Here&apos;s an example of how that looks by manually creating the JSON. Later we will see the helper utilities that make this easier.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">call</span> <span class="op">=</span> <span class="op">%*</span>{</div></div><div class="line"><div class="line-content">  <span class="str">&quot;id&quot;</span>: <span class="op">%</span><span class="num">1</span>,</div></div><div class="line"><div class="line-content">  <span class="str">&quot;jsonrpc&quot;</span>: <span class="op">%</span><span class="num">2.0</span>,</div></div><div class="line"><div class="line-content">  <span class="str">&quot;method&quot;</span>: <span class="op">%</span><span class="str">&quot;hello&quot;</span>,</div></div><div class="line"><div class="line-content">  <span class="str">&quot;params&quot;</span>: <span class="op">%</span>[<span class="str">&quot;Terry&quot;</span>]</div></div><div class="line"><div class="line-content">  }</div></div><div class="line"><div class="line-content"><span class="com"># route the call we defined earlier</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">localResult</span> <span class="op">=</span> <span class="ide">waitFor</span> <span class="ide">router</span><span class="op">.</span><span class="ide">route</span>(<span class="ide">call</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">localResult</span></div></div><div class="line"><div class="line-content"><span class="com"># We should see something like this</span></div></div><div class="line"><div class="line-content"><span class="com">#   {&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;result&quot;:&quot;Hello Terry&quot;,&quot;error&quot;:null}</span></div></div>  </code></pre>
<h1>Server</h1>
<p>In order to make routing useful, RPCs must be invoked and transmitted over a transport.</p>
<p>The <code>RpcServer</code> type is given as a simple inheritable wrapper/container that simplifies designing your own transport layers using the <code>router</code> field.</p>
<h2>Server Transports</h2>
<p>Currently there are plans for the following transports to be implemented:</p>
<ul>
<li>[x] Sockets</li>
<li>[x] HTTP</li>
<li>[ ] IPC</li>
<li>[x] Websockets</li>
</ul>
<p>Transport specific server need only call the <code>route</code> procedure using a string fetched from the transport in order to invoke the requested RPC.</p>
<h2>Server example</h2>
<p>This example uses the socket transport defined in <code>socket.nim</code>.
Once executed, the &quot;hello&quot; RPC will be available to a socket based client.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">json_rpc</span><span class="op">/</span><span class="ide">rpcserver</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Create a socket server for transport</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">srv</span> <span class="op">=</span> <span class="ide">newRpcSocketServer</span>(<span class="str">&quot;localhost&quot;</span>, <span class="ide">Port</span>(<span class="num">8585</span>))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># srv.rpc is a shortcut for srv.router.rpc</span></div></div><div class="line"><div class="line-content"><span class="ide">srv</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;hello&quot;</span>) <span class="kwd">do</span>(<span class="ide">input</span>: <span class="ide">string</span>) <span class="op">-&gt;</span> <span class="ide">string</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="str">&quot;Hello &quot;</span> <span class="op">&amp;</span> <span class="ide">input</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">srv</span><span class="op">.</span><span class="ide">start</span>()</div></div><div class="line"><div class="line-content"><span class="ide">runForever</span>()</div></div>  </code></pre>
<h1>Client</h1>
<p>Json-Rpc also comes with a client implementation, built to provide a framework for transports to work with.</p>
<p>To simplify demonstration, we will use the socket transport defined in <code>socketclient.nim</code>.</p>
<p>Below is the most basic way to use a remote call on the client.
Here we manually supply the name and json parameters for the call.</p>
<p>The <code>call</code> procedure takes care of the basic format of the JSON to send to the server.
However you still need to provide <code>params</code> as a <code>JsonNode</code>, which must exactly match the parameters defined in the equivalent <code>rpc</code> definition.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">json_rpc</span><span class="op">/</span>[<span class="ide">rpcclient</span>, <span class="ide">rpcserver</span>], <span class="ide">chronos</span>, <span class="ide">json</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span></div></div><div class="line"><div class="line-content">  <span class="ide">server</span> <span class="op">=</span> <span class="ide">newRpcSocketServer</span>(<span class="str">&quot;localhost&quot;</span>, <span class="ide">Port</span>(<span class="num">8545</span>))</div></div><div class="line"><div class="line-content">  <span class="ide">client</span> <span class="op">=</span> <span class="ide">newRpcSocketClient</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">server</span><span class="op">.</span><span class="ide">start</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">server</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;hello&quot;</span>) <span class="kwd">do</span>(<span class="ide">input</span>: <span class="ide">string</span>) <span class="op">-&gt;</span> <span class="ide">string</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> <span class="str">&quot;Hello &quot;</span> <span class="op">&amp;</span> <span class="ide">input</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">waitFor</span> <span class="ide">client</span><span class="op">.</span><span class="ide">connect</span>(<span class="str">&quot;localhost&quot;</span>, <span class="ide">Port</span>(<span class="num">8545</span>))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">response</span> <span class="op">=</span> <span class="ide">waitFor</span> <span class="ide">client</span><span class="op">.</span><span class="ide">call</span>(<span class="str">&quot;hello&quot;</span>, <span class="op">%</span>[<span class="op">%</span><span class="str">&quot;Daisy&quot;</span>])</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># the call returns a `Response` type which contains the result</span></div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">response</span><span class="op">.</span><span class="ide">result</span></div></div>  </code></pre>
<h3>  <code>createRpcSigs</code></h3>
<p>To make things more readable and allow better static checking client side, Json-Rpc supports generating wrappers for client RPCs using <code>createRpcSigs</code>.</p>
<p>This macro takes a type name and the path of a file containing forward declarations of procedures that you wish to convert to client RPCs. The transformation generates procedures that match the forward declarations provided, plus a <code>client</code> parameter in the specified type.</p>
<p>Because the signatures are parsed at compile time, the file will be error checked and you can use import to share common types between your client and server.</p>
<h4>Parameters</h4>
<p><code>clientType</code>: This is the type you want to pass to your generated calls. Usually this would be a transport specific descendant from <code>RpcClient</code>.</p>
<p><code>path</code>: The path to the Nim module that contains the RPC header signatures.</p>
<h4>Example</h4>
<p>For example, to support this remote call:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">server</span><span class="op">.</span><span class="ide">rpc</span>(<span class="str">&quot;bmi&quot;</span>) <span class="kwd">do</span>(<span class="ide">height</span>, <span class="ide">weight</span>: <span class="ide">float</span>) <span class="op">-&gt;</span> <span class="ide">float</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result</span> <span class="op">=</span> (<span class="ide">height</span> <span class="op">*</span> <span class="ide">height</span>) <span class="op">/</span> <span class="ide">weight</span></div></div>  </code></pre>
<p>You can have the following in your rpc signature file:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">bmi</span>(<span class="ide">height</span>, <span class="ide">weight</span>: <span class="ide">float</span>): <span class="ide">float</span></div></div>  </code></pre>
<p>When parsed through <code>createRpcSigs</code>, you can call the RPC as if it were a normal procedure.
So instead of this:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">bmiIndex</span> <span class="op">=</span> <span class="ide">await</span> <span class="ide">client</span><span class="op">.</span><span class="ide">call</span>(<span class="str">&quot;bmi&quot;</span>, <span class="op">%</span>[<span class="op">%</span><span class="num">120.5</span>, <span class="op">%</span><span class="num">12.0</span>])</div></div>  </code></pre>
<p>You can use:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">bmiIndex</span> <span class="op">=</span> <span class="ide">await</span> <span class="ide">client</span><span class="op">.</span><span class="ide">bmi</span>(<span class="num">120.5</span>, <span class="num">12.0</span>)</div></div>  </code></pre>
<p>This allows you to leverage Nim&apos;s static type checking whilst also aiding readability and providing a unified location to declare client side RPC definitions.</p>
<h2>Working with client transports</h2>
<p>Transport clients should provide a type that is inherited from <code>RpcClient</code> where they can store any transport related information.</p>
<p>Additionally, the following two procedures are useful:</p>
<ul>
<li>
<p>  <code>Call</code></p>
<p><code>self</code>: a descendant of <code>RpcClient</code>
<code>name: string</code>: the method to be called
<code>params: JsonNode</code>: The parameters to the RPC call
Returning
<code>Future[Response]</code>: A wrapper for the result <code>JsonNode</code> and a flag to indicate if this contains an error.</p>
</li>
</ul>
<p>Note: Although <code>call</code> isn&apos;t necessary for a client to function, it allows RPC signatures to be used by the <code>createRpcSigs</code>.</p>
<ul>
<li>
<p>  <code>Connect</code></p>
<p><code>client</code>: a descendant of <code>RpcClient</code>
Returning
<code>FutureBase</code>: The base future returned when a procedure is annoted with <code>{.async.}</code></p>
</li>
</ul>
<h3>  <code>processMessage</code></h3>
<p>To simplify and unify processing within the client, the <code>processMessage</code> procedure can be used to perform conversion and error checking from the received string originating from the transport to the <code>JsonNode</code> representation that is passed to the RPC.</p>
<p>After a RPC returns, this procedure then completes the futures set by <code>call</code> invocations using the <code>id</code> field of the processed <code>JsonNode</code> from <code>line</code>.</p>
<h4>Parameters</h4>
<p><code>self</code>: a client type descended from <code>RpcClient</code></p>
<p><code>line: string</code>: a string that contains the JSON to be processed</p>
<h1>Contributing</h1>
<p>Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.</p>
<p>Please make sure to update tests as appropriate.</p>
<h2>License</h2>
<p>Licensed and distributed under either of</p>
<ul>
<li>MIT license: <a href="LICENSE-MIT">LICENSE-MIT</a> or http://opensource.org/licenses/MIT</li>
</ul>
<p>or</p>
<ul>
<li>Apache License, Version 2.0, (<a href="LICENSE-APACHEv2">LICENSE-APACHEv2</a> or http://www.apache.org/licenses/LICENSE-2.0)</li>
</ul>
<p>at your option. This file may not be copied, modified, or distributed except according to those terms.</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        Apache License 2.0
                    </p>
                

                
                    <p> <a href="https://github.com/status-im/nim-json-rpc">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-07-10T01:47:37Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
