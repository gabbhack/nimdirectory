<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">contracts</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">library</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">pure</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">contract</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">contracts</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">DbC</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">utility</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">automation</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">documentation</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">safety</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">test</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">tests</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">unit-testing</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("Design by Contract (DbC) library with minimal runtime.")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install contracts" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>Contracts</h1>
<p><a href="https://github.com/Udiknedormin/NimContracts/actions/workflows/test.yml">  <img src="https://github.com/Udiknedormin/NimContracts/actions/workflows/test.yml/badge.svg" style="max-width: 100%;" alt="test" /></a>
<a href="https://github.com/yglukhov/nimble-tag">  <img src="https://raw.githubusercontent.com/yglukhov/nimble-tag/master/nimble_js.png" style="max-width: 100%;" alt="nimble" /></a></p>
<p>This module is used to make contracts â€“ elegant promises that
pieces of code will fulfill certain conditions.</p>
<p>Contracts are essentially value counterparts of type-based concepts,
generic bounds, type attributes (e.x. <code>not nil</code>) etc. While they
work similarly to assertions, as they throw exceptions when broken,
main reasons for using contracts include elegance of code, clarity
of exception messages, intuitive semantics and ease of analysis,
both for human and external tools.</p>
<p>As usage of this module isn&apos;t typical and some extra rules are
applied, aside from documentation for each of module&apos;s elements
the description of the module as a whole is included.</p>
<h2>Where could I hear about it?</h2>
<p>Contracts and static analysis were briefly mentioned in
<a href="https://nim-lang.org/blog/2020/06/08/static-analysis.html">June 8th 2020 Nim blog post</a>
and
<a href="https://nim-lang.org/blog/2020/04/03/version-120-released.html">Nim v1.2.0 changelog</a>
(it actually uses similar names, <code>requires</code> vs <code>require</code>).
<a href="https://nim-lang.org/docs/drnim.html">DrNim (by Araq)</a>
project uses such concepts too.</p>
<h2>Hello contracts</h2>
<p>For most of the features of this module, <code>contractual</code> macro should
be used. As it generates exception-raising code, some exceptions
should be imported too. For now, importing whole module is advised
(at least until the submodules are introduced).</p>
<p>Example usage (hello world equivalent):</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">contracts</span></div></div><div class="line"><div class="line-content"><span class="kwd">from</span> <span class="ide">math</span> <span class="kwd">import</span> <span class="ide">sqrt</span>, <span class="ide">floor</span></div></div><div class="line"><div class="line-content">    </div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">isqrt</span>[<span class="ide">T</span>: <span class="ide">SomeInteger</span>](<span class="ide">x</span>: <span class="ide">T</span>): <span class="ide">T</span> {<span class="op">.</span><span class="ide">contractual</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="ide">require</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">x</span> <span class="op">&gt;=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content">  <span class="ide">ensure</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">*</span> <span class="ide">result</span> <span class="op">&lt;=</span> <span class="ide">x</span></div></div><div class="line"><div class="line-content">    (<span class="ide">result</span><span class="op">+</span><span class="num">1</span>) <span class="op">*</span> (<span class="ide">result</span><span class="op">+</span><span class="num">1</span>) <span class="op">&gt;</span> <span class="ide">x</span></div></div><div class="line"><div class="line-content">  <span class="ide">body</span>:</div></div><div class="line"><div class="line-content">    (<span class="ide">T</span>)(<span class="ide">x</span><span class="op">.</span><span class="ide">toBiggestFloat</span>()<span class="op">.</span><span class="ide">sqrt</span>()<span class="op">.</span><span class="ide">floor</span>()<span class="op">.</span><span class="ide">toBiggestInt</span>())</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">isqrt</span>(<span class="num">18</span>)  <span class="com"># prints 4</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">isqrt</span>(<span class="op">-</span><span class="num">8</span>)  <span class="com"># runtime error:</span></div></div><div class="line"><div class="line-content">                <span class="com">#   broke &apos;x &gt;= 0&apos; promised at FILE.nim(LINE,COLUMN)</span></div></div><div class="line"><div class="line-content">                <span class="com">#   [PreConditionError]</span></div></div>  </code></pre>
<h2>Overview</h2>
<p>It is advised to use contracts as part of a fine documentation.
Even when disabled by a switch or pragma, they still look good
and describe one&apos;s intentions well. Thanks to that, the code is
often much easier to read even without comments. Also,  a reader
experienced in contractual design (and prefferably Nim) can read
them faster than natural language as they are more compact.</p>
<p>Consider finding key&apos;s position in a sorted array:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">contractual</span>:</div></div><div class="line"><div class="line-content">   <span class="kwd">var</span> <span class="ide">a</span> <span class="op">=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content">   <span class="kwd">var</span> <span class="ide">b</span> <span class="op">=</span> <span class="ide">arr</span><span class="op">.</span><span class="ide">len</span><span class="op">-</span><span class="num">1</span></div></div><div class="line"><div class="line-content">   <span class="kwd">while</span> <span class="ide">a</span> <span class="op">&lt;</span> <span class="ide">b</span>:</div></div><div class="line"><div class="line-content">     <span class="ide">invariant</span>:</div></div><div class="line"><div class="line-content">       <span class="kwd">if</span> <span class="ide">key</span> <span class="kwd">in</span> <span class="ide">arr</span>: <span class="ide">key</span> <span class="kwd">in</span> <span class="ide">arr</span>[<span class="ide">a</span><span class="op">..</span><span class="ide">b</span>]</div></div><div class="line"><div class="line-content">       <span class="ide">abs</span>(<span class="ide">a</span> <span class="op">-</span> <span class="ide">b</span>) <span class="op">&lt;</span> `<span class="ide">abs</span>(<span class="ide">a</span> <span class="op">-</span> <span class="ide">b</span>)`</div></div><div class="line"><div class="line-content">     <span class="ide">ensure</span>:</div></div><div class="line"><div class="line-content">       <span class="kwd">if</span> <span class="ide">key</span> <span class="kwd">in</span> <span class="ide">arr</span>: <span class="ide">key</span> <span class="op">==</span> <span class="ide">arr</span>[<span class="ide">a</span>]</div></div><div class="line"><div class="line-content">     <span class="ide">body</span>:</div></div><div class="line"><div class="line-content">       <span class="kwd">let</span> <span class="ide">mid</span> <span class="op">=</span> (<span class="ide">a</span> <span class="op">+</span> <span class="ide">b</span>) <span class="kwd">div</span> <span class="num">2</span></div></div><div class="line"><div class="line-content">       <span class="kwd">if</span> <span class="ide">arr</span>[<span class="ide">mid</span>] <span class="op">&lt;</span> <span class="ide">key</span>:</div></div><div class="line"><div class="line-content">         <span class="ide">a</span> <span class="op">=</span> <span class="ide">mid</span> <span class="op">+</span> <span class="num">1</span></div></div><div class="line"><div class="line-content">       <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">         <span class="ide">b</span> <span class="op">=</span> <span class="ide">mid</span></div></div>  </code></pre>
<p>The first loop invariant is rather obvious. The other one is also
intuitive if we know this module uses &apos;`&apos; character meaning roundly
&quot;previously&quot; (in last iteration or yield, can also be used in postconditions
to refer to values seen by preconditions). Actually, we could
strengthen our invariants by adding information about how fast
the range shrinks but it&apos;s not necessary to prove the algorithm
works (although it is needed to prove how efficient it is).</p>
<p>While contracts can be of great help, they require care, especially
when object-oriented behaviour is expected. For present version,
one has to follow certain rules described in
<a href="#object-oriented-contracts">Object-Oriented Contracts</a>
section (in the future they will be followed automatically).</p>
<h2>Contractual context</h2>
<p>As already mentioned, for most of this module&apos;s features to actually
work, the code has to be inside of a <code>contractual</code> block. For callables,
it can be applied as a pragma.</p>
<p>Syntax:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">contractual</span>:</div></div><div class="line"><div class="line-content">   <span class="op">...</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"> <span class="kwd">proc</span> <span class="op">...</span> {<span class="op">.</span><span class="ide">contractual</span><span class="op">.</span>} <span class="op">=</span> <span class="op">...</span></div></div>  </code></pre>
<p>There are several Contractual Contexts (CoCo) inside of <code>contractual</code>
block. They are bound to plain Nim code blocks, so no additional marking
is needed. CoCo include:</p>
<ul>
<li><code>proc</code> is <code>procedure</code>, <code>converter</code> or <code>method</code> declaration</li>
<li><code>loop</code> is <code>iterator</code> declaration or either <code>for</code> or <code>while</code> loop</li>
<li><code>type</code> is <code>type</code> declaration (to be used in future versions)</li>
</ul>
<p>It is advised, although not needed, to use <code>contractual</code> block
for whole modules and any modules that utilize them.</p>
<h2>Context keywords</h2>
<table>
<thead>
<tr>
<th>Keyword</th>
<th align="center">Related to</th>
<th align="center">Semantics</th>
<th align="center">proc</th>
<th align="center">loop</th>
<th align="center">type</th>
</tr>
</thead>
<tbody>
<tr>
<td>require</td>
<td align="center">PreCondition</td>
<td align="center">is needed</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">no</td>
</tr>
<tr>
<td>invariant</td>
<td align="center">Invariant</td>
<td align="center">doesn&apos;t change</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">yes</td>
</tr>
<tr>
<td>ensure</td>
<td align="center">PostCondition</td>
<td align="center">is provided</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">no</td>
</tr>
<tr>
<td>body</td>
<td align="center">implementation</td>
<td align="center">how it is done</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">no</td>
</tr></tbody></table>
<p>Sections should be used in the same order as in the table above.</p>
<p>There is also <code>promise</code> keyword (related to CustomContract) which
describes any conditions and as the only one doesn&apos;t require being
used in <code>contractual</code>. Its usage discouraged if any other CoCo
would do as its less descriptive and have no additional rules to it
but for the assertion.</p>
<h2>Other features</h2>
<p>This module also includes a few non-context tools:</p>
<ul>
<li><code>ghost</code> makes a block of code active only when contracts are turned on</li>
<li><code>forall</code> and <code>forsome</code> represent quantifiers</li>
<li><code>assume</code> is used for assumptions for human reader and external tools
(no code generated)</li>
<li><code>promise</code> makes custom contracts</li>
</ul>
<h2>Documentation</h2>
<p>Contracts can be treated as a part of the signature of the routine
or type associated with it. Due to that, this module can generate
additional code block for the entity&apos;s documentation so that the code
would blend in with the signature.</p>
<p>Example code:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">isqrt</span>[<span class="ide">T</span>: <span class="ide">SomeInteger</span>](<span class="ide">x</span>: <span class="ide">T</span>): <span class="ide">T</span> {<span class="op">.</span><span class="ide">contractual</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">   <span class="com">## Integer square root function.</span></div></div><div class="line"><div class="line-content">   <span class="ide">require</span>:</div></div><div class="line"><div class="line-content">     <span class="ide">x</span> <span class="op">&gt;=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content">   <span class="ide">ensure</span>:</div></div><div class="line"><div class="line-content">     <span class="ide">result</span> <span class="op">&gt;=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content">     <span class="ide">result</span> <span class="op">*</span> <span class="ide">result</span> <span class="op">&lt;=</span> <span class="ide">x</span></div></div><div class="line"><div class="line-content">     (<span class="ide">result</span><span class="op">+</span><span class="num">1</span>) <span class="op">*</span> (<span class="ide">result</span><span class="op">+</span><span class="num">1</span>) <span class="op">&gt;</span> <span class="ide">x</span></div></div><div class="line"><div class="line-content">   <span class="ide">body</span>:</div></div><div class="line"><div class="line-content">     (<span class="ide">T</span>)(<span class="ide">x</span><span class="op">.</span><span class="ide">toBiggestFloat</span>()<span class="op">.</span><span class="ide">sqrt</span>()<span class="op">.</span><span class="ide">floor</span>()<span class="op">.</span><span class="ide">toBiggestInt</span>())</div></div>  </code></pre>
<p>Generated docs:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">isqrt</span>[<span class="ide">T</span>: <span class="ide">SomeInteger</span>](<span class="ide">x</span>: <span class="ide">T</span>): <span class="ide">T</span></div></div>  </code></pre>
<blockquote>
<pre>  <code class="language-nim">   requires:
     x &gt;= 0
   ensures:
     result &gt;= 0
     result * result &lt;= x
     (result+1) * (result+1) &gt; x
</code></pre>
<p>Integer square root function.</p>
</blockquote>
<p>Doc comments can be added anywhere between contractual sections,
they will be treated just like when written in one place.</p>
<p>Contracts docs generation can be disabled using <code>noContractsDocs</code>
compilation flag.</p>
<h2>Diagnostics</h2>
<p>To diagnose contracts, use <code>explainContracts</code> compile flag.
It provides diagnostic informations about contracts, according to its
numerical value:</p>
<ul>
<li>0: None (default) --- doesn&apos;t show any diagnostics</li>
<li>1: Output (when flag defined but has no value) --- show final code</li>
<li>2: Basic --- show both source and final code</li>
<li>3: Verbose --- as Basic + show each type
of contract detected for the entity (directly or indirectly).</li>
</ul>
<h2>Non-obvious goodies</h2>
<p>Nim has an undocumented problem with JS <code>deepCopy</code> implementation lacking.
Contracts uses its own implementation of <code>deepCopy</code> for JS backend, thus
solving the problem. Thanks to that, &quot;previous values&quot; can be used on JS
backend just like on C or C++ ones.</p>
<h2>Future</h2>
<h3>Exception awareness</h3>
<p>As for now, contracts cannot refer to exceptions, although it is planned
for future versions to enable such a feature. In core Nim, it is possible
to inform about what types of exceptions can be throw in the callable.
However, there is no possibility to express what conditions should be
met for these exceptions to be thrown. Additionally, it should be possible
to specify what conditions will be true if an exception raises (notice they
are not necessarily the same conditions).</p>
<h3>Object-Oriented Contracts</h3>
<p>New context <code>type</code> is planned for future versions. With it&apos;s introduction
both <code>proc</code> and <code>loop</code> contexts will be changed to force object-oriented
rules. For now, user should follow them manually.</p>
<table>
<thead>
<tr>
<th>contract</th>
<th align="center">containing</th>
<th align="center">inheritance</th>
</tr>
</thead>
<tbody>
<tr>
<td>type invariant</td>
<td align="center">added</td>
<td align="center">?</td>
</tr>
<tr>
<td>pre-condition</td>
<td align="center">added</td>
<td align="center">alternative</td>
</tr>
<tr>
<td>loop invariant</td>
<td align="center">added</td>
<td align="center">added</td>
</tr>
<tr>
<td>post-condition</td>
<td align="center">added</td>
<td align="center">added</td>
</tr></tbody></table>
<h2>Comparison to other libraries</h2>
<h3>Nim built-in pragmas</h3>
<p>Nim itself defines some contract pragmas, including <code>requires</code>, <code>ensures</code>,
<code>assume</code>, <code>assert</code>, <code>invariant</code>. Note how many of them are very similar to
those used by Contracts. However, these do not generate any runtime checks
and are there only to be inspected by external tools. In comparison,
Contracts actually generates runtime checks with meaningful errors.</p>
<p>If some tooling starts actually using these pragmas, Contracts might get an
option to inject these pragmas too, so that external tooling can use them.</p>
<h3>Contra</h3>
<p>Contra is overall a much more minimalistic project when it comes to
contracts, both feature-wise and user-experience-wise. Listing the
differences briefly:</p>
<ul>
<li>foolproofness
<ul>
<li>Contra asks the user to use particular code order (preconditions, then
postconditions, then main code). Contracts actually enforces these
rules.</li>
<li>Contra errors on import for unsuported targets. Contracts only errors
if the user uses features that cannot be supported on the given target,
and when it does, it generates a meaningful error message.</li>
</ul>
</li>
<li>types of contracts
<ul>
<li>Contra only provides preconditions and postconditions for procs
and iterators. Contracts also have loop and iterator invariants (and
some plans for object and methods inheritance support).</li>
<li>Contra doesn&apos;t provide the &quot;old/previous value&quot; feature. Contracts does.</li>
<li>Contra can only handle unconditional contracts, i.e. returning bools.
Contracts can also handle conditional contracts (functionally equivalent
to <code>if contract_cond: cond else: true</code>, but semantically different).</li>
</ul>
</li>
<li>documentation
<ul>
<li>Contra can only generate documentation for preconditions (and only
in some cases). Contracts generate documentation for all signature-like
contracts (preconditions, postconditions, invariants) by default.</li>
</ul>
</li>
<li>errors
<ul>
<li>Contra uses <code>AssertionError</code>. Contracts uses a separate error type
hierarchy with separate types for e.g. preconditions and postconditions.
That way, the user can treat caller errors (i.e. breaking preconditions)
differently from the provider errors (i.e. breaking postconditions).</li>
<li>Contra only shows the number of contract that has been broken and only
stringifies the condition for preconditions. Contracts stringifies all
the contracts in its error messages.</li>
<li>Contra only shows the location of the contract&apos;s code when abused.
Contracts provides it for all contracts by default.</li>
</ul>
</li>
<li>additional contract-related features
<ul>
<li>Contra doesn&apos;t have &quot;ghost code&quot; feature (i.e. code that is only
generated if runtime contracts checks are enabled), although the user
can replicate it with a <code>when defined(contracts):</code> statement. Contracts
does and actually implements <code>ghost</code> in a similar way.</li>
<li>Contra doesn&apos;t define any contract-related helper functions, such as
<code>forall</code> and <code>forsome</code> (although <code>sequtils.allIt</code> and <code>sequtils.anyIt</code>
can be used). Contracts does.</li>
</ul>
</li>
<li>other features
<ul>
<li>Contra defines some debug printing optimizations with term rewriting.
Contracts does not, it&apos;s a library purely for design-by-contract.</li>
<li>Contra defines some assert-and-print-generated-code funcionality.
Contracts does not, it&apos;s a high-level library.</li>
<li>Contra defines some immutability-related tools.
Contracts does not, it&apos;s programming style-agnostic.</li>
</ul>
</li>
<li>support
<ul>
<li>Both Contra and Contracts fully suppor compile-time execution
(<code>{.compiletime.}</code> and <code>static</code>)</li>
<li>Contra seems to have problems for JavaScript target on Nim &gt;1.0.
Contracts supports all of it features on JavaScript target.</li>
<li>Contra seems to have problems for NimScript target on Nim &gt; 1.0.
Contracts supports its basic features on NimScript target
(&quot;old/previous values&quot; feature cannot be used though).</li>
</ul>
</li>
</ul>
<h4>FAQ</h4>
<ul>
<li>
<p>What about <code>assume</code> blocks?</p>
<ul>
<li>Contra: Assume blocks produce no code at all and are only meant for
human reading only, you can do that using discard or similar contruct
on Nim. KISS.</li>
<li>Contracts: False. <code>assume</code> blocks are for both humans and static analysis
tools. They are also checked semantically and type-wise, unlike comments
or strings, but generate no code whatsoever, unlike actual code put in
discard (which can but doesn&apos;t have to be optimised away). What&apos;s more,
no static analysis tool can just guess than some string or discard is
assumed to represent an assumption. Unless it&apos;s marked by a variable&apos;s
name or a comment, human readers can&apos;t always do that either.</li>
</ul>
</li>
<li>
<p>What about <code>body</code> blocks?</p>
<ul>
<li>Contra: does NOT uses nor needs body blocks.</li>
<li>Contracts: does not in fact &quot;need&quot; them. They are used mostly for
aesthetic reasons and user experience of users coming from languages that
use them, like Ada or Cobra. It may even get optional in future releases.</li>
</ul>
</li>
<li>
<p>What about <code>invariant</code> blocks?</p>
<ul>
<li>Contra: You can pass Invariants on the <code>postconditions</code> block.</li>
<li>Contracts: False. Invariants only make sense for loops and iterators (for
procs they&apos;re essentially just copying the same condition as both
precondition and postcondition). Both libraries implement postconditions
with a <code>defer</code> statement, which means it only runs after the return, not
after each <code>yield</code>, like an <code>invariant</code> is supposed to.</li>
</ul>
</li>
<li>
<p>What about <code>forall</code> and <code>forsome</code> blocks?</p>
<ul>
<li>Contra: Use <code>sequtils.filterIt</code>, <code>sequtils.mapIt</code>, <code>sequtils.keepItIf</code>,
<code>sequtils.allIt</code>, <code>sequtils.anyIt</code>, etc.</li>
<li>Contracts: True. <code>forall</code> and <code>forsome</code> are implementation-wise very
close to <code>sequtils.allIt</code> and <code>sequtils.anyIt</code> (even their documentation
say so). They were created first and foremost to improve readability,
because Contracts assumes the more readable and self-explanatory
the better, especially considering it&apos;s part of the docs. It also
improves user experience for users coming from language which have such
features, e.g. Ada and Cobra.</li>
</ul>
</li>
<li>
<p>What about <code>ghost</code> block?</p>
<ul>
<li>Contra: Use <code>when defined(release):</code> or <code>when defined(contracts):</code></li>
<li>Contracts: True. <code>ghost</code> is actually implemented as <code>when ghostly():</code>.
Introducing it serves two main reasons: to make it usable as a pragma
and to improve user experience for users coming from Ada, which supports
<code>ghost</code>.</li>
</ul>
</li>
<li>
<p>Whats the performance and speed cost of using Contra and Contracts?</p>
<ul>
<li>Contra: Zero cost at runtime, since it produces no code at all when build
for Release.</li>
<li>Contracts: True for both, the approach is very similar.</li>
</ul>
</li>
<li>
<p>How to use Contra and Contracts at Compile Time?</p>
<ul>
<li>Contra: Add <code>{.compiletime.}</code> or <code>static:</code>.</li>
<li>Contracts: True for both. Note that <code>{.compiletime.}</code> procs cannot be
used outside of other <code>{.compiletime.}</code>, macros and <code>static</code> blocks,
because they do not exist at runtime. Using them elsewhere triggers
a not-so-obvious error <code>request to generate code for .compileTime proc</code>.</li>
</ul>
</li>
</ul>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/Udiknedormin/NimContracts">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-08-09T01:19:17Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
