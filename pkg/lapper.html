<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">lapper</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">interval</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("fast interval overlaps")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install lapper" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><p>simple, fast interval searches for nim</p>
<p>This uses a binary search in a sorted list of intervals along with knowledge of the longest interval.
It works when the size of the largest interval is smaller than the average distance between intervals.
As that ratio of largest-size::mean-distance increases, the performance decreases.
On realistic (for my use-case) data, this is 1000 times faster to query results and &gt;5000
times faster to check for presence than a brute-force method.</p>
<p>Lapper also has a special case <code>seek</code> method when we know that the queries will be in order.
This method uses a cursor to indicate that start of the last search and does a linear search
from that cursor to find matching intervals. This gives an additional 2-fold speedup over
the <code>find</code> method.</p>
<p>API docs and examples in <code>nim-doc</code> format are available <a href="https://brentp.github.io/nim-lapper/index.html">here</a></p>
<p>See the <code>Performance</code> section for how large the intervals can be and still get a performance
benefit.</p>
<p>To use this, it&apos;s simply required that your type have a <code>start(m) int</code> and <code>stop(m) int</code> method to satisfy
the <a href="https://nim-lang.org/docs/manual.html#generics-concepts">concept</a> used by <code>Lapper</code></p>
<p>You can install this with <code>nimble install lapper</code>.</p>
<h2>Example</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">lapper</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">strutils</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># define an appropriate data-type. it must have a `start(m) int` and `stop(m) int` method.</span></div></div><div class="line"><div class="line-content"><span class="com">#type myinterval = tuple[start:int, stop:int, val:int]</span></div></div><div class="line"><div class="line-content"><span class="com"># if we want to modify the result, then we have to use a ref object type</span></div></div><div class="line"><div class="line-content"><span class="kwd">type</span> <span class="ide">myinterval</span> <span class="op">=</span> <span class="kwd">ref</span> <span class="kwd">object</span></div></div><div class="line"><div class="line-content">  <span class="ide">start</span>: <span class="ide">int</span></div></div><div class="line"><div class="line-content">  <span class="ide">stop</span>: <span class="ide">int</span></div></div><div class="line"><div class="line-content">  <span class="ide">val</span>: <span class="ide">int</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">start</span>(<span class="ide">m</span>: <span class="ide">myinterval</span>): <span class="ide">int</span> {<span class="op">.</span><span class="ide">inline</span><span class="op">.</span>} <span class="op">=</span> <span class="kwd">return</span> <span class="ide">m</span><span class="op">.</span><span class="ide">start</span></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">stop</span>(<span class="ide">m</span>: <span class="ide">myinterval</span>): <span class="ide">int</span> {<span class="op">.</span><span class="ide">inline</span><span class="op">.</span>} <span class="op">=</span> <span class="kwd">return</span> <span class="ide">m</span><span class="op">.</span><span class="ide">stop</span></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> `<span class="op">$</span>`(<span class="ide">m</span>:<span class="ide">myinterval</span>): <span class="ide">string</span> <span class="op">=</span> <span class="kwd">return</span> <span class="str">&quot;(start:$#, stop:$#, val:$#)&quot;</span> <span class="op">%</span> [<span class="op">$</span><span class="ide">m</span><span class="op">.</span><span class="ide">start</span>, <span class="op">$</span><span class="ide">m</span><span class="op">.</span><span class="ide">stop</span>, <span class="op">$</span><span class="ide">m</span><span class="op">.</span><span class="ide">val</span>]</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># create some fake data</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">ivs</span> <span class="op">=</span> <span class="ide">new_seq</span>[<span class="ide">myinterval</span>]()</div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">i</span> <span class="kwd">in</span> <span class="ide">countup</span>(<span class="num">0</span>, <span class="num">100</span>, <span class="num">10</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">ivs</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">myinterval</span>(<span class="ide">start</span>:<span class="ide">i</span>, <span class="ide">stop</span>:<span class="ide">i</span> <span class="op">+</span> <span class="num">15</span>, <span class="ide">val</span>:<span class="num">0</span>))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># make the Lapper &quot;data-structure&quot;</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">l</span> <span class="op">=</span> <span class="ide">lapify</span>(<span class="ide">ivs</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">empty</span>:<span class="ide">seq</span>[<span class="ide">myinterval</span>]</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">assert</span> <span class="ide">l</span><span class="op">.</span><span class="ide">find</span>(<span class="num">10</span>, <span class="num">20</span>, <span class="ide">empty</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">notfound</span> <span class="op">=</span> <span class="kwd">not</span> <span class="ide">l</span><span class="op">.</span><span class="ide">find</span>(<span class="num">200</span>, <span class="num">300</span>, <span class="ide">empty</span>)</div></div><div class="line"><div class="line-content"><span class="ide">assert</span> <span class="ide">notfound</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">res</span> <span class="op">=</span> <span class="ide">new_seq</span>[<span class="ide">myinterval</span>]()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># find is the more general case, l.seek gives a speed benefit when consecutive queries are in order.</span></div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">l</span><span class="op">.</span><span class="ide">find</span>(<span class="num">50</span>, <span class="num">70</span>, <span class="ide">res</span>)</div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">res</span></div></div><div class="line"><div class="line-content"><span class="com"># @[(start: 40, stop: 55, val:0), (start: 50, stop: 65, val: 0), (start: 60, stop: 75, val: 0), (start: 70, stop: 85, val: 0)]</span></div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">r</span> <span class="kwd">in</span> <span class="ide">res</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">r</span><span class="op">.</span><span class="ide">val</span> <span class="op">+=</span> <span class="num">1</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># or we can do a function on each overlapping interval</span></div></div><div class="line"><div class="line-content"><span class="ide">l</span><span class="op">.</span><span class="ide">each_seek</span>(<span class="num">50</span>, <span class="num">60</span>, <span class="kwd">proc</span>(<span class="ide">a</span>:<span class="ide">myinterval</span>) <span class="op">=</span> <span class="ide">inc</span>(<span class="ide">a</span><span class="op">.</span><span class="ide">val</span>))</div></div><div class="line"><div class="line-content"><span class="com"># or</span></div></div><div class="line"><div class="line-content"><span class="ide">l</span><span class="op">.</span><span class="ide">each_find</span>(<span class="num">50</span>, <span class="num">60</span>, <span class="kwd">proc</span>(<span class="ide">a</span>:<span class="ide">myinterval</span>) <span class="op">=</span> <span class="ide">a</span><span class="op">.</span><span class="ide">val</span> <span class="op">+=</span> <span class="num">10</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">discard</span> <span class="ide">l</span><span class="op">.</span><span class="ide">seek</span>(<span class="num">50</span>, <span class="num">70</span>, <span class="ide">res</span>)</div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">res</span></div></div><div class="line"><div class="line-content"><span class="com">#@[(start:40, stop:55, val:12), (start:50, stop:65, val:12), (start:60, stop:75, val:1)]</span></div></div>  </code></pre>
<h2>Performance</h2>
<p>The output of running <code>bench.nim</code> (with -d:release) which generates <em>200K intervals</em>
with positions ranging from 0 to 50 million and max lengths from 10 to 1M is:</p>
<table>
<thead>
<tr>
<th>max interval size</th>
<th>lapper time</th>
<th>lapper seek time</th>
<th>brute-force time</th>
<th>speedup</th>
<th>seek speedup</th>
<th>each-seek speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>0.06</td>
<td>0.04</td>
<td>387.44</td>
<td>6983.81</td>
<td>9873.11</td>
<td>9681.66</td>
</tr>
<tr>
<td>100</td>
<td>0.05</td>
<td>0.04</td>
<td>384.92</td>
<td>7344.32</td>
<td>10412.97</td>
<td>15200.84</td>
</tr>
<tr>
<td>1000</td>
<td>0.06</td>
<td>0.05</td>
<td>375.37</td>
<td>6250.23</td>
<td>7942.50</td>
<td>15703.24</td>
</tr>
<tr>
<td>10000</td>
<td>0.15</td>
<td>0.14</td>
<td>377.29</td>
<td>2554.61</td>
<td>2702.13</td>
<td>15942.76</td>
</tr>
<tr>
<td>100000</td>
<td>0.99</td>
<td>0.99</td>
<td>377.88</td>
<td>383.36</td>
<td>381.37</td>
<td>16241.61</td>
</tr>
<tr>
<td>1000000</td>
<td>12.52</td>
<td>12.53</td>
<td>425.61</td>
<td>34.01</td>
<td>33.96</td>
<td>17762.58</td>
</tr></tbody></table>
<p>Note that this is a worst-case scenario as we could also
simulate a case where there are few long intervals instead of
many large ones as in this case. Even so, we get a 34X speedup with <code>lapper</code>.</p>
<p>Also note that testing for presence will be even faster than
the above comparisons as it returns true as soon as an overlap is found.</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/brentp/nim-lapper">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-11-05T01:13:30Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
