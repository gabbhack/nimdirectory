<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">zero_functional</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">functional</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">dsl</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">chaining</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">seq</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("A library providing zero-cost chaining for functional abstractions in Nim")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install zero_functional" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>zero-functional <a href="https://github.com/zero-functional/zero-functional/actions?query=branch%3Amaster">  <img src="https://github.com/zero-functional/zero-functional/workflows/CI/badge.svg?branch=master" style="max-width: 100%;" alt="Build Status" /></a></h1>
<p>A library providing (almost) zero-cost chaining for functional abstractions in Nim.</p>
<h1>Table of Contents</h1>
<!--  toc  -->
<!--  add toc with markdown-toc  -->
<ul>
<li>  <a href="#initial-example">Initial Example</a></li>
<li>  <a href="#installation">Installation</a></li>
<li>  <a href="#rationale">Rationale</a></li>
<li>  <a href="#variable-names">Variable names</a></li>
<li>  <a href="#seq-and-arrays">Seq and arrays</a></li>
<li>  <a href="#other-types">Other types</a></li>
<li><a href="#supported-methods">Supported methods</a>
<ul>
<li>  <a href="#map">map</a></li>
<li>  <a href="#filter">filter</a></li>
<li>  <a href="#zip">zip</a></li>
<li>  <a href="#split">split</a></li>
<li>  <a href="#exists">exists</a></li>
<li>  <a href="#all">all</a></li>
<li>  <a href="#index">index</a></li>
<li>  <a href="#indexedmap">indexedMap</a></li>
<li>  <a href="#enumerate">enumerate</a></li>
<li>  <a href="#fold">fold</a></li>
<li><a href="#reduce">reduce</a>
<ul>
<li>  <a href="#max">max</a></li>
<li>  <a href="#min">min</a></li>
<li>  <a href="#product">product</a></li>
<li>  <a href="#sum">sum</a></li>
</ul>
</li>
<li>  <a href="#indexedreduce">indexedReduce</a></li>
<li><a href="#foreach">foreach</a>
<ul>
<li>  <a href="#changing-in-place">changing in-place</a></li>
</ul>
</li>
<li><a href="#sub">sub</a>
<ul>
<li>  <a href="#drop">drop</a></li>
<li>  <a href="#dropwhile">dropWhile</a></li>
<li>  <a href="#take">take</a></li>
<li>  <a href="#takewhile">takeWhile</a></li>
</ul>
</li>
<li><a href="#flatten">flatten</a>
<ul>
<li>  <a href="#indexedflatten">indexedFlatten</a></li>
</ul>
</li>
<li><a href="#combinations">combinations</a>
<ul>
<li>  <a href="#indexedcombinations">indexedCombinations</a></li>
</ul>
</li>
<li>  <a href="#concat">concat</a></li>
<li>  <a href="#group">group</a></li>
<li>  <a href="#partition">partition</a></li>
<li><a href="#to">to</a>
<ul>
<li>  <a href="#createiter">createIter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#extending-zero-functional">Extending zero-functional</a>
<ul>
<li>  <a href="#extending-with-plain-nim">Extending with plain nim</a></li>
<li><a href="#writing-extensions-with-zero-dsl">Writing extensions with Zero-DSL</a>
<ul>
<li>  <a href="#special-variables">Special variables</a></li>
<li>  <a href="#setting-the-result">Setting the result</a></li>
</ul>
</li>
<li><a href="#defering-to-zero-dsl-inside-plain-nim">Defering to Zero-DSL inside plain nim</a>
<ul>
<li>  <a href="#creating-compound-commands-with-other-commands">Creating compound commands with other commands</a></li>
</ul>
</li>
</ul>
</li>
<li>  <a href="#overview-table">Overview Table</a></li>
<li>  <a href="#debugging-using---">Debugging using   <code>--&gt;&gt;</code></a></li>
<li>  <a href="#compile-flags">Compile flags</a></li>
<li>  <a href="#license">LICENSE</a></li>
<li>  <a href="#contributors">Contributors</a></li>
</ul>
<!--  tocstop  -->
<h2>Initial Example</h2>
<p>The example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">n</span> <span class="op">=</span> <span class="ide">zip</span>(<span class="ide">a</span>, <span class="ide">b</span>) <span class="op">--&gt;</span></div></div><div class="line"><div class="line-content">            <span class="ide">map</span>(<span class="ide">f</span>(<span class="ide">it</span>[<span class="num">0</span>], <span class="ide">it</span>[<span class="num">1</span>]))<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">filter</span>(<span class="ide">it</span> <span class="kwd">mod</span> <span class="num">4</span> <span class="op">&gt;</span> <span class="num">1</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">map</span>(<span class="ide">it</span> <span class="op">*</span> <span class="num">2</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">all</span>(<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">4</span>)</div></div>  </code></pre>
<p>is expanded on compile time - additional compile-time checks omitted - to the equivalent of:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content">(<span class="kwd">proc</span> (): <span class="ide">auto</span> <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="kwd">var</span> <span class="ide">minHigh134598</span> <span class="op">=</span> <span class="ide">min</span>([<span class="ide">high</span>(<span class="ide">a</span>), <span class="ide">high</span>(<span class="ide">b</span>)])</div></div><div class="line"><div class="line-content">  <span class="kwd">var</span> <span class="ide">empty</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content">  <span class="kwd">for</span> <span class="ide">z</span> <span class="kwd">in</span> <span class="ide">low</span>(<span class="ide">a</span>) <span class="op">..</span> <span class="ide">minHigh134598</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">var</span> <span class="ide">it0</span> <span class="op">=</span> (<span class="ide">a</span>[<span class="ide">z</span>], <span class="ide">b</span>[<span class="ide">z</span>])</div></div><div class="line"><div class="line-content">    <span class="kwd">var</span> <span class="ide">it1</span> <span class="op">=</span> <span class="ide">f</span>(<span class="ide">it0</span>[<span class="num">0</span>], <span class="ide">it0</span>[<span class="num">1</span>])</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">it1</span> <span class="kwd">mod</span> <span class="num">4</span> <span class="op">&gt;</span> <span class="num">1</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">var</span> <span class="ide">it2</span> <span class="op">=</span> <span class="ide">it1</span></div></div><div class="line"><div class="line-content">      <span class="kwd">var</span> <span class="ide">it3</span> <span class="op">=</span> <span class="ide">it2</span> <span class="op">*</span> <span class="num">2</span></div></div><div class="line"><div class="line-content">      <span class="ide">result</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content">      <span class="kwd">if</span> <span class="kwd">not</span>(<span class="ide">it3</span> <span class="op">&gt;</span> <span class="num">4</span>):</div></div><div class="line"><div class="line-content">        <span class="kwd">return</span> <span class="ide">false</span>)()</div></div>  </code></pre>
<p>Compared to:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">sequtils</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">n</span> <span class="op">=</span> <span class="ide">zip</span>(<span class="ide">a</span>, <span class="ide">b</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">mapIt</span>(<span class="ide">f</span>(<span class="ide">it</span>[<span class="num">0</span>], <span class="ide">it</span>[<span class="num">1</span>]))<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">filterIt</span>(<span class="ide">it</span> <span class="kwd">mod</span> <span class="num">4</span> <span class="op">&gt;</span> <span class="num">1</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">mapIt</span>(<span class="ide">it</span> <span class="op">*</span> <span class="num">2</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">allIt</span>(<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">4</span>)</div></div>  </code></pre>
<p>which is roughly equivalent to:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">m</span> <span class="op">=</span> <span class="ide">min</span>(<span class="ide">a</span><span class="op">.</span><span class="ide">len</span>, <span class="ide">b</span><span class="op">.</span><span class="ide">len</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">result0</span>: <span class="ide">seq</span>[(<span class="ide">int</span>, <span class="ide">int</span>)]</div></div><div class="line"><div class="line-content"><span class="ide">newSeq</span>(<span class="ide">result0</span>, <span class="ide">m</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">i</span> <span class="kwd">in</span> <span class="num">0</span> <span class="op">..</span> <span class="op">&lt;</span><span class="ide">m</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result0</span>[<span class="ide">i</span>] <span class="op">=</span> (<span class="ide">m</span>[<span class="ide">i</span>], <span class="ide">m</span>[<span class="ide">i</span>])</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">result1</span>: <span class="ide">seq</span>[<span class="ide">int</span>]</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">t0</span> <span class="op">=</span> <span class="ide">result0</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">i0</span> <span class="op">=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content"><span class="ide">result1</span> <span class="op">=</span> <span class="ide">newSeq</span>[<span class="ide">int</span>](<span class="ide">result0</span><span class="op">.</span><span class="ide">len</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">it</span> <span class="kwd">in</span> <span class="ide">t0</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result1</span>[<span class="ide">i0</span>] <span class="op">=</span> <span class="ide">f</span>(<span class="ide">it</span>[<span class="num">0</span>], <span class="ide">it</span>[<span class="num">1</span>])</div></div><div class="line"><div class="line-content">  <span class="ide">i0</span> <span class="op">+=</span> <span class="num">1</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">result2</span> <span class="op">=</span> <span class="ide">newSeq</span>[<span class="ide">int</span>]()</div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">it</span> <span class="kwd">in</span> <span class="ide">items</span>(<span class="ide">result1</span>):</div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">it</span> <span class="kwd">mod</span> <span class="num">4</span> <span class="op">&gt;</span> <span class="num">1</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span><span class="op">.</span><span class="ide">add</span>(<span class="ide">it</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">result3</span>: <span class="ide">seq</span>[<span class="ide">int</span>]</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">t1</span> <span class="op">=</span> <span class="ide">result1</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">i1</span> <span class="op">=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content"><span class="ide">result3</span> <span class="op">=</span> <span class="ide">newSeq</span>[<span class="ide">int</span>](<span class="ide">result2</span><span class="op">.</span><span class="ide">len</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">it</span> <span class="kwd">in</span> <span class="ide">t1</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">result3</span>[<span class="ide">i1</span>] <span class="op">=</span> <span class="ide">it</span> <span class="op">*</span> <span class="num">2</span></div></div><div class="line"><div class="line-content"><span class="ide">result</span> <span class="op">=</span> <span class="ide">true</span></div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">it</span> <span class="kwd">in</span> <span class="ide">items</span>(<span class="ide">result3</span>):</div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="kwd">not</span> (<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">4</span>):</div></div><div class="line"><div class="line-content">    <span class="kwd">return</span> <span class="ide">false</span></div></div>  </code></pre>
<h2>Installation</h2>
<pre>  <code>nimble install zero_functional
</code></pre>
<p>Note: the correct name is <code>zero_functional</code> (with an underscore).</p>
<h2>Rationale</h2>
<p>Functional style handling of sequences is awesome, and Nim is supposed to be fast and smart.
Allocating new sequences on each method in a chain can be extremely wasteful and there are not a lot of technical reasons to punish functional style like that.</p>
<p>This library can expand functional chains to simple loops fusing the method bodies one after another.
It is still very experimental, but it shows that a purely metaprogramming approach can be used to optimize functional Nim code.</p>
<h2>Variable names</h2>
<p>The supported variable names (can be changed at the beginning of the <a href="zero_functional.nim">zero_functional.nim</a> file) are:</p>
<ul>
<li><code>it</code> is used for the iterator variable</li>
<li><code>idx</code> is used as integer index of current iteration</li>
<li><code>a</code> is used as the accumulator in <code>fold</code></li>
</ul>
<h2>Seq and arrays</h2>
<p>All supported methods work on finite indexable types and arrays.</p>
<p>If a handler returns a collection, it will be of the same shape as the input for seq-s, arrays and DoublyLinkedList-s.
Other collections are mapped to seq if it cannot be automatically converted. (e.g. array.map returns an array).</p>
<p>You can always get a seq if you use <code>&lt;handler&gt;Seq</code>, e.g. <code>mapSeq</code> - or <code>to(seq)</code>.
Some of the supported methods default to seq-output, e.g. <code>map</code> when changing the result type, <code>flatten</code> and <code>indexedMap</code>.</p>
<p>We can describe the supported types as</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">type</span></div></div><div class="line"><div class="line-content">  <span class="ide">FiniteIndexable</span>[<span class="ide">T</span>] <span class="op">=</span> <span class="kwd">concept</span> <span class="ide">a</span></div></div><div class="line"><div class="line-content">    <span class="ide">a</span><span class="op">.</span><span class="ide">low</span> <span class="kwd">is</span> <span class="ide">int</span></div></div><div class="line"><div class="line-content">    <span class="ide">a</span><span class="op">.</span><span class="ide">high</span> <span class="kwd">is</span> <span class="ide">int</span></div></div><div class="line"><div class="line-content">    <span class="ide">a</span>[<span class="ide">int</span>] <span class="kwd">is</span> <span class="ide">T</span></div></div>  </code></pre>
<h2>Other types</h2>
<p>Enums are supported and mapped to <code>seq[enumtype]</code>.</p>
<p>Generic objects are supported if they are of any type:</p>
<ul>
<li>FiniteIndexable - contains <code>high</code>/<code>low</code> and <code>[]</code>-access (see above)</li>
<li>FiniteIndexableLen - contains <code>len</code> and <code>[]</code></li>
</ul>
<p>Collection types that will be generated as a result type need to implement either one of</p>
<ul>
<li>Appendable (contains the <code>append</code> function as in DoublyLinkedList)</li>
<li>Addable (contains the <code>add</code> function as in <code>seq</code>)</li>
<li><code>[]=</code> operator</li>
</ul>
<p>Some of the supported methods will only work when the <code>[]=</code> operator is defined - except when using DoublyLinkedList or SinglyLinkedList types.
This is needed for <code>zip</code>, <code>combinations</code> and <code>foreach</code> when changing elements.</p>
<p>For the creation of a generic type as result, the type needs to implement</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">zfInit</span>(<span class="ide">a</span>: <span class="ide">MyType</span>): <span class="ide">MyType</span> <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="ide">MyType</span>(<span class="op">...</span>)</div></div><div class="line"><div class="line-content">  <span class="com"># the `a` is not actually used but is needed for overloading.</span></div></div>  </code></pre>
<h2>Supported methods</h2>
<p>These are not exactly the functions from sequtils, they have the same naming and almost the same behavior.</p>
<p>The macros work with <code>--&gt;</code>, <code>zfun</code> or <code>connect</code>. Multiple <code>--&gt;</code> may be used or <code>.</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">sequence</span> <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="op">..</span>) <span class="op">--&gt;</span> <span class="ide">all</span>(<span class="op">..</span>)</div></div>  </code></pre>
<p>or</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zip</span>(<span class="ide">a</span>, <span class="ide">b</span>, <span class="ide">c</span>) <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="op">..</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">                 <span class="ide">all</span>(<span class="op">..</span>)</div></div>  </code></pre>
<p>You can also use the call with sections - with the above calls omitting the dots or arrows or with several statements applied to the same function in one section.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">res</span> <span class="op">=</span> <span class="ide">sequence</span><span class="op">.</span><span class="ide">zfun</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">map</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">f1</span>(<span class="ide">it</span>)</div></div><div class="line"><div class="line-content">    <span class="ide">f2</span>(<span class="ide">it</span>)</div></div><div class="line"><div class="line-content">  <span class="ide">all</span>(<span class="op">...</span>)</div></div>  </code></pre>
<p>or as simple arguments to a function:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">connect</span>(<span class="ide">collection</span>, <span class="ide">map</span>(<span class="op">..</span>), <span class="ide">all</span>(<span class="op">..</span>))</div></div>  </code></pre>
<p>The methods work with the auto <code>it</code> variable.</p>
<h3>map</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">collection</span> <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">op</span>)</div></div>  </code></pre>
<p>Map each item in the collection to a new value.
Example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">x</span> <span class="op">=</span> [<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>] <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">it</span> <span class="op">*</span> <span class="num">2</span>)</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">x</span> <span class="op">==</span> [<span class="num">2</span>,<span class="num">4</span>,<span class="num">6</span>])</div></div>  </code></pre>
<p>Map also supports converting the type of iterator item and thus of the collection.</p>
<p>Map is (currently) the only command supporting value definitions inside the map call that may be used instead or additionally to the <code>it</code> value in subsequent calls. Assignment to simple values or tuple assignments are possible as well.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">idx</span> <span class="op">=</span> <span class="ide">rows</span> <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">row</span> <span class="op">=</span> <span class="ide">it</span>) <span class="op">--&gt;</span> <span class="ide">index</span>(<span class="ide">row</span> <span class="op">&gt;</span> <span class="ide">someValue</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">posCoords</span> <span class="op">=</span> <span class="ide">coords</span> <span class="op">--&gt;</span> <span class="ide">map</span>((<span class="ide">x</span>,<span class="ide">y</span>) <span class="op">=</span> <span class="ide">it</span>) <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">x</span> <span class="op">&gt;</span> <span class="num">0</span> <span class="kwd">and</span> <span class="ide">y</span> <span class="op">&gt;</span> <span class="num">0</span>)</div></div>  </code></pre>
<p>A shortcut syntax is also supported - actually replacing <code>it</code> with the given variable names:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># a iterates on x</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">x</span> <span class="op">--&gt;</span> (<span class="ide">a</span>) <span class="op">--&gt;</span> <span class="ide">exists</span>(<span class="ide">y</span> <span class="op">--&gt;</span> <span class="ide">exists</span>(<span class="ide">a</span> <span class="op">==</span> <span class="ide">it</span>)))</div></div><div class="line"><div class="line-content"><span class="com"># this is equivalent to</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">x</span> <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">a</span> <span class="op">=</span> <span class="ide">it</span>) <span class="op">--&gt;</span> <span class="ide">exists</span>(<span class="ide">y</span> <span class="op">--&gt;</span> <span class="ide">exists</span>(<span class="ide">a</span> <span class="op">==</span> <span class="ide">it</span>)))</div></div>  </code></pre>
<p><code>zfun</code> also supports this shortcut either as single line <code>(a)</code> or as a parameter to <code>zfun</code>:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">b</span> <span class="op">=</span> <span class="ide">x</span><span class="op">.</span><span class="ide">zfun</span>(<span class="ide">a</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">exists</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">z</span><span class="op">.</span><span class="ide">zfun</span>(<span class="ide">b</span>):</div></div><div class="line"><div class="line-content">      <span class="ide">exists</span>(<span class="ide">a</span> <span class="op">==</span> <span class="ide">b</span>)</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="kwd">not</span> <span class="ide">b</span>)</div></div>  </code></pre>
<h3>filter</h3>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">sequence</span> <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">cond</span>)</div></div>  </code></pre>
<p>Filter the collection items with the given condition.
Example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">x</span> <span class="op">=</span> <span class="op">@</span>[<span class="op">-</span><span class="num">1</span>,<span class="num">2</span>,<span class="op">-</span><span class="num">3</span>] <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">0</span>)</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">x</span> <span class="op">==</span> <span class="op">@</span>[<span class="num">2</span>])</div></div>  </code></pre>
<h3>zip</h3>
<p><code>zip</code> can work with n sequences. <code>zip</code> is (roughly) internally translated to:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zip</span>(<span class="ide">a</span>,<span class="ide">b</span>,<span class="ide">c</span>) <span class="op">&lt;=&gt;</span></div></div><div class="line"><div class="line-content"><span class="ide">a</span> <span class="op">--&gt;</span> <span class="ide">zip</span>(<span class="ide">b</span>,<span class="ide">c</span>) <span class="op">&lt;~&gt;</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">minHigh</span> <span class="op">=</span> <span class="ide">min</span>([<span class="ide">a</span><span class="op">.</span><span class="ide">high</span>(), <span class="ide">b</span><span class="op">.</span><span class="ide">high</span>(), <span class="ide">c</span><span class="op">.</span><span class="ide">high</span>()])</div></div><div class="line"><div class="line-content"><span class="ide">a</span> <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">idx</span> <span class="op">&lt;=</span> <span class="ide">minHigh</span>) <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">a</span>[<span class="ide">idx</span>], <span class="ide">b</span>[<span class="ide">idx</span>], <span class="ide">c</span>[<span class="ide">idx</span>])</div></div>  </code></pre>
<p>On the right side of <code>--&gt;</code> (or as 2nd and later command) the left side of <code>--&gt;</code> is added to the zip result.
For <code>zip</code> in order to work properly all arguments have to support access with <code>[]</code> and the <code>high</code> procedure.
If those procedures are not available the macro tries to call the procedure <code>mkIndexable</code> on that parameter.
Using this helper the parameter can be wrapped with a new type that supports <code>[]</code> and <code>high</code>.</p>
<h3>split</h3>
<p><code>split</code> is kind of the opposite of <code>zip</code>. It works with a collection of n-tuples and splits it up into an n-tuple of sequences.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>([(<span class="num">1</span>, <span class="str">&quot;one&quot;</span>), (<span class="num">2</span>, <span class="str">&quot;two&quot;</span>)] <span class="op">--&gt;</span> <span class="ide">split</span>() <span class="op">==</span> (<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>], <span class="op">@</span>[<span class="str">&quot;one&quot;</span>,<span class="str">&quot;two&quot;</span>])</div></div>  </code></pre>
<h3>exists</h3>
<p>Check if the given condition is true for at least one element of the collection.</p>
<p><code>exists</code> can be used only at the end of the command chain.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">sequence</span> <span class="op">--&gt;</span> <span class="ide">otherOperations</span>(<span class="op">..</span>) <span class="op">--&gt;</span> <span class="ide">exists</span>(<span class="ide">cond</span>): <span class="ide">bool</span></div></div>  </code></pre>
<h3>all</h3>
<p>Check if the given condition is true for all the elements of the collection.</p>
<p><code>all</code> can be used only at the end of the command chain.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">sequence</span> <span class="op">--&gt;</span> <span class="ide">otherOperations</span>(<span class="op">..</span>) <span class="op">--&gt;</span> <span class="ide">all</span>(<span class="ide">cond</span>): <span class="ide">bool</span></div></div>  </code></pre>
<h3>index</h3>
<p>Get the first index of the item in the collection, where the given condition is true.</p>
<p><code>index</code> can be used only at the end of the command chain.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">sequence</span> <span class="op">--&gt;</span> <span class="ide">otherOperations</span>(<span class="op">..</span>) <span class="op">--&gt;</span> <span class="ide">index</span>(<span class="ide">cond</span>): <span class="ide">int</span></div></div>  </code></pre>
<h3>indexedMap</h3>
<p>Adds or prepends the index of each element in the collection to the element itself and generates a named tuple <code>(idx: index, elem: it)</code> for each element in the collection.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">n</span> <span class="op">=</span> <span class="ide">zip</span>(<span class="ide">a</span>, <span class="ide">b</span>, <span class="ide">c</span>) <span class="op">--&gt;</span></div></div><div class="line"><div class="line-content">            <span class="ide">indexedMap</span>(<span class="ide">f</span>(<span class="ide">it</span>[<span class="num">0</span>], <span class="ide">it</span>[<span class="num">1</span>]))<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">filter</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">idx</span> <span class="op">&lt;</span> <span class="num">10</span> <span class="kwd">and</span> <span class="ide">it</span><span class="op">.</span><span class="ide">elem</span> <span class="kwd">mod</span> <span class="num">4</span> <span class="op">&gt;</span> <span class="num">1</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">map</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">elem</span> <span class="op">*</span> <span class="num">2</span>)<span class="op">.</span></div></div><div class="line"><div class="line-content">            <span class="ide">all</span>(<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">4</span>)</div></div>  </code></pre>
<h3>enumerate</h3>
<p>Prepends the index to the value of the current iteration (unlike the <code>indexedMap</code>, which indexes the initial collection/iteration) and generates a named tuple <code>(idx: index, elem: it)</code> for each element in the iterable. Does not take any parameters.</p>
<p>Is similar to <a href="https://docs.python.org/3/library/functions.html#enumerate">  <code>enumerate</code></a> in Python or <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.enumerate">  <code>enumerate</code></a> in Rust.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="num">0.</span><span class="op">.</span><span class="num">10</span> <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="kwd">mod</span> <span class="num">2</span> <span class="op">==</span> <span class="num">0</span>)<span class="op">.</span><span class="ide">enumerate</span>()<span class="op">.</span><span class="ide">map</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">idx</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">0</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>]</div></div><div class="line"><div class="line-content"><span class="com"># enumerate vs indexedMap</span></div></div><div class="line"><div class="line-content">(<span class="num">1.</span><span class="op">.</span><span class="num">7</span> <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="kwd">mod</span> <span class="num">2</span> <span class="op">==</span> <span class="num">0</span>) <span class="op">--&gt;</span> <span class="ide">enumerate</span>())    <span class="op">==</span> <span class="op">@</span>[(<span class="num">0</span>, <span class="num">2</span>), (<span class="num">1</span>, <span class="num">4</span>), (<span class="num">2</span>, <span class="num">6</span>)])</div></div><div class="line"><div class="line-content">(<span class="num">1.</span><span class="op">.</span><span class="num">7</span> <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="kwd">mod</span> <span class="num">2</span> <span class="op">==</span> <span class="num">0</span>) <span class="op">--&gt;</span> <span class="ide">indexedMap</span>(<span class="ide">it</span>)) <span class="op">==</span> <span class="op">@</span>[(<span class="num">1</span>, <span class="num">2</span>), (<span class="num">3</span>, <span class="num">4</span>), (<span class="num">5</span>, <span class="num">6</span>)])</div></div>  </code></pre>
<h3>fold</h3>
<p>Currently a left fold (as easier to combine with the implementation).</p>
<p>The sequtils <code>a</code> is <code>a</code>, <code>b</code> is <code>it</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">n</span> <span class="op">=</span> <span class="ide">zip</span>(<span class="ide">a</span>, <span class="ide">b</span>) <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">it</span>[<span class="num">0</span>] <span class="op">+</span> <span class="ide">it</span>[<span class="num">1</span>]) <span class="op">--&gt;</span> <span class="ide">fold</span>(<span class="num">0</span>, <span class="ide">a</span> <span class="op">+</span> <span class="ide">it</span>)</div></div>  </code></pre>
<h3>reduce</h3>
<p>Same as fold, but with the iterator converted to a tuple where <code>it[0]</code> or <code>it.accu</code> is the accumulated result and <code>it[1]</code> or <code>it.elem</code> the actual iterator on the collection.</p>
<p>The first item of the collection is used as initial value - the other items are then accumulated to it.
This is also useful when a type does not define the neutral element for the given operation.
E.g. for integers and <code>+</code> the neutral element is 0 but for user defined types the neutral element might not exist.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">n</span> <span class="op">=</span> <span class="ide">a</span> <span class="op">--&gt;</span> <span class="ide">reduce</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">accu</span> <span class="op">+</span> <span class="ide">it</span><span class="op">.</span><span class="ide">elem</span>)</div></div>  </code></pre>
<p>There are a few commands that are simply mapped to reduce</p>
<h4>max</h4>
<p>Return the maximum value in the collection (<code>&gt;</code> is needed)</p>
<h4>min</h4>
<p>Return the minimum value in the collection (<code>&lt;</code> is needed)</p>
<h4>product</h4>
<p>Return the product of the (filtered) elements (<code>*</code>)</p>
<h4>sum</h4>
<p>Return the sum of the (filtered) elements (<code>+</code>).</p>
<h3>indexedReduce</h3>
<p>By adding the <code>indexed</code> prefix to <code>reduce</code> or to the reduce commands above, the index of the last value that was used for the <code>result</code> and the actual result of the operation are returned.</p>
<p>For <code>sum</code> and <code>product</code> this is not actually helpful but it can be used to find the indices of the <code>min</code> and <code>max</code> elements.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="num">11</span>,<span class="num">2</span>,<span class="num">0</span>,<span class="op">-</span><span class="num">2</span>,<span class="num">1</span>,<span class="num">3</span>,<span class="op">-</span><span class="num">1</span>] <span class="op">--&gt;</span> <span class="ide">indexedMin</span>() <span class="op">==</span> (<span class="num">3</span>,<span class="op">-</span><span class="num">2</span>))</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="num">11</span>,<span class="num">2</span>,<span class="num">0</span>,<span class="op">-</span><span class="num">2</span>,<span class="num">1</span>,<span class="num">3</span>,<span class="op">-</span><span class="num">1</span>] <span class="op">--&gt;</span> <span class="ide">indexedMax</span>() <span class="op">==</span> (<span class="num">0</span>,<span class="num">11</span>))</div></div>  </code></pre>
<p>Note that a named tuple is created and the index is also accessible via <code>.idx</code> and the actual element with <code>.elem</code>.</p>
<h3>foreach</h3>
<p>Can only be used with functions that have side effects.
When used as the last command in the chain the result is void.
As in-between element the code is simply executed on each element.</p>
<h4>changing in-place</h4>
<p>The iterator content may be changed in <code>foreach</code> resulting in changing the original collection.
However there are a few restrictions (see <a href="test.nim#L455">test.nim</a>):</p>
<ul>
<li>the <code>[]=</code> operator has to be available for the underlying collection type (exception: the std LinkedList types)</li>
<li>functions that alter the collection elements may not be used in the chain before (e.g. <code>map</code> is not allowed, but <code>filter</code> is).</li>
</ul>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>] <span class="op">--&gt;</span></div></div><div class="line"><div class="line-content">    <span class="ide">foreach</span>(<span class="ide">echo</span>(<span class="op">$</span><span class="ide">it</span>))</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">a</span> <span class="op">=</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>]</div></div><div class="line"><div class="line-content"><span class="ide">a</span> <span class="op">--&gt;</span> <span class="ide">foreach</span>(<span class="ide">it</span> <span class="op">=</span> <span class="ide">it</span> <span class="op">*</span> <span class="num">2</span>)</div></div><div class="line"><div class="line-content"><span class="ide">check</span> (<span class="ide">a</span> <span class="op">==</span> <span class="op">@</span>[<span class="num">2</span>,<span class="num">4</span>,<span class="num">6</span>]</div></div>  </code></pre>
<h3>sub</h3>
<p>Works on a part of the input collection - <code>sub(fromIndex, toIndex)</code> or <code>drop(fromIndex)</code> - similarly to ranges, starting with <code>fromIndex</code> and ending (inclusive) with <code>endIndex</code> or runs til the end, when <code>endIndex</code> is not given.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>((<span class="num">1.</span><span class="op">.</span><span class="num">10</span>) <span class="op">--&gt;</span> <span class="ide">sub</span>(<span class="num">2</span>,<span class="num">5</span>) <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">list</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span>])</div></div>  </code></pre>
<p>The <code>endIndex</code> may be a <code>BackwardsIndex</code> like <code>^1</code>, but then the collection has to have a <code>len</code>.</p>
<p><code>sub</code> is similar to the <code>filter</code> function working on the <code>idx</code> variable, however <code>sub</code> uses an internal index that is not affected by the outcome of preceding filtering functions.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># in filter `idx` counts the iterated items</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">-</span><span class="num">1</span>,<span class="num">2</span>,<span class="op">-</span><span class="num">3</span>,<span class="num">4</span>,<span class="op">-</span><span class="num">5</span>,<span class="num">6</span>,<span class="op">-</span><span class="num">7</span>,<span class="num">8</span>] <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">0</span>) <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">idx</span> <span class="op">&gt;=</span> <span class="num">3</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">4</span>,<span class="num">6</span>,<span class="num">8</span>])</div></div><div class="line"><div class="line-content"><span class="com"># sub increments its own index when `it &gt; 0`</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">-</span><span class="num">1</span>,<span class="num">2</span>,<span class="op">-</span><span class="num">3</span>,<span class="num">4</span>,<span class="op">-</span><span class="num">5</span>,<span class="num">6</span>,<span class="op">-</span><span class="num">7</span>,<span class="num">8</span>] <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="op">&gt;</span> <span class="num">0</span>) <span class="op">--&gt;</span> <span class="ide">sub</span>(<span class="num">3</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">8</span>])</div></div>  </code></pre>
<p>Similar commands like <code>sub</code> that result in parts of the lists being iterated on or generated are: <code>drop</code>, <code>dropWhile</code>, <code>take</code> and <code>takeWhile</code>.</p>
<h4>drop</h4>
<p><code>drop(n)</code> drops n items before working on the collection. This is equivalent to <code>sub(n)</code>.</p>
<h4>dropWhile</h4>
<p><code>dropWhile(cond)</code> drops the items as long as the condition in <code>cond</code> is met - it starts working on the collection when the condition is not fulfilled any more.
As opposed to <code>filter</code> the condition in <code>drop</code> is ignored, once it was not true any more.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">-</span><span class="num">1</span>,<span class="num">2</span>,<span class="op">-</span><span class="num">3</span>,<span class="num">4</span>,<span class="op">-</span><span class="num">5</span>] <span class="op">--&gt;</span> <span class="ide">dropWhile</span>(<span class="ide">it</span> <span class="op">&lt;</span> <span class="num">0</span>) <span class="op">--&gt;</span> <span class="ide">sum</span>() <span class="op">==</span> <span class="op">-</span><span class="num">2</span>)</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">-</span><span class="num">1</span>,<span class="num">2</span>,<span class="op">-</span><span class="num">3</span>,<span class="num">4</span>,<span class="op">-</span><span class="num">5</span>] <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">it</span> <span class="op">&gt;=</span> <span class="num">0</span>)   <span class="op">--&gt;</span> <span class="ide">sum</span>() <span class="op">==</span> <span class="num">6</span>)</div></div>  </code></pre>
<h4>take</h4>
<p><code>take(n)</code> works on n items of the collection and then breaking. This is useful for very large (infinite) collections or iterators - the same for <code>takeWhile</code>.</p>
<h4>takeWhile</h4>
<p><code>takeWhile(cond)</code> works on the collection as long as the condition in <code>cond</code> is met. Otherwise it breaks the processing.</p>
<h3>flatten</h3>
<p>Working on a collection of iterable items, the <code>flatten</code> function flattens out the elements of the collection.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>],<span class="op">@</span>[<span class="num">3</span>],<span class="op">@</span>[<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>]] <span class="op">--&gt;</span> <span class="ide">flatten</span>() <span class="op">==</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>])</div></div>  </code></pre>
<h4>indexedFlatten</h4>
<p>Is similar to <code>flatten</code>, except that it returns the index inside original sub-lists with the actual content.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>],<span class="op">@</span>[<span class="num">3</span>],<span class="op">@</span>[<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>]] <span class="op">--&gt;</span> <span class="ide">indexedFlatten</span>()            <span class="op">==</span> <span class="op">@</span>[(<span class="num">0</span>,<span class="num">1</span>),(<span class="num">1</span>,<span class="num">2</span>),(<span class="num">0</span>,<span class="num">3</span>),(<span class="num">0</span>,<span class="num">4</span>),(<span class="num">1</span>,<span class="num">5</span>),(<span class="num">2</span>,<span class="num">6</span>)])</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>],<span class="op">@</span>[<span class="num">3</span>],<span class="op">@</span>[<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>]] <span class="op">--&gt;</span> <span class="ide">flatten</span>() <span class="op">--&gt;</span> <span class="ide">map</span>((<span class="ide">idx</span>,<span class="ide">it</span>)) <span class="op">==</span> <span class="op">@</span>[(<span class="num">0</span>,<span class="num">1</span>),(<span class="num">1</span>,<span class="num">2</span>),(<span class="num">2</span>,<span class="num">3</span>),(<span class="num">3</span>,<span class="num">4</span>),(<span class="num">4</span>,<span class="num">5</span>),(<span class="num">5</span>,<span class="num">6</span>)])</div></div>  </code></pre>
<p>Note that as in the other <code>indexed</code> commands the tuples are named tuples and the index is also accessible via <code>.idx</code> and the actual element with <code>.elem</code>.</p>
<h3>combinations</h3>
<p>Combines each element of the original collection with each other - the resulting variable is an array of 2 containing the combined iterator values. In case no other collection is supplied the combinations are done on the input collection - only combining different elements with each other.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># combine collection with itself results in unordered combinations - only different elements are combined</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>] <span class="op">--&gt;</span> <span class="ide">combinations</span>() <span class="op">==</span> <span class="op">@</span>[[<span class="num">1</span>,<span class="num">2</span>],[<span class="num">1</span>,<span class="num">3</span>],[<span class="num">2</span>,<span class="num">3</span>])</div></div><div class="line"><div class="line-content"><span class="com"># combine collection with the same collection again as a parameter results in comparing all elements in </span></div></div><div class="line"><div class="line-content"><span class="com"># all possible ordered combinations</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>] <span class="op">--&gt;</span> <span class="ide">combinations</span>(<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>]) <span class="op">==</span> <span class="op">@</span>[[<span class="num">1</span>,<span class="num">1</span>],[<span class="num">1</span>,<span class="num">2</span>],[<span class="num">1</span>,<span class="num">3</span>],[<span class="num">2</span>,<span class="num">1</span>],[<span class="num">2</span>,<span class="num">2</span>],[<span class="num">2</span>,<span class="num">3</span>],[<span class="num">3</span>,<span class="num">1</span>],[<span class="num">3</span>,<span class="num">2</span>],[<span class="num">3</span>,<span class="num">3</span>]])</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># combine all elements of first collection with elements of the second collections</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>] <span class="op">--&gt;</span> <span class="ide">combinations</span>(<span class="op">@</span>[<span class="num">4</span>,<span class="num">5</span>]) <span class="op">==</span> <span class="op">@</span>[[<span class="num">1</span>,<span class="num">4</span>],[<span class="num">1</span>,<span class="num">5</span>],[<span class="num">2</span>,<span class="num">4</span>],[<span class="num">2</span>,<span class="num">5</span>],[<span class="num">3</span>,<span class="num">4</span>],[<span class="num">3</span>,<span class="num">5</span>]])</div></div>  </code></pre>
<h4>indexedCombinations</h4>
<p>Same as <code>combinations</code> with the additional indices of the resulting combined elements. The resulting iterator is a named tuple with the combined elements and their indices <code>(idx: [idx1, idx2], elem: [combined_element1, combined_element2])</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># find the indices of the elements in the collection, where the diff to the other element is 1</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="num">11</span>,<span class="num">2</span>,<span class="num">7</span>,<span class="num">3</span>,<span class="num">4</span>] <span class="op">--&gt;</span> <span class="ide">indexedCombinations</span>() <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="ide">abs</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">elem</span>[<span class="num">1</span>]<span class="op">-</span><span class="ide">it</span><span class="op">.</span><span class="ide">elem</span>[<span class="num">0</span>]) <span class="op">==</span> <span class="num">1</span>) <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">idx</span>) <span class="op">==</span> <span class="op">@</span>[[<span class="num">1</span>,<span class="num">3</span>],[<span class="num">3</span>,<span class="num">4</span>]])</div></div><div class="line"><div class="line-content"><span class="com">#          ^   ^ ^</span></div></div>  </code></pre>
<h3>concat</h3>
<p>Concatenates the given arguments to one iterator. Can only be used as first command preceeding <code>--&gt;</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">concat</span>([<span class="num">1</span>,<span class="num">2</span>],[<span class="num">3</span>,<span class="num">4</span>]) <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">seq</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>])</div></div>  </code></pre>
<p>Alternatively <code>zf_concat</code> can be used to create an iterator that concatenates the given iterators to one.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zf_concat</span>(<span class="ide">con</span>, <span class="op">@</span>[<span class="num">1</span>], (<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>))</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">con</span>() <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">seq</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>])</div></div>  </code></pre>
<h3>group</h3>
<p>Creates a table containing result of each element applied to a discriminator function as keys and the corresponding elements in sequences as values.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># taking the last character of the strings as key</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">m</span> <span class="op">=</span> <span class="op">@</span>[(<span class="num">1</span>,<span class="str">&quot;one&quot;</span>),(<span class="num">2</span>,<span class="str">&quot;two&quot;</span>),(<span class="num">3</span>,<span class="str">&quot;three&quot;</span>)] <span class="op">--&gt;</span> <span class="ide">group</span>(<span class="ide">it</span>[<span class="num">1</span>][<span class="op">^</span><span class="num">1</span>])</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">m</span>['e'] <span class="op">==</span> <span class="op">@</span>[(<span class="num">1</span>, <span class="str">&quot;one&quot;</span>), (<span class="num">3</span>, <span class="str">&quot;three&quot;</span>)])</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">m</span>['o'] <span class="op">==</span> <span class="op">@</span>[(<span class="num">2</span>, <span class="str">&quot;two&quot;</span>)])</div></div>  </code></pre>
<h3>partition</h3>
<p>Simplified version of <code>group</code> and alternative version to <code>filter</code> that returns a tuple with all elements that match the filter condition as first tuple element named <code>yes</code> and all non-matching as the second named <code>no</code>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">isEven</span>(<span class="ide">i</span>: <span class="ide">int</span>): <span class="ide">bool</span> <span class="op">=</span> (<span class="ide">i</span> <span class="kwd">and</span> <span class="num">1</span>) <span class="op">==</span> <span class="num">0</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">a</span> <span class="op">=</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>,<span class="num">4</span>,<span class="num">5</span>,<span class="num">6</span>]</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">p</span> <span class="op">=</span> <span class="ide">a</span> <span class="op">--&gt;</span> <span class="ide">partition</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">isEven</span>())</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">p</span><span class="op">.</span><span class="ide">yes</span> <span class="op">==</span> <span class="op">@</span>[<span class="num">2</span>,<span class="num">4</span>,<span class="num">6</span>])</div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="ide">p</span><span class="op">.</span><span class="ide">no</span> <span class="op">==</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">3</span>,<span class="num">5</span>])</div></div>  </code></pre>
<h3>to</h3>
<p>Finally, it is possible to force the result type to the type given in <code>to</code> - which is only allowed as last argument when generating collection results (e.g. <code>map</code> or <code>filter</code> are the last arguments before <code>to</code>).
This method is handled differently from the others and removed internally so the command before <code>to</code> is the actual last command.</p>
<p>When the result type is given as <code>seq</code>, <code>array</code> or <code>list</code> (the latter is mapped to <code>DoublyLinkedList</code>) then the template argument can be determined automatically.
However, when all auto detection fails, the result type may be given explicitly here - the resulting code is also a bit more efficient for the compilation process.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">check</span>([<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>]) <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">seq</span>) <span class="op">==</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>])</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">l</span> <span class="op">=</span> <span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>] <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="op">$</span><span class="ide">it</span>) <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">list</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">l2</span>: <span class="ide">DoublyLinkedList</span>[<span class="ide">string</span>] <span class="op">=</span> <span class="ide">l</span></div></div><div class="line"><div class="line-content"><span class="ide">echo</span>(<span class="ide">l2</span>)</div></div>  </code></pre>
<p><code>to</code> supports a second parameter <code>autoConvert</code>. This actually only suppresses a warning when the actual result type and the added type are not identical but can be cast to another.
A bit more complex example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># doing a complex conversion from `seq[seq[uint8]]` to `seq[seq[int]]`</span></div></div><div class="line"><div class="line-content"><span class="ide">check</span>(<span class="op">@</span>[<span class="op">@</span>[<span class="num">1</span><span class="ide">u8</span>, <span class="num">2</span><span class="ide">u8</span>], <span class="op">@</span>[<span class="num">3</span><span class="ide">u8</span>]] <span class="op">--&gt;</span> <span class="ide">map</span>(<span class="ide">it</span> <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">seq</span>[<span class="ide">int</span>],<span class="ide">true</span>)) <span class="op">--&gt;</span> <span class="ide">to</span>(<span class="ide">seq</span>[<span class="ide">seq</span>[<span class="ide">int</span>]]) <span class="op">==</span> <span class="op">@</span>[<span class="op">@</span>[<span class="num">1</span>,<span class="num">2</span>], <span class="op">@</span>[<span class="num">3</span>]])</div></div>  </code></pre>
<ul>
<li>the <code>map</code> call itself contains a new <code>--&gt;</code> call, i.e.: each internal list is converted from <code>seq[uint8]</code> to <code>seq[int]</code></li>
<li>the parameter <code>true</code> is necessary to suppress a warning that the conversion is done by casting (each element)</li>
<li>the final result is a <code>seq[seq[int]]</code> - this conversion is optional (maybe to document) and can be determined automatically.</li>
</ul>
<h4>createIter</h4>
<p>When using <code>createIter(name:string,closure:bool=false)</code> as last function then an iterator <code>name</code> is created which can be used for further processing with zero-functional with only a small overhead.
Similar to <code>to</code> this is also a virtual function which is internally replaced and only used to check the output type.
The generated iterator is inline by default and can not be returned from a proc or given to another proc (see <a href="https://nim-lang.org/docs/manual.html#iterators-and-the-for-statement-first-class-iterators">Nim: Iterators</a>).</p>
<p>To create a closure iterator, the optional argument <code>closure</code> has to be set to <code>true</code>. A closure iterator is created which can be used as a return result from a procedure or as a parameter to a procedure. <em>This does not work with JS backend!</em></p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">zero_functional</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">strutils</span></div></div><div class="line"><div class="line-content"><span class="com"># filter all lines containing the word hint in the iterator</span></div></div><div class="line"><div class="line-content"><span class="ide">lines</span>(<span class="str">&quot;nim.cfg&quot;</span>) <span class="op">--&gt;</span> <span class="ide">filter</span>(<span class="str">&quot;hint&quot;</span> <span class="kwd">in</span> <span class="ide">it</span><span class="op">.</span><span class="ide">string</span>) <span class="op">--&gt;</span> <span class="ide">createIter</span>(<span class="ide">errorLines</span>)</div></div><div class="line"><div class="line-content"><span class="ide">errorLines</span>() <span class="op">--&gt;</span> <span class="ide">foreach</span>(<span class="ide">echo</span> <span class="ide">it</span>)</div></div>  </code></pre>
<h2>Extending zero-functional</h2>
<p>Extending zero-functional with own functions is probably more complicated than with other fp-libraries as the functions have to be implemented with macros producing inlined imperative code.
Some good examples from basic to more complicated can be found in <a href="test.nim">test.nim: registerExtension</a> and in the source code of <a href="zero-functional.nim">zero-functional</a></p>
<h3>Extending with plain nim</h3>
<p>When adding your own <code>foo</code> implementation you can write your own <code>inlineFoo</code> proc and register it with zero_functional. It should look like this:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">macros</span> <span class="com"># do not forget to import macros when extending zero_functional </span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">inlineFoo</span><span class="op">*</span>(<span class="ide">ext</span>: <span class="ide">ExtNimNode</span>) {<span class="op">.</span><span class="ide">compileTime</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="com"># do some parameter checks</span></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">len</span> <span class="op">&gt;</span> <span class="ide">SOME_MAX</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">zfFail</span>(<span class="str">&quot;too many arguments in </span>\'<span class="str">$1</span>\'<span class="str">, got $2 but expected only $3&quot;</span> <span class="op">%</span></div></div><div class="line"><div class="line-content">        [<span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">repr</span>, <span class="op">$</span>(<span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">len</span> <span class="op">-</span> <span class="num">1</span>), <span class="op">$</span><span class="ide">SOME_MAX</span>])</div></div><div class="line"><div class="line-content">  <span class="com"># do some stuff</span></div></div><div class="line"><div class="line-content">  <span class="com"># ...</span></div></div><div class="line"><div class="line-content">  <span class="com"># the actual &apos;loop&apos; section code</span></div></div><div class="line"><div class="line-content">  <span class="ide">ext</span><span class="op">.</span><span class="ide">node</span> <span class="op">=</span> <span class="ide">quote</span>:</div></div><div class="line"><div class="line-content">    <span class="com"># do something</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># ....</span></div></div><div class="line"><div class="line-content"><span class="com"># after the function declarations register the extensions during compile time for use with zero_functional</span></div></div><div class="line"><div class="line-content"><span class="kwd">static</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">zfCreateExtension</span>()</div></div><div class="line"><div class="line-content">  </div></div><div class="line"><div class="line-content"><span class="com"># use foo after the registration</span></div></div>  </code></pre>
<p>The vanilla <code>inline</code>-proc implementations should follow certain rules.</p>
<ul>
<li><code>ext: ExtNimNode</code> as parameter</li>
<li>ExtNimNode should be used when implementing the functions with some helpers:
<ul>
<li><code>ext.node</code> = place the actual code here that is being generated inside the current block
initially <code>ext.node</code> contains the current function call and its parameters (section: loop)</li>
<li><code>ext.initials</code> = add the initialization code for variable definitions (section: init)</li>
<li><code>ext.endLoop</code> = add code that can be inserted at the end of the loop (section: end)</li>
<li><code>ext.finals</code> = add code after the loop - e.g. to calculate a result (section: final)</li>
<li><code>ext.res</code> = helper: access to the function&apos;s result</li>
<li><code>ext.prevItNode()</code> = access to the iterator generated in the previous statement or loop</li>
<li><code>ext.nextItNode()</code> = generates a new iterator for the current block. This is the (intermediate) result of the current operation that can be used with the next function</li>
</ul>
</li>
<li>check of parameters / number of parameters has to be done in the implementation</li>
<li>use <code>zfFail()</code> if any checks fail</li>
<li>register functions that use neither <code>zfInline</code> nor <code>zfInlineCall</code> using <code>zfAddFunction</code></li>
<li>functions that create another sequence have to be registered with <code>zfAddSequenceHandlers</code></li>
<li>finally call <code>zfCreateExtension</code> after all <code>zfInline...</code> definitions and <code>zfAddFunction</code> calls - before using the actual function implementation</li>
</ul>
<h3>Writing extensions with Zero-DSL</h3>
<p>Example - implement filterNot function:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">macros</span> <span class="com"># do not forget to import macros when extending zero_functional</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">zfInline</span> <span class="ide">filterNot</span>(<span class="ide">condition</span>: <span class="ide">bool</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">loop</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="kwd">not</span> <span class="ide">condition</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">yield</span> <span class="ide">it</span>   </div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># ....</span></div></div><div class="line"><div class="line-content"><span class="com"># after the function declarations register the extensions during compile time for use with zero_functional</span></div></div><div class="line"><div class="line-content"><span class="kwd">static</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">zfCreateExtension</span>()</div></div><div class="line"><div class="line-content">  </div></div><div class="line"><div class="line-content"><span class="com"># use foo after the registration</span></div></div>  </code></pre>
<p><code>zfInline</code> is the actual macro that takes the created function name (here: <code>map</code>) and its parameters and a body with different sections as input.
<code>zfInline_dbg</code> will print the generated code <code>proc inlineFilterMap</code> (see example for map below).</p>
<p>The sections directly map to their counterparts in <code>ExtNimNode</code>:</p>
<ul>
<li><code>pre</code> prepare section: initialize variables and constants. It is possible to do the entire implementation in the <code>pre</code> section.
<ul>
<li>all variables that are used in other sections have to be defined here!</li>
</ul>
</li>
<li><code>init</code> variable initialization before the loop</li>
<li><code>loop</code> the actual loop action (maps to <code>ext.node</code>)</li>
<li><code>delegate</code> delegate to other functions (like map, filter, etc.)</li>
<li><code>endLoop</code> added to end of the loop</li>
<li><code>final</code> after the loop section - e.g. to set the result or yield the remaining data</li>
</ul>
<p>Let&apos;s dissect the (simple) map implementation:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zfInline</span> <span class="ide">map</span>(<span class="ide">f</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">loop</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">it</span> <span class="op">=</span> <span class="ide">f</span> <span class="com"># create the next iterator in the loop setting it to the given parameter of the map function</span></div></div>  </code></pre>
<p>The above <code>map</code> definition will be translated to:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">inlineMap</span><span class="op">*</span>(<span class="ide">ext</span>: <span class="ide">ExtNimNode</span>) {<span class="op">.</span><span class="ide">compileTime</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="com"># do some parameter checks</span></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">len</span> <span class="op">-</span> <span class="num">1</span> <span class="op">&gt;</span> <span class="num">1</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">zfFail</span>(<span class="str">&quot;too many arguments in </span>\'<span class="str">$1</span>\'<span class="str">, got $2 but expected only $3&quot;</span> <span class="op">%</span></div></div><div class="line"><div class="line-content">        [<span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">repr</span>, <span class="op">$</span>(<span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">len</span> <span class="op">-</span> <span class="num">1</span>), <span class="op">$</span><span class="num">1</span>])</div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">f</span> <span class="op">=</span> </div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">ext</span><span class="op">.</span><span class="ide">node</span><span class="op">.</span><span class="ide">len</span> <span class="op">&gt;</span> <span class="num">1</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">adapt</span>(<span class="ide">ext</span>, <span class="num">1</span>) <span class="com"># replace all occurences if internal iterator &quot;it&quot; with __it__0, __it__1, etc.</span></div></div><div class="line"><div class="line-content">    <span class="kwd">else</span>: <span class="com"># assert that the argument &apos;f&apos; is supplied</span></div></div><div class="line"><div class="line-content">      <span class="ide">zfFail</span>(<span class="str">&quot;missing argument </span>\'<span class="str">$1</span>\'<span class="str"> for </span>\'<span class="str">$2</span>\'<span class="str">&quot;</span> <span class="op">%</span> [<span class="str">&quot;f&quot;</span>, <span class="str">&quot;map&quot;</span>])</div></div><div class="line"><div class="line-content">      <span class="ide">newIntLitNode</span>(<span class="num">0</span>)</div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">nextIdent</span> <span class="op">=</span> <span class="ide">ext</span><span class="op">.</span><span class="ide">nextItNode</span>() <span class="com"># create the next iterator</span></div></div><div class="line"><div class="line-content">  <span class="com"># the actual &apos;loop&apos; section</span></div></div><div class="line"><div class="line-content">  <span class="ide">ext</span><span class="op">.</span><span class="ide">node</span> <span class="op">=</span> <span class="ide">quote</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> `<span class="ide">nextIdent</span>` <span class="op">=</span> `<span class="ide">f</span>` <span class="com"># here the `it` is replaced by the next iterator</span></div></div>  </code></pre>
<p>The Zero-DSL <code>map</code> function does not set the <code>result</code> as opposed to the <code>count</code> or <code>index</code> definition below - hence the result type is a collection result type, which is determined automatically by the zero_functional framework.
The <code>it</code> again is seen as keyword and the definition <code>let it = ...</code> will internally set the new iterator value which is consequently used by the next functions. In the generated macro it is replaced by the call <code>ext.nextItNode</code>.</p>
<p>While Zero-DSL is quite powerful, not all possibilities can be handled by it when implementing a function. For instance the <code>foreach</code> implementation is done completely manually and <code>reduce</code> and other functions use the macro <code>zfInlineCall</code> which provides Zero-DSL within a manual function implementation and also registers the function name.
The signature for creating an inline function is as in the <code>inlineMap</code> example above - each function <code>foo</code> is implemented by its <code>inlineFoo*(ext: ExtNimNode)</code> counterpart.</p>
<p>If the Zero-DSL should fail to create an own implementation of a function then <code>zfInline_dbg</code> instead of <code>zfInline</code> can be used to print the created function to the console, copy it - remember to add the <code>*</code> to the name - and adapt the code.</p>
<p>It is possible to set parameter types for the functions - for example in the <code>index</code> implementation:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zfInline</span> <span class="ide">index</span>(<span class="ide">cond</span>: <span class="ide">bool</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">init</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span> <span class="com"># index not found</span></div></div><div class="line"><div class="line-content">  <span class="ide">loop</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">cond</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">return</span> <span class="ide">idx</span></div></div>  </code></pre>
<p>The <code>cond: bool</code> definition adds additional compile time checks to the generated macros, so that when using the <code>index</code>-function with a different type than <code>bool</code> a compile error with the wrong parameter and the expected type is created.
In this example also the <code>idx</code> variable is replaced automatically with the running index that is increment during the loop.</p>
<p>Note: zfCreateExtension must be called in a compile time context. This could be in a static block or macro for example:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># Register above extensions during compile time</span></div></div><div class="line"><div class="line-content"><span class="kwd">static</span>:</div></div><div class="line"><div class="line-content">  <span class="ide">zfCreateExtension</span>()</div></div>  </code></pre>
<h4>Special variables</h4>
<p>Special variables for <code>zfInline</code> statements are:</p>
<ul>
<li><code>it</code>: when used is the previous iterator, when defined with <code>let it = </code> creates a new iterator, in the <code>init</code> section <code>it</code> refers to the first element in the underlying collection</li>
<li><code>idx</code>: the running index in the loop</li>
<li><code>result</code>: the overall result and return type of the operation
All other variables have to be defined in the <code>pre</code>-section, also when automatically assigned, e.g. when overriding the <code>idx</code> variable or when accessing a reference to the list as <code>listRef</code>.</li>
</ul>
<p>See <code>intersect</code> or <code>removeDoubles</code> implementation in <a href="test.nim">test.nim</a> as an example.</p>
<ul>
<li><code>yield it</code>: opposed to setting the result this means that an iterator or a collection result is returned with <code>it</code> being added to it.</li>
<li><code>yield &lt;varname&gt;</code> in <code>final</code> section: the <code>&lt;varname&gt;</code> is added to the result at the end</li>
</ul>
<h4>Setting the result</h4>
<p>Example of <code>count</code> that sets a result:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zfInline</span> <span class="ide">count</span>():</div></div><div class="line"><div class="line-content">  <span class="ide">init</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">=</span> <span class="num">0</span></div></div><div class="line"><div class="line-content">  <span class="ide">loop</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">+=</span> <span class="num">1</span> <span class="com"># add one in each loop</span></div></div>  </code></pre>
<p>Functions that set a result in any section are considered final functions - no other function may follow. Opposed to using <code>yield</code> used for iterator results:</p>
<p>Example of <code>filter</code> that returns a collection / iterator:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zfInline</span> <span class="ide">filter</span>(<span class="ide">cond</span>: <span class="ide">bool</span>):</div></div><div class="line"><div class="line-content">  <span class="ide">loop</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">cond</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">yield</span> <span class="ide">it</span> <span class="com"># add the current iterator to the resulting collection</span></div></div>  </code></pre>
<h3>Defering to Zero-DSL inside plain nim</h3>
<p>As Zero-DSL is limited in its expressiveness - e.g. there is no possibility to defer to a different loop implementation depending on the input type - it is possible to defer to different Zero-DSL implementations in the nim code using <code>zfInlineCall</code>. Example calling two implementations - one specialized to work on lists, the other for sequences:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">inlineFoo</span><span class="op">*</span>(<span class="ide">ext</span>: <span class="ide">ExtNimNode</span>) {<span class="op">.</span><span class="ide">compileTime</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">ext</span><span class="op">.</span><span class="ide">isListType</span>():</div></div><div class="line"><div class="line-content">    <span class="com"># provide list implementation</span></div></div><div class="line"><div class="line-content">    <span class="ide">zfInlineCall</span> <span class="ide">foo</span>(<span class="ide">param</span>):</div></div><div class="line"><div class="line-content">      <span class="op">...</span> </div></div><div class="line"><div class="line-content">  <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">    <span class="com"># provide plain implementation (e.g. using [])</span></div></div><div class="line"><div class="line-content">    <span class="ide">zfInlineCall</span> <span class="ide">reduce</span>(<span class="ide">op</span>):</div></div><div class="line"><div class="line-content">      <span class="op">...</span></div></div>  </code></pre>
<h4>Creating compound commands with other commands</h4>
<p>Zero-DSL can create commands as a sequence from already existing commands using the <code>delegate</code> section - which essentially calls the functions in that section.
Example is the <code>removeDoubles</code> function that returns the input sequence with unique elements. See code in <a href="test.nim">test.nim</a>.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">zfInline</span> <span class="ide">removeDoubles</span>():</div></div><div class="line"><div class="line-content"><span class="com"># remove double elements. </span></div></div><div class="line"><div class="line-content">  <span class="ide">pre</span>:</div></div><div class="line"><div class="line-content">    <span class="com"># initialize variables in `ext` that are used below</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">listRef</span> <span class="op">=</span> <span class="ide">ext</span><span class="op">.</span><span class="ide">listRef</span></div></div><div class="line"><div class="line-content">  <span class="ide">delegate</span>:</div></div><div class="line"><div class="line-content">    <span class="com"># this actually only works only on the original list / iterator</span></div></div><div class="line"><div class="line-content">    <span class="ide">indexedCombinations</span>(<span class="ide">listRef</span>) <span class="com"># combine with itself - all elements</span></div></div><div class="line"><div class="line-content">    <span class="com"># this is the tricky one: remove later elements that already are in the list</span></div></div><div class="line"><div class="line-content">    <span class="com"># this actually translates in the inner for loop of combinations as:</span></div></div><div class="line"><div class="line-content">    <span class="com"># if idx[0] &gt; idx[1] and it[0] == it[1]: break</span></div></div><div class="line"><div class="line-content">    <span class="ide">takeWhile</span>(<span class="kwd">not</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">elem</span>[<span class="num">0</span>] <span class="op">==</span> <span class="ide">it</span><span class="op">.</span><span class="ide">elem</span>[<span class="num">1</span>] <span class="kwd">and</span> <span class="ide">it</span><span class="op">.</span><span class="ide">idx</span>[<span class="num">0</span>] <span class="op">&gt;</span> <span class="ide">it</span><span class="op">.</span><span class="ide">idx</span>[<span class="num">1</span>])) </div></div><div class="line"><div class="line-content">    <span class="com"># go back to the original elements</span></div></div><div class="line"><div class="line-content">    <span class="ide">filter</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">idx</span>[<span class="num">0</span>] <span class="op">==</span> <span class="ide">it</span><span class="op">.</span><span class="ide">idx</span>[<span class="num">1</span>]) </div></div><div class="line"><div class="line-content">    <span class="ide">map</span>(<span class="ide">it</span><span class="op">.</span><span class="ide">elem</span>[<span class="num">0</span>])</div></div>  </code></pre>
<h2>Overview Table</h2>
<p>The result type depends on the function used as last parameter.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>1st Param</th>
<th>in-between</th>
<th>Last Param</th>
<th>Result Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>all</td>
<td />
<td />
<td>+</td>
<td>  <code>bool</code></td>
</tr>
<tr>
<td>combinations</td>
<td>+</td>
<td>(+)</td>
<td>(+)</td>
<td>  <code>coll[Combination]</code></td>
</tr>
<tr>
<td>concat</td>
<td>+</td>
<td />
<td />
<td>coll</td>
</tr>
<tr>
<td>exists</td>
<td />
<td />
<td>+</td>
<td>bool</td>
</tr>
<tr>
<td>filter</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>part coll / zeroed array</td>
</tr>
<tr>
<td>find</td>
<td />
<td />
<td>+</td>
<td>  <code>int</code></td>
</tr>
<tr>
<td>flatten</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>coll</td>
</tr>
<tr>
<td>fold</td>
<td />
<td />
<td>+</td>
<td>*</td>
</tr>
<tr>
<td>foreach</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>  <code>void</code></td>
</tr>
<tr>
<td>group</td>
<td />
<td />
<td>+</td>
<td>  <code>table[*, seq[*]]</code></td>
</tr>
<tr>
<td>index</td>
<td />
<td />
<td>+</td>
<td>  <code>int</code></td>
</tr>
<tr>
<td>indexedMap</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>  <code>seq[(int,*)]</code></td>
</tr>
<tr>
<td>enumerate</td>
<td />
<td>+</td>
<td>+</td>
<td>  <code>seq[(int,*)]</code></td>
</tr>
<tr>
<td>createIter</td>
<td />
<td />
<td>virtual</td>
<td>iterator of given type</td>
</tr>
<tr>
<td>map</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>  <code>collType[*]</code></td>
</tr>
<tr>
<td>partition</td>
<td />
<td />
<td>+</td>
<td>  <code>(yes:seq[*], no:seq[*])</code></td>
</tr>
<tr>
<td>reduce</td>
<td />
<td />
<td>+</td>
<td>*</td>
</tr>
<tr>
<td>sub</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>part coll / zeroed array</td>
</tr>
<tr>
<td>split</td>
<td />
<td />
<td>+</td>
<td>  <code>(seq[*],...seq[*])</code></td>
</tr>
<tr>
<td>zip</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>  <code>seq[(*,..,*)]</code></td>
</tr>
<tr>
<td>to</td>
<td />
<td />
<td>virtual</td>
<td>given type</td>
</tr></tbody></table>
<ul>
<li>*: any type depending on given function parameters</li>
<li>coll: is the input collection</li>
<li>collType is the input collection type (without template argument)</li>
<li>&quot;virtual&quot; function: can only be given as last argument, but does not count as last argument.</li>
</ul>
<h2>Debugging using <code>--&gt;&gt;</code></h2>
<p>As <code>zero_functional</code> macros are sometimes tricky to use, it can happen that the compiler crashes or that compile errors are hard to understand.</p>
<p>To see the actual code that is generated (provided the generation itself does not crash) you can use the <code>--&gt;&gt;</code> operator which prints the representation <code>repr</code> of the actual generated nim code.
It is also useful for checking what the macros are generating under the hood.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">a</span> <span class="op">=</span> [<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>]</div></div><div class="line"><div class="line-content"><span class="ide">a</span> <span class="op">--&gt;&gt;</span> <span class="ide">foreach</span>(<span class="ide">echo</span>(<span class="ide">it</span>))</div></div>  </code></pre>
<p>will print during compilation:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">block</span>:</div></div><div class="line"><div class="line-content">  <span class="kwd">for</span> <span class="ide">it0</span> <span class="kwd">in</span> <span class="ide">a</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span>(<span class="ide">it0</span>)</div></div>  </code></pre>
<p>The printed code can be copied to your actual program for further investigation.</p>
<h2>Compile flags</h2>
<p>The following compile flags are supported:</p>
<ul>
<li><code>-d:zf_iter</code> defaults to generating closure iterators instead of <code>seq</code> outputs.</li>
<li><code>-d:zf_list</code> same as above but generating <code>DoublyLinkedList</code></li>
<li><code>-d:zf_debug_all</code> print all generated code</li>
</ul>
<h2>LICENSE</h2>
<p>MIT, Alexander Ivanov</p>
<h2>Contributors</h2>
<p>Co-maintainers and authors: <a href="https://github.com/michael72">Michael Schulte</a>, Alexander Ivanov</p>
<p>Creator: Alexander Ivanov</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/zero-functional/zero-functional">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-04-22T01:19:16Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
