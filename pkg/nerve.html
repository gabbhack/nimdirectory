<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">nerve</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">rpc</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">framework</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">web</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">json</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">api</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">library</button></a>
                </span>
            
        </p>
        
            <p class="pkg-desc">A RPC framework for building web APIs</p>
        
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install nerve" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>Nerve RPC</h1>
<p>Nerve is a RPC framework for building APIs in Nim. It prioritizes flexibility, ease of use, and performance. Nerve provides a compile time macro that generates both an efficient router for dispatching RPC requests on the server, as well as a complete, fully typed, client for both native and JavaScript targets.</p>
<h3>Install</h3>
<p>Nerve is available on Nim&apos;s builtin package manager, <a href="https://github.com/nim-lang/nimble">nimble</a>.</p>
<p>  <code>nimble install nerve</code></p>
<h3>Goals:</h3>
<ul>
<li>Reduce the incidental complexity around declaring and calling remote procedures. Declaring remote procedures should be as simple as declaring local procedures, and calling them should be as simple as calling local procedures.</li>
<li>Be fast. Nim generates performant native binaries, and Nerve aims to utilize that speed.</li>
<li>Have a low cognitive overhead. Nerve does most of the heavy lifting with one macro, supported by a handful of utilities.</li>
</ul>
<h3>Non-goals:</h3>
<ul>
<li>Be a general purpose RPC server or client. Nerve implements JSON RPC, so external clients can be written. But it is designed to be used with the built in client, and ease of use for that client is top priority.</li>
</ul>
<h1>Hello World</h1>
<p>The following <code>main.nim</code> is a Nerve server, native client, and Javascript client. Compile and run the server with <code>nim c -r -d:nerveServer main.nim</code>. In a seperate tab, compile and run the native client with <code>nim c -r -d:nerveClient main.nim</code>. Compile the Javascript client with <code>nim js -d:nerveClient main.nim</code> and open <code>localhost:1234</code> in a browser to view the browser console.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># main.nim</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">nerve</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Declare the service with Nerve&apos;s service macro, provide an identifier and uri</span></div></div><div class="line"><div class="line-content"><span class="ide">service</span> <span class="ide">HelloService</span>, <span class="str">&quot;/api&quot;</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># Declare procs for the service using Nim&apos;s normal proc definitions</span></div></div><div class="line"><div class="line-content">  <span class="kwd">proc</span> <span class="ide">greet</span>(<span class="ide">name</span> <span class="op">=</span> <span class="str">&quot;world&quot;</span>): <span class="ide">Future</span>[<span class="ide">string</span>] <span class="op">=</span> <span class="ide">futureWrap</span>(<span class="str">&quot;Hello &quot;</span> <span class="op">&amp;</span> <span class="ide">name</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="kwd">proc</span> <span class="ide">runTask</span>(<span class="ide">task</span>: <span class="ide">string</span>): <span class="ide">Future</span>[<span class="ide">void</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="str">&quot;Running task &quot;</span> <span class="op">&amp;</span> <span class="ide">task</span></div></div><div class="line"><div class="line-content">    <span class="ide">result</span> <span class="op">=</span> <span class="ide">voidFuture</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># Modifier macro to setup the http server</span></div></div><div class="line"><div class="line-content">  <span class="ide">server</span>:</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com"># Import and setup Nim&apos;s built in http server</span></div></div><div class="line"><div class="line-content">    <span class="kwd">import</span> <span class="ide">asyncHttpServer</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">server</span> <span class="op">=</span> <span class="ide">newAsyncHttpServer</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com"># Create a RPC server for the declared Nerve service</span></div></div><div class="line"><div class="line-content">    <span class="kwd">let</span> <span class="ide">helloServer</span> <span class="op">=</span> <span class="ide">HelloService</span><span class="op">.</span><span class="ide">newServer</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="com"># Handler for the http server</span></div></div><div class="line"><div class="line-content">    <span class="kwd">proc</span> <span class="ide">cb</span> (<span class="ide">req</span>: <span class="ide">Request</span>) {<span class="op">.</span><span class="ide">async</span>, <span class="ide">gcsafe</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">      <span class="kwd">case</span> <span class="ide">req</span><span class="op">.</span><span class="ide">url</span><span class="op">.</span><span class="ide">path</span></div></div><div class="line"><div class="line-content">      <span class="kwd">of</span> <span class="ide">HelloService</span><span class="op">.</span><span class="ide">rpcUri</span>:</div></div><div class="line"><div class="line-content">        <span class="com"># If a request has the service uri, dispatch the request to the service</span></div></div><div class="line"><div class="line-content">        <span class="ide">await</span> <span class="ide">req</span><span class="op">.</span><span class="ide">respond</span>(<span class="ide">Http200</span>, <span class="op">$</span> <span class="ide">await</span> <span class="ide">helloServer</span><span class="op">.</span><span class="ide">routeRpc</span>(<span class="ide">req</span><span class="op">.</span><span class="ide">body</span>))</div></div><div class="line"><div class="line-content">      <span class="kwd">of</span> <span class="str">&quot;/client.js&quot;</span>:</div></div><div class="line"><div class="line-content">        <span class="com"># JavaScript file for the frontend</span></div></div><div class="line"><div class="line-content">        <span class="kwd">let</span> <span class="ide">headers</span> <span class="op">=</span> <span class="ide">newHttpHeaders</span>()</div></div><div class="line"><div class="line-content">        <span class="ide">headers</span>[<span class="str">&quot;Content-Type&quot;</span>] <span class="op">=</span> <span class="str">&quot;application/javascript&quot;</span></div></div><div class="line"><div class="line-content">        <span class="ide">await</span> <span class="ide">req</span><span class="op">.</span><span class="ide">respond</span>(<span class="ide">Http200</span>, <span class="ide">readFile</span>(<span class="str">&quot;main.js&quot;</span>), <span class="ide">headers</span>)</div></div><div class="line"><div class="line-content">      <span class="kwd">of</span> <span class="str">&quot;/&quot;</span>:</div></div><div class="line"><div class="line-content">        <span class="com"># HTML file for the frontend</span></div></div><div class="line"><div class="line-content">        <span class="ide">await</span> <span class="ide">req</span><span class="op">.</span><span class="ide">respond</span>(<span class="ide">Http200</span>, """<html><head><meta charset="UTF-8"></head><body>Testing</body><script src="client.js"></script></html>""")</div></div><div class="line"><div class="line-content">      <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">        <span class="ide">await</span> <span class="ide">req</span><span class="op">.</span><span class="ide">respond</span>(<span class="ide">Http404</span>, <span class="str">&quot;Not Found&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="ide">waitFor</span> <span class="ide">server</span><span class="op">.</span><span class="ide">serve</span>(<span class="ide">Port</span>(<span class="num">1234</span>), <span class="ide">cb</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># Modifier macro to setup the http client</span></div></div><div class="line"><div class="line-content">  <span class="ide">client</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">const</span> <span class="ide">host</span> <span class="op">=</span> <span class="kwd">if</span> <span class="ide">defined</span>(<span class="ide">js</span>): <span class="str">&quot;&quot;</span> <span class="kwd">else</span>: <span class="str">&quot;http://127.0.0.1:1234&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">proc</span> <span class="ide">main</span>() {<span class="op">.</span><span class="ide">async</span><span class="op">.</span>} <span class="op">=</span></div></div><div class="line"><div class="line-content">      <span class="com"># Create a RPC client for the declared Nerve service</span></div></div><div class="line"><div class="line-content">      <span class="kwd">let</span> <span class="ide">helloClient</span> <span class="op">=</span> <span class="ide">HelloService</span><span class="op">.</span><span class="ide">newHttpClient</span>(<span class="ide">host</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="com"># Use the remote methods defined on the service</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">      <span class="ide">echo</span> <span class="ide">await</span> <span class="ide">helloClient</span><span class="op">.</span><span class="ide">greet</span>(<span class="str">&quot;Nerve&quot;</span>) <span class="com"># Prints &quot;Hello Nerve&quot; to the console</span></div></div><div class="line"><div class="line-content">      <span class="ide">await</span> <span class="ide">helloClient</span><span class="op">.</span><span class="ide">runTask</span>(<span class="str">&quot;serverside_task&quot;</span>) <span class="com"># Prints &quot;Running task serverside_task&quot; on the server</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">    <span class="kwd">when</span> <span class="ide">defined</span>(<span class="ide">js</span>):</div></div><div class="line"><div class="line-content">      <span class="kwd">discard</span> <span class="ide">main</span>()</div></div><div class="line"><div class="line-content">    <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">waitFor</span> <span class="ide">main</span>()</div></div>  </code></pre>
<h1>Overview</h1>
<p>The majority of Nerve&apos;s functionality is provided by the main <code>nerve</code> module.</p>
<h2><code>service</code> macro</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">service</span><span class="op">*</span>(<span class="ide">name</span>: <span class="ide">untyped</span>, <span class="ide">uri</span>: <span class="ide">untyped</span> <span class="op">=</span> <span class="kwd">nil</span>, <span class="ide">body</span>: <span class="ide">untyped</span> <span class="op">=</span> <span class="kwd">nil</span>): <span class="ide">untyped</span></div></div>  </code></pre>
<p>Nerve&apos;s <code>service</code> macro is responsible for doing all of the setup and code generation required for RPC services. It takes an identifier, an optional uri, and a list of normal Nim procedures as its body. It produces an RpcService (accessible via the identifier) that can be instantiated into either a client or a server object with fields for each of the provided procs. The macro generates an object type that extends the <code>RPCServerInst</code> type provided by Nerve that describes instances of service clients and service servers. The macro also generates a dispatch function that dispatches incoming requests to the correct proc on the service. The provided procedures must have a return type of <code>Future[T]</code>, as the client will always use these functions asynchronusly.</p>
<p>By default, the <code>service</code> macro produces both the client and server code for each service. Nerve provides serveral methods for controlling what code is generated (see configuration), which could be desirable if proc implementations contain code specific to the server target. As file with the <code>service</code> macro can be compiled for both native and JS targets, those files should focus <em>only</em> on the API functionality. Be aware that any types used and any modules imported by the API files also should to be accessible on both targets. The <code>serverImports</code> macro modifier can be used to import certain modules only on the server, which is useful for any proc implementation containing server specific code.</p>
<h2><code>newServer</code> macro</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">newServer</span><span class="op">*</span>(<span class="ide">rpc</span>: <span class="kwd">static</span>[<span class="ide">RpcService</span>], <span class="ide">injections</span>: <span class="ide">varargs</span>[<span class="ide">untyped</span>]): <span class="ide">untyped</span></div></div>  </code></pre>
<p>The <code>newServer</code> macro takes a service defined with <code>service</code> and instantiates a RPC server. The created service instance can then use <code>routeRpc</code> to take a <code>string</code> or <code>JsonNode</code>, dispatch the request, and return a response. The server instance provides only this dispatch functionality; it does not listen to any ports or otherwise connect to the network. The user must setup their HTTP server (or server for any other protocol) and then call the RPC server when a request comes that should be handled by the RPC server. The <code>newServer</code> macro optionally takes injected variables, see the <code>inject</code> modifier for more information.</p>
<h2><code>newClient</code> and <code>newHttpClient</code> macros</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">newClient</span><span class="op">*</span>(<span class="ide">rpc</span>: <span class="kwd">static</span>[<span class="ide">RpcService</span>], <span class="ide">driver</span>: <span class="ide">NerveDriver</span>): <span class="ide">untyped</span></div></div><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">newHttpClient</span><span class="op">*</span>(<span class="ide">rpc</span>: <span class="kwd">static</span>[<span class="ide">RpcService</span>], <span class="ide">host</span>: <span class="kwd">static</span>[<span class="ide">string</span>] <span class="op">=</span> <span class="str">&quot;&quot;</span>): <span class="ide">untyped</span></div></div>  </code></pre>
<p>The <code>newClient</code> macro takes a service defined with <code>service</code> and a driver, and instantiates a RPC client. The driver is a function responsible for making the requests to the server and returning the response. Drivers can be found in the <code>nerve/driver</code> module, or user defined. The <code>newHttpClient</code> macro combines the <code>newClient</code> macro with the an HTTP driver for convenience.</p>
<h2><code>serverImport</code> modifier</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">serverImport</span><span class="op">*</span>(<span class="ide">imports</span>: <span class="ide">untyped</span>)</div></div>  </code></pre>
<p>In the web domain, its likely that servers will contain server specific code from modules that interact with databases, other servers, or filesystems. The <code>serverImport</code> modifier gives the <code>service</code> macro the import modules only when the service is configured as a server.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">service</span> <span class="ide">FileService</span>, <span class="str">&quot;/api/file&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">serverImport</span>(<span class="ide">os</span>)</div></div><div class="line"><div class="line-content">    </div></div><div class="line"><div class="line-content">    <span class="kwd">proc</span> <span class="ide">save</span>(<span class="ide">filename</span>, <span class="ide">text</span>: <span class="ide">string</span>): <span class="ide">Future</span>[<span class="ide">void</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content">        <span class="com"># Use procs from the os module here</span></div></div>  </code></pre>
<h2><code>inject</code> modifier</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">inject</span><span class="op">*</span>(<span class="ide">injections</span>: <span class="ide">untyped</span>)</div></div>  </code></pre>
<p>All of the parameters for the RPC procedures must come from the client. However, Nerve provides a method for injecting variables from the server (such as client connection references, a service client, or anything that doesn&apos;t serialize well). To define variables for injection, place an <code>inject</code> statement in the service declaration. In the inject statement, include <code>var</code> definitions for the desired variables. These variable can then be used in any of the RPC procs. The actual injection is done in the <code>newServer</code> constructor, where the injected variables are provided to the server.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">service</span> <span class="ide">GreetingService</span>, <span class="str">&quot;/api/greeting&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="ide">inject</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">var</span> </div></div><div class="line"><div class="line-content">          <span class="ide">id</span> <span class="op">=</span> <span class="num">100</span></div></div><div class="line"><div class="line-content">          <span class="ide">count</span>: <span class="ide">int</span></div></div><div class="line"><div class="line-content">        <span class="kwd">var</span> <span class="ide">uuid</span> <span class="op">=</span> <span class="str">&quot;asdf&quot;</span></div></div><div class="line"><div class="line-content">        </div></div><div class="line"><div class="line-content">    <span class="kwd">proc</span> <span class="ide">greet</span>(<span class="ide">greeting</span> <span class="op">=</span> <span class="str">&quot;Hello&quot;</span>, <span class="ide">name</span> <span class="op">=</span> <span class="str">&quot;World&quot;</span>): <span class="ide">Future</span>[<span class="ide">string</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content">        <span class="ide">echo</span> <span class="ide">uuid</span></div></div><div class="line"><div class="line-content">        <span class="ide">futureWrap</span>(<span class="ide">greeting</span> <span class="op">&amp;</span> <span class="str">&quot; &quot;</span> <span class="op">&amp;</span> <span class="ide">name</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">server</span> <span class="op">=</span> <span class="ide">GreetingService</span><span class="op">.</span><span class="ide">newServer</span>(<span class="ide">count</span> <span class="op">=</span> <span class="num">1</span>, <span class="ide">uuid</span> <span class="op">=</span> <span class="str">&quot;fdsa&quot;</span>)</div></div>  </code></pre>
<h2><code>server</code> and <code>client</code> modifiers</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">server</span><span class="op">*</span>(<span class="ide">serverStmts</span>: <span class="ide">untyped</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">macro</span> <span class="ide">client</span><span class="op">*</span>(<span class="ide">clientStmts</span>: <span class="ide">untyped</span>)</div></div>  </code></pre>
<p>The RPC clients and servers can be setup anywhere in the codebase, and can even be instantiated multiple times. However, it might be convenient to initialize a single instance of a client and server in the same file as the service declaration. The <code>server</code> and <code>client</code> modifiers enable this functionality. Each takes a code block, and executes that codeblock if the services is configured as a server or client, respectively (both will be executed if the service is configured to be both a server and a client). These macros can also be used to setup all the server and client code (as in the Hello World example), though this is only recommended for simple server/client setups.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">service</span> <span class="ide">GreetingService</span>, <span class="str">&quot;/api/greeting&quot;</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">proc</span> <span class="ide">greet</span>(<span class="ide">greeting</span> <span class="op">=</span> <span class="str">&quot;Hello&quot;</span>, <span class="ide">name</span> <span class="op">=</span> <span class="str">&quot;World&quot;</span>): <span class="ide">Future</span>[<span class="ide">string</span>] <span class="op">=</span></div></div><div class="line"><div class="line-content"> <span class="ide">    futureWrap</span>(<span class="ide">greeting</span> <span class="op">&amp;</span> <span class="str">&quot; &quot;</span> <span class="op">&amp;</span> <span class="ide">name</span>)</div></div><div class="line"><div class="line-content"> <span class="ide">    </span></div></div><div class="line"><div class="line-content">    <span class="ide">server</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">let</span> <span class="ide">greetingServer</span><span class="op">*</span> <span class="op">=</span> <span class="ide">GreetingService</span><span class="op">.</span><span class="ide">newServer</span>()</div></div><div class="line"><div class="line-content">        </div></div><div class="line"><div class="line-content">    <span class="ide">client</span>:</div></div><div class="line"><div class="line-content">        <span class="kwd">let</span> <span class="ide">greetingClient</span><span class="op">*</span> <span class="op">=</span> <span class="ide">GreetingService</span><span class="op">.</span><span class="ide">newHttpClient</span>()</div></div>  </code></pre>
<h2>nerve/drivers</h2>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">type</span> <span class="ide">NerveDriver</span><span class="op">*</span> <span class="op">=</span> <span class="kwd">proc</span> (<span class="ide">req</span>: <span class="ide">JsonNode</span>): <span class="ide">Future</span>[<span class="ide">JsonNode</span>] {<span class="op">.</span><span class="ide">gcsafe</span><span class="op">.</span>}</div></div>  </code></pre>
<p>Nerve uses drivers to power its clients. The driver recieves a completed JSON RPC request, and is responsible for sending that to the server and returning the JSON RPC response. The <code>nerve/drivers</code> module provides common drivers (such as an http driver), but user defined drivers can be used as well. The <code>nerve</code> module exports the <code>nerve/drivers</code> modules, so it is not necessary to import <code>drivers</code> separately.</p>
<h2>nerve/promises</h2>
<p>The <code>promises</code> module provides target neutral (importable for both JS and native compiles) access to <code>Future[T]</code> types, as well as some helper functions. It is imported automatically when the <code>service</code> macro runs, and is accessible from any of the service procs or modifiers.</p>
<h2>nerve/websockets</h2>
<p>Nerve has experimental support for Websockets as transport layer. It includes a websocket type built on top of treeform&apos;s <a href="https://github.com/treeform/ws">ws</a> library on native clients, and the default built in browser implementation for JavaScript. Checkout Nerve&apos;s test suites for usage of the provided websocket driver and message callbacks.</p>
<h1>Configuration</h1>
<p>The default behavior of the <code>service</code> macro is to produce both client and server code, but Nerve provides several options to configure this. The <code>nerve</code> module contains a <code>setDefaultConfig</code> macro that change the default behvior to produce either a server or a client. The <code>setDefaultConfig</code> macro takes a <code>ServiceConfigKind</code>: an enum that describes the different config options. The default can also be changed by defining the symbol <code>nerveClient</code> or <code>nerveServer</code> with the <code>-d</code> nim compiler flag. The final and most granular method of configuration is the <code>configureNerve</code> macro. The <code>configureNerve</code> macro takes a table of service identifiers to <code>ServiceConfigKind</code>. Important note: <code>configureNerve</code> and <code>setDefaultConfig</code> must run before the service module to correctly instantiates it. This means the macro call must run before the import of the service module.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">setDefaultConfig</span>(<span class="ide">sckServer</span>)</div></div><div class="line"><div class="line-content"><span class="ide">configureNerve</span>({</div></div><div class="line"><div class="line-content">    <span class="ide">GrettingService</span>: <span class="ide">sckClient</span>,</div></div><div class="line"><div class="line-content">    <span class="ide">FileService</span>: <span class="ide">sckServer</span></div></div><div class="line"><div class="line-content">})</div></div>  </code></pre>
<h1>Errors</h1>
<p>Errors in RPC calls are propogated to the client. The client code will throw an <code>RpcError</code> with information from the error thrown on the server. If the server responds with a non-200 error code, the client throws an <code>InvalidResponseError</code>. The server throws errors for incorrect requests, per the JSON-RPC spec.</p>
<h1>Gotchas</h1>
<p>Nerve trys to be as low friction as possible. However there are a couple edges to watch for.</p>
<ol>
<li>Procedures under the same RPC server must have different names. No static method dispatch is possible.</li>
<li>Generic procs are also not possible.</li>
<li>The <code>service</code> macro doesn&apos;t mesh well with the Nim&apos;s <code>async</code> macro. See the section on promises for work arounds and more information.</li>
</ol>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        MIT
                    </p>
                

                
                    <p> <a href="https://github.com/nepeckman/nerve-rpc">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2024-03-20T01:07:05Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
