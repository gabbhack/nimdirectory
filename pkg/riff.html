<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">riff</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">riff</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">iff</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">interchange file format</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">library</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">endianness</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">io</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("RIFF file handling for Nim ")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install riff" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>nim-riff</h1>
<h2>Overview</h2>
<p><strong>nim-riff</strong> is a library for reading and writing <a href="https://en.wikipedia.org/wiki/Resource_Interchange_File_Format">Resource Interchange File
Format (RIFF)</a>
files. RIFF is heavily inspired by Electronic Arts&apos; <a href="https://en.wikipedia.org/wiki/Interchange_File_Format">Interchange File Format
(IFF)</a>, introduced in
1985 on the best personal computer ever, the legendary <a href="https://en.wikipedia.org/wiki/Amiga">Commodore
Amiga</a>.</p>
<p>If we&apos;re only considering existing file formats, a generic RIFF library like
this has little use outside of handling
<a href="https://en.wikipedia.org/wiki/WAV">WAV</a>,
<a href="https://en.wikipedia.org/wiki/Audio_Video_Interleave">AVI</a> and
<a href="https://en.wikipedia.org/wiki/WebP">WebP</a> files (the most common RIFF based
format). What I personally think it is
really good for, though, is implementing your own hierarchical binary file
formats (for example, <a href="https://github.com/johnnovak/gridmonger">Gridmonger</a>
stores its documents in RIFF format). It is an excellent alternative to
<del>bloated garbage like XML</del> other hierarchical file formats less suitable for
storing binary data, such as XML.</p>
<p>To learn more about RIFF, please refer to the <a href="#references--reading-materials">References &amp; reading materials
section</a>.</p>
<h3>Main features</h3>
<ul>
<li>Reading and writing of little-endian (<code>RIFF</code>) and big-endian (<code>RIFX</code>) RIFF files</li>
<li>Strict adherence to the RIFF standard</li>
<li>Convenient helper methods to navigate the chunk hierarchy (with cursor support)</li>
<li>The reader treats chunks as virtual files</li>
<li>The writer recursively auto-updates all parent chunk sizes to minimise the
chance of creating malformed files</li>
</ul>
<h3>Use it if</h3>
<ul>
<li>You need to store hierarchical binary data in an efficient and extensible way</li>
<li>You don&apos;t want to deal with the parsing overhead of other formats like
XML, JSON, etc. (such formats are ill-suited for binary data anyway)</li>
<li>You&apos;re an Amiga fan â€” true Amiga fans hunt for opportunities to use IFF-like
formats as much as possible :sunglasses:</li>
</ul>
<h3>Don&apos;t use it if</h3>
<ul>
<li>You need to store more than 4 GB in a single chunk or file</li>
<li>You want to read data from malformed RIFF files, or you want to attempt to
repair them. For these use cases this library is not a good fit because it
expects perfect RIFF files with no errors. Repairing RIFF files
generically is not really possible without some extra knowledge about the
particular file format you&apos;re dealing with (e.g. WAV, AVI, etc.), so
you&apos;ll probably need to something custom anyway.</li>
</ul>
<h2>Installation</h2>
<p><strong>nim-riff</strong> can be installed via Nimble:</p>
<pre>  <code>nimble install riff
</code></pre>
<h2>Compiling the examples</h2>
<p>The examples require the <code>simple_parseopt</code> module, so install that first:</p>
<pre>  <code>nimble install simple_parseopt
</code></pre>
<p>Then you can compile the examples in debug or release mode:</p>
<pre>  <code>nimble examples
nimble examplesDebug
</code></pre>
<h2>Usage</h2>
<h3>Reading RIFF files</h3>
<h4>Opening a file</h4>
<p>To open a RIFF file for reading, you&apos;ll need to provide a filename or an
existing file handle to the <code>openRiffFile()</code> proc. You can also optionally
override the default buffer size.</p>
<p>This will create a <code>RiffReader</code> object on success, or raise
a <code>RiffReaderError</code> if something went wrong (just like all reader methods in
case of an error).</p>
<p>When you&apos;re done with a reader, you can close it with the <code>close()</code> method.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">riff</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">r</span>: <span class="ide">RiffReader</span></div></div><div class="line"><div class="line-content"><span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="str">&quot;infile&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="str">&quot;infile&quot;</span>, <span class="ide">bufsize</span><span class="op">=</span><span class="num">8192</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">f</span> <span class="op">=</span> <span class="ide">open</span>(<span class="str">&quot;infile&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="ide">f</span>)</div></div><div class="line"><div class="line-content"><span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="ide">f</span>, <span class="ide">bufSize</span><span class="op">=</span><span class="num">8192</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">close</span>()</div></div>  </code></pre>
<h4>Navigating the chunks</h4>
<p>The reader has the concept of the <em>current chunk</em>, you can think of it as
a cursor. Right after successfully opening a file, the current chunk is set to
the root RIFF chunk, which is a group chunk itself.</p>
<p>The <code>currentChunk()</code> method returns information about the current chunk as
a <code>ChunkInfo</code> object, which has the following fields:</p>
<ul>
<li>
<p><code>id</code> <em>string</em> â€“ 4-char chunk ID (FourCC)</p>
</li>
<li>
<p><code>size</code> <em>uint32</em> â€“ chunk data length in bytes (not including the 8-byte
chunk headers, nor the optional padding byte if the length is odd)</p>
</li>
<li>
<p><code>filePos</code> <em>int64</em> â€“ absolute file position of the chunk (the first byte of the chunk
header)</p>
</li>
<li>
<p><code>kind</code> <em>ChunkKind</em> â€“ <code>ckGroup</code> for group chunks (<code>RIFF</code> and <code>LIST</code>), <code>ckChunk</code> for normal chunks</p>
</li>
<li>
<p><code>formatTypeId</code> <em>string</em> â€“ for group chunks only: format type FourCC of the group</p>
</li>
</ul>
<p><code>nextChunk()</code> moves the cursor to the next chunk within the current group
chunk and returns its <code>ChunkInfo</code>, or raises an error if we&apos;re already at the
last subchunk. It&apos;s best to use <code>hasNextChunk()</code> before calling <code>nextChunk()</code>
to prevent these errors.</p>
<p>This is a simple example that iterates through all the top-level chunks in the
root RIFF group chunk, and prints out their chunk infos:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">riff</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="str">&quot;test.wav&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">ci</span>: <span class="ide">ChunkInfo</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># info about the root RIFF chunk</span></div></div><div class="line"><div class="line-content"><span class="ide">ci</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">currentChunk</span></div></div><div class="line"><div class="line-content"><span class="ide">echo</span> <span class="ide">ci</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># the root RIFF chunk is a group chunk so it must be entered</span></div></div><div class="line"><div class="line-content"><span class="kwd">if</span> <span class="ide">r</span><span class="op">.</span><span class="ide">hasSubChunks</span>():</div></div><div class="line"><div class="line-content">  <span class="ide">ci</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">enterGroup</span>()</div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="ide">ci</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="com"># iterate through all top-level chunks inside the root RIFF group chunk</span></div></div><div class="line"><div class="line-content">  <span class="kwd">while</span> <span class="ide">r</span><span class="op">.</span><span class="ide">hasNextChunk</span>():</div></div><div class="line"><div class="line-content">    <span class="ide">ci</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">nextChunk</span>()</div></div><div class="line"><div class="line-content">    <span class="ide">echo</span> <span class="ide">ci</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">close</span>()</div></div>  </code></pre>
<h5>Group chunks</h5>
<p>As mentioned above, a chunk can be either a normal chunk (<code>ckChunk</code>) or
a group chunk (<code>ckGroup</code>) that can contain further subchunks. There are only
two types of group chunks: the root <code>RIFF</code> chunk, and <code>LIST</code> chunks.</p>
<p>When the cursor is at a group chunk, you can call <code>enterGroup()</code> to descend
into it. If the group contains subchunks (which can be checked with the
<code>hasSubChunks()</code> method), the cursor will be set to the first child chunk, and
the chunk info will be returned. If the group has no subchunks, an error will
be raised.</p>
<p><code>exitGroup()</code> does the opposite; it moves the cursor up one level to the
parent group chunk.</p>
<h5>Walking the chunk tree</h5>
<p>The chunk hierarchy of a RIFF file is basically a tree structure, and we can
walk this tree with the aforementioned navigation methods:</p>
<ul>
<li><code>enterGroup()</code> moves the cursor to the first child node of the current group node</li>
<li><code>exitGroup()</code> moves the cursor back to the parent node</li>
<li><code>nextChunk()</code> iterates the cursor through sibling nodes</li>
</ul>
<p>Using these methods, it is possible to put together a recursive algorithm that
traverses the whole chunk tree and prints out the chunk infos in
a hierarchical fashion:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">strutils</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">riff</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="str">&quot;test.grm&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">proc</span> <span class="ide">walkChunks</span>(<span class="ide">depth</span>: <span class="ide">Natural</span> <span class="op">=</span> <span class="num">0</span>) <span class="op">=</span></div></div><div class="line"><div class="line-content">  <span class="kwd">let</span> <span class="ide">cc</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">currentChunk</span></div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="str">&quot; &quot;</span><span class="op">.</span><span class="ide">repeat</span>(<span class="ide">depth</span> <span class="op">*</span> <span class="num">2</span>), <span class="ide">cc</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">cc</span><span class="op">.</span><span class="ide">kind</span> <span class="op">==</span> <span class="ide">ckGroup</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">if</span> <span class="ide">r</span><span class="op">.</span><span class="ide">hasSubchunks</span>:</div></div><div class="line"><div class="line-content">      <span class="kwd">discard</span> <span class="ide">r</span><span class="op">.</span><span class="ide">enterGroup</span>()</div></div><div class="line"><div class="line-content">      <span class="ide">walkChunks</span>(<span class="ide">depth</span><span class="op">+</span><span class="num">1</span>)</div></div><div class="line"><div class="line-content">      <span class="ide">r</span><span class="op">.</span><span class="ide">exitGroup</span>()</div></div><div class="line"><div class="line-content">    <span class="kwd">else</span>:</div></div><div class="line"><div class="line-content">      <span class="ide">echo</span> <span class="str">&quot; &quot;</span><span class="op">.</span><span class="ide">repeat</span>((<span class="ide">depth</span><span class="op">+</span><span class="num">1</span>) <span class="op">*</span> <span class="num">2</span>), <span class="str">&quot;&lt;empty&gt;&quot;</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content">  <span class="kwd">if</span> <span class="ide">r</span><span class="op">.</span><span class="ide">hasNextChunk</span>:</div></div><div class="line"><div class="line-content">    <span class="kwd">discard</span> <span class="ide">r</span><span class="op">.</span><span class="ide">nextChunk</span>()</div></div><div class="line"><div class="line-content">    <span class="ide">walkChunks</span>(<span class="ide">depth</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">walkChunks</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">close</span>()</div></div>  </code></pre>
<p>The library provides a convenient <code>walkChunks()</code> iterator that does
effectively the same thing but without recursion. It can also traverse
subtrees and use any node as the starting point.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">strutils</span></div></div><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">riff</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">r</span> <span class="op">=</span> <span class="ide">openRiffFile</span>(<span class="str">&quot;test.grm&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">for</span> <span class="ide">ci</span> <span class="kwd">in</span> <span class="ide">r</span><span class="op">.</span><span class="ide">walkChunks</span>():</div></div><div class="line"><div class="line-content">  <span class="ide">echo</span> <span class="str">&quot; &quot;</span><span class="op">.</span><span class="ide">repeat</span>((<span class="ide">r</span><span class="op">.</span><span class="ide">cursor</span><span class="op">.</span><span class="ide">path</span><span class="op">.</span><span class="ide">len</span><span class="op">-</span><span class="num">1</span>) <span class="op">*</span> <span class="num">2</span>), <span class="ide">ci</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">close</span>()</div></div>  </code></pre>
<p>Example output (<a href="/johnnovak/gridmonger">Gridmonger</a> map file):</p>
<pre>  <code>(id: &quot;RIFF&quot;, size: 5582, filePos: 0, kind: ckGroup, formatTypeId: &quot;GRMM&quot;)
  (id: &quot;map &quot;, size: 23, filePos: 12, kind: ckChunk)
  (id: &quot;LIST&quot;, size: 5508, filePos: 44, kind: ckGroup, formatTypeId: &quot;lvls&quot;)
    (id: &quot;LIST&quot;, size: 5496, filePos: 56, kind: ckGroup, formatTypeId: &quot;lvl &quot;)
      (id: &quot;prop&quot;, size: 20, filePos: 68, kind: ckChunk)
      (id: &quot;cell&quot;, size: 5445, filePos: 96, kind: ckChunk)
      (id: &quot;note&quot;, size: 2, filePos: 5550, kind: ckChunk)
  (id: &quot;lnks&quot;, size: 2, filePos: 5560, kind: ckChunk)
  (id: &quot;disp&quot;, size: 11, filePos: 5570, kind: ckChunk)
</code></pre>
<h4>Reading chunk data</h4>
<p>You can think of the current chunk as a virtual file; when you enter a chunk,
the &quot;virtual file position&quot;, or <em>chunk position</em>, is set to the start of the
chunk data, which is the first byte after the chunk headers.  This is chunk
position <code>0</code>.</p>
<p>You can query the current chunk position with <code>getChunkPos()</code> and set it with
<code>setChunkPos()</code>, which works similarly to <code>setFilePosition()</code> from the
standard <code>io</code> library. An error will be raised if you try to set the position
beyond the limits of the chunk.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">pos</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">getChunkPos</span>()</div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">setChunkPos</span>(<span class="num">20</span>, <span class="ide">cspSet</span>)   <span class="com"># valid values are: cspSet, cspCur, cspEnd</span></div></div>  </code></pre>
<p>You can read the chunk data with the various <code>read*()</code> methods as shown below.
An error will be raised if you attempt to read past the end of the chunk.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="com"># To read a specific numeric type, pass in its type as an argument</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">i8</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">read</span>(<span class="ide">uint8</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">f32</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">read</span>(<span class="ide">float32</span>)</div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">i64</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">read</span>(<span class="ide">int64</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># Reading multiple values into a buffer</span></div></div><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">buf</span>: <span class="ide">array</span>[<span class="num">100</span>, <span class="ide">float</span>]</div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">read</span>(<span class="ide">buf</span>, <span class="ide">startIndex</span><span class="op">=</span><span class="num">0</span>, <span class="ide">numValues</span><span class="op">=</span><span class="ide">buf</span><span class="op">.</span><span class="ide">len</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readChar</span>()          <span class="com"># read a char</span></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readFourCC</span>()        <span class="com"># read a FourCC as a string</span></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readStr</span>(<span class="ide">length</span><span class="op">=</span><span class="num">10</span>)  <span class="com"># read the next 10 bytes as a string</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readBStr</span>()    <span class="com"># read a Pascal-style string (one `length` leading</span></div></div><div class="line"><div class="line-content">                <span class="com"># byte followed by `length` bytes of character data)</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readWStr</span>()    <span class="com"># read a Pascal-style string</span></div></div><div class="line"><div class="line-content">                <span class="com"># (16-bit (word) leading `length` value)</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readZStr</span>()    <span class="com"># read a C-style null-terminated string</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readBZStr</span>()   <span class="com"># read a Pascal-style string (byte `length`) that is also</span></div></div><div class="line"><div class="line-content">                <span class="com"># null-terminated</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">readWZStr</span>()   <span class="com"># read a Pascal-style string (16-bit `length`) that is also</span></div></div><div class="line"><div class="line-content">                <span class="com"># null-terminated</span></div></div>  </code></pre>
<h4>Cursors</h4>
<p>It is possible to save the current chunk and chunk position as a <code>Cursor</code>
and restore it later.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">cur</span> <span class="op">=</span> <span class="ide">r</span><span class="op">.</span><span class="ide">cursor</span>    <span class="com"># store the current cursor</span></div></div><div class="line"><div class="line-content"><span class="ide">r</span><span class="op">.</span><span class="ide">cursor</span> <span class="op">=</span> <span class="ide">cur</span>        <span class="com"># restore a cursor</span></div></div>  </code></pre>
<p>The <code>Cursor</code> object has the following fields:</p>
<ul>
<li>
<p><code>path</code> <em>seq[ChunkInfo]</em> â€“ path to this chunk in the RIFF tree (the last
element is this chunk, the rest are the parents, right up to the root RIFF
chunk which is the first element)</p>
</li>
<li>
<p><code>chunkPos</code> <em>uint32</em> â€“ chunk position from the start of the chunk data</p>
</li>
<li>
<p><code>filePos</code> <em>int64</em> â€“ absolute file position from the start of the file</p>
</li>
</ul>
<p>A typical usage pattern is to walk through all the
chunks in the file in the first pass, store cursors pointing to the chunks
of interest, and then read from those chunks in the second pass using the
cursors.</p>
<h3>Writing RIFF files</h3>
<h4>Creating a file</h4>
<p>You can create a new RIFF file with the <code>createRiffFile()</code> method.  This will
create a <code>RiffWriter</code> object on success, or raise a <code>RiffWriterError</code> if
something went wrong (just like all writer methods in case of an error).
You can also optionally set the endianness of the file (default is
little-endian) or override the default buffer size.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">var</span> <span class="ide">w</span>: <span class="ide">RiffWriter</span></div></div><div class="line"><div class="line-content"><span class="ide">w</span> <span class="op">=</span> <span class="ide">createRiffFile</span>(<span class="ide">filename</span>, <span class="str">&quot;GRMM&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span> <span class="op">=</span> <span class="ide">createRiffFile</span>(<span class="ide">filename</span>, <span class="str">&quot;GRMM&quot;</span>, <span class="ide">endian</span><span class="op">=</span><span class="ide">littleEndian</span>, <span class="ide">bufSize</span><span class="op">=</span><span class="num">8192</span>)</div></div>  </code></pre>
<p>When you&apos;re done writing to the RIFF file, you must call the <code>close()</code> method.</p>
<p>:warning: <em>Calling <code>close()</code> is very important because this ensures that the
total file size in the root RIFF chunk is updated correctly! It also closes
all currently open chunks recursively, making sure their headers are updated
as well.</em></p>
<h4>Creating chunks</h4>
<p>You can create chunks or list chunks with the <code>beginChunk()</code> and
<code>beginListChunk()</code> methods, respectively. The chunk ID (or format type ID in
case of list chunks) needs to be passed in.</p>
<p>Calling <code>endChunk()</code> closes the current chunk and writes the final chunk size
to its header.</p>
<p>The <code>close()</code> method closes all currently open chunks recursively.</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">beginListChunk</span>(<span class="str">&quot;lvls&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">beginChunk</span>(<span class="str">&quot;cell&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># ... write chunk data ...</span></div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">endChunk</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">beginChunk</span>(<span class="str">&quot;prop&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># ... write chunk data ...</span></div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">endChunk</span>()</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">endChunk</span>() <span class="com"># end of &apos;lvls&apos; list chunk</span></div></div>  </code></pre>
<h4>Writing chunk data</h4>
<p>Writing values works analogously to the <code>read*()</code> methods:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">write</span>(<span class="num">42&apos;</span><span class="ide">u8</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">write</span>(<span class="op">-</span><span class="num">8765&apos;i16</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">write</span>(<span class="num">1234.567&apos;f64</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeChar</span>('!')</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeFourCC</span>(<span class="str">&quot;ILBM&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeStr</span>(<span class="str">&quot;Guybrush Threepwood&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeBStr</span>(<span class="str">&quot;Mancomb Seepgood&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeWStr</span>(<span class="str">&quot;Elaine Marley&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeZStr</span>(<span class="str">&quot;Herman Toothrot&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeBZStr</span>(<span class="str">&quot;Men of Low Moral Fiber&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="ide">w</span><span class="op">.</span><span class="ide">writeWZStr</span>(<span class="str">&quot;Voodoo Lady&quot;</span>)</div></div>  </code></pre>
<h2>References &amp; reading materials</h2>
<p>[1] &quot;EA IFF 85&quot; Standard for Interchange Format Files<br />
<em>Electronic Arts, 1985</em><br />
https://wiki.amigaos.net/wiki/EA_IFF_85_Standard_for_Interchange_Format_Files
http://www.martinreddy.net/gfx/2d/IFF.txt</p>
<p>[2] A Quick Introduction to IFF<br />
<em>AmigaOS Documentation Wiki</em><br />
https://wiki.amigaos.net/wiki/A_Quick_Introduction_to_IFF</p>
<p>[3] Resource Interchange File Format<br />
<em>Wikipedia</em><br />
https://en.wikipedia.org/wiki/Resource_Interchange_File_Format</p>
<p>[4] RIFF (Resource Interchange File Format)<br />
<em>Digital Preservation. Library of Congress</em><br />
https://www.loc.gov/preservation/digital/formats/fdd/fdd000025.shtml</p>
<p>[5] Multimedia Programming Interface and Data Specifications 1.0<br />
<em>Microsoft / IBM, August 1991</em><br />
http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/Docs/riffmci.pdf</p>
<p>[6] Multimedia Data Standards Update<br />
<em>Microsoft, April 1994</em><br />
http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/Docs/RIFFNEW.pdf</p>
<p>[7] Exiftool - Riff Info Tags<br />
<em>ExifTool website</em><br />
https://exiftool.org/TagNames/RIFF.html#Info</p>
<p>[8] Exchangeable image file format for digital still cameras, Exif Version 2.32<br />
<em>Camera &amp; Imaging Products Association, May 2019</em><br />
http://www.cipa.jp/std/documents/e/DC-X008-Translation-2019-E.pdf</p>
<p>[9] Audio Interchange File Format: &quot;AIFF&quot;, Version 1.3<br />
<em>Apple, January 1989</em><br />
http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/AIFF/Docs/AIFF-1.3.pdf</p>
<p>[10] AVI RIFF File Reference<br />
<em>Microsoft Dev Center, May 2018</em><br />
https://docs.microsoft.com/en-us/windows/win32/directshow/avi-riff-file-reference</p>
<h2>License</h2>
<p>Copyright Â© 2019-2021 John Novak &lt;<a href="mailto:john@johnnovak.net">john@johnnovak.net</a>&gt;</p>
<p>This work is free. You can redistribute it and/or modify it under the terms of
the <a href="http://www.wtfpl.net/">Do What The Fuck You Want To Public License, Version 2</a>, as published
by Sam Hocevar. See the <a href="./COPYING">COPYING</a> file for more details.</p>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        WTFPL
                    </p>
                

                
                    <p> <a href="https://github.com/johnnovak/nim-riff">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-09-27T01:08:27Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
