<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nim Package Directory</title>
  <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="New and updated Nim packages" href="https://nimble.directory/packages.xml">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlite.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script type="text/javascript" src="/js/app.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top py-3">
  <div class="container">
    <a href="/" class="logo fw-500 display-1 text-black text-decoration-none navbar-brand"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a href="https://nim-lang.org/" class="nav-link">What's Nim?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="/about.html" class="nav-link">What's Nimble?</a>
        </li>
        <li class="nav-item mx-2">
          <a href="https://github.com/nim-lang/packages/" class="nav-link">Publish your package</a>
        </li>
        <!-- TODO: replace with something different -->
        <li class="nav-item ms-3">
          <a class="nav-link" href="https://www.youtube.com/channel/UCDAYn_VFt0VisL5-1a5Dk7Q/">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
          </a>
        </li>
        <li class="nav-item ms-3">
          <a class="nav-link theme-switcher-btn" id="darkmode" onclick="toggle_dark_mode()" href="#">
            <span id="light-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </span>
            <span id="dark-mode-icon">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="content">
  <div class="container">
    <div class="container pt-10">
        <h3 class="mb-3 fw-bold display-6 pt-4">migrate</h3>
        <p class="tags">
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">migrate</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">database</button></a>
                </span>
            
                <span class="tag">
                    <button class="btn-tag pkg-btn-tag">db</button></a>
                </span>
            
        </p>
        <p class="pkg-desc">some("A simple database migration utility for Nim.")</p>
        <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');"
            alt="Copy on clipboard">
            <i class="fa fa-copy"></i>
        </a>
        <input id="cmd" onclick="this.select();" value="nimble install migrate" readonly="">
        <br>
        <small style="font-size: 0.8rem;">Need help? Read <a
                href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small>
    </div>

    <div class="container row pt-4" id="pkg-content">
        <div class="col-8 box rounded p-3" id="readme-section">
            
                <document><h1>migrate.nim</h1>
<p>A simple database migration utility for Nim.</p>
<p>Database migrations let you easily manage the state of your SQL database, tracking and automating the applying of changes.</p>
<p>This package is available as both a library and a command line application, with very similar interfaces.</p>
<p>This package currently only supports MySQL and is fairly opinionated about how things should work, with migrations consisting of two files, both of which are prefixed with the current timestamp. These files (<code>xxx.up.sql</code> and <code>xxx.down.sql</code>) describe the process to run a migration, and to then later revert that migration.</p>
<p>Unfortunately, this package currently only supports MySQL, but patches for other database engines are very welcome!</p>
<h2>Installation</h2>
<h3>CLI Application</h3>
<p>The command line application can be installed either by downloading one of the prebuilt releases, or by compiling it yourself. Compilation requires <a href="http://nim-lang.org">Nim</a> and <a href="https://github.com/nim-lang/nimble">Nimble</a>, as well as the required support DLLS for MySQL.</p>
<pre>  <code>git clone https://github.com/euantorano/migrate.nim.git
cd migrate.nim
nimble build
</code></pre>
<p>This will build a single executable, <code>migrate</code> which can then be placed in your <code>PATH</code>.</p>
<h3>Package</h3>
<p>The package can be installed via Nimble, by simply requiring it in your project&apos;s <code>.nimble</code> file:</p>
<pre>  <code># Dependencies

requires &quot;migrate &gt;= 1.0.0&quot;
</code></pre>
<p>It can also be installed by running <code>nimble install migrate</code>.</p>
<h2>Usage</h2>
<h3>CLI Application</h3>
<p>The first step to using the command line application is to create a new migration:</p>
<pre>  <code>$ ./migrate new create_a_table --path=./migrations
INFO Created migration files: /home/euan/migrate.nim/migrations/1466067778_create_a_table.up.sql and /home/euan/migrate.nim/migrations/1466067778_create_a_table.down.sql
</code></pre>
<p>You can then edit the two newly created files with the required code to apply and revert your migration. Once done, you can apply your migration:</p>
<pre>  <code>$ ./migrate.exe up mysql://root@localhost/test --path=./migrations
DEBUG Calculating up migrations to run
DEBUG Found 0 already ran migrations
DEBUG Got 1 files to run: {1466067778_create_a_table.up.sql}
DEBUG Running migration: 1466067778_create_a_table.up.sql
INFO Ran 1 migrations, with batch number: 1
</code></pre>
<p>Note the string <code>mysql://root@localhost/test</code> - this is the connection string for your database that you wish to apply your migrations to. It takes the form of <code>&lt;protocol&gt;://&lt;username&gt;[:&lt;password&gt;]@&lt;server&gt;[:&lt;port&gt;]/&lt;database&gt;</code>.</p>
<p>To later revert a migration, you can simply run the <code>down</code> command:</p>
<pre>  <code>$ ./migrate.exe down mysql://root@localhost/test --path=./migrations
DEBUG Calculating down migrations to run for batch number 1
DEBUG Found migration to revert: 1466067778_create_a_table.up.sql
DEBUG Running down migration: /home/euan/migrate.nim/migrations/1466067778_create_a_table.down.sql
INFO Reverted 1 migrations, with batch number: 1
</code></pre>
<p>If you want to completely revert all ran migrations, you can do so using the <code>clean</code> command:</p>
<pre>  <code>$ ./migrate.exe clean mysql://root@localhost/test --path=./migrations
DEBUG Calculating down migrations to run
DEBUG Found migration to revert: 1466065177_create_euan_test_table.up.sql
DEBUG Running down migration: /home/euan/migrate.nim/migrations/1466065177_create_euan_test_table.down.sql
DEBUG Found migration to revert: 1466066603_create_another_table.up.sql
DEBUG Running down migration: /home/euan/migrate.nim/migrations/1466066603_create_another_table.down.sql
DEBUG Found migration to revert: 1466067184_create_another_table_2.up.sql
DEBUG Running down migration: /home/euan/migrate.nim/migrations/1466067184_create_another_table_2.down.sql
DEBUG Found migration to revert: 1466067778_create_a_table.up.sql
DEBUG Running down migration: /home/euan/migrate.nim/migrations/1466067778_create_a_table.down.sql
INFO Reverted all ran migrations, 4 migrations undone
</code></pre>
<h3>Package</h3>
<p>The migrate package revolves primary around a single object, the <code>Migrator</code>:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">import</span> <span class="ide">migrate</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="com"># The path which migration files reside under.</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">migrationsPath</span> <span class="op">=</span> <span class="str">&quot;./migrations&quot;</span></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">connectionSettings</span> <span class="op">=</span> <span class="ide">ConnectionSettings</span>(<span class="ide">connectionType</span>: <span class="ide">ConnectionType</span><span class="op">.</span><span class="ide">mysql</span>, <span class="ide">server</span>: <span class="str">&quot;localhost&quot;</span>, <span class="ide">username</span>: <span class="str">&quot;root&quot;</span>, <span class="ide">password</span>: <span class="str">&quot;&quot;</span>, <span class="ide">db</span>: <span class="str">&quot;test&quot;</span>)</div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">migrator</span> <span class="op">=</span> <span class="ide">initMigrator</span>(<span class="ide">migrationsPath</span>, <span class="ide">connectionSettings</span>)</div></div>  </code></pre>
<p>You can then create migrations, run them, revert them and clean them:</p>
<pre>  <code class="language-nim"><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">createdMigration</span> <span class="op">=</span> <span class="ide">migrator</span><span class="op">.</span><span class="ide">createMigration</span>(<span class="str">&quot;create_a_table&quot;</span>)</div></div><div class="line"><div class="line-content"><span class="com"># createdMigration is a tuple of up and down strings, pointing to the created file paths</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">upResult</span> <span class="op">=</span> <span class="ide">migrator</span><span class="op">.</span><span class="ide">up</span>()</div></div><div class="line"><div class="line-content"><span class="com"># upResult is a tuple of the number of ran migrations and the batch number</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">downResult</span> <span class="op">=</span> <span class="ide">migrator</span><span class="op">.</span><span class="ide">down</span>()</div></div><div class="line"><div class="line-content"><span class="com"># downResult is a tuple of the number of reverted migrations and the batch number that was reverted</span></div></div><div class="line"><div class="line-content"></div></div><div class="line"><div class="line-content"><span class="kwd">let</span> <span class="ide">cleanResult</span> <span class="op">=</span> <span class="ide">migrator</span><span class="op">.</span><span class="ide">clean</span>()</div></div><div class="line"><div class="line-content"><span class="com"># cleanResult is a tuple of the number of reverted migrations, and the batch number which is always 0</span></div></div>  </code></pre>
<h2>TODO List</h2>
<ul>
<li>[x] Create migrations, run them, revert them and clean them</li>
<li>[x] MySQL driver to work with MySQL databases</li>
<li>[x] Generator to generate migration files from existing databases</li>
<li>[ ] Drivers for other database engines, including SQLite and PostgreSQL</li>
</ul>
</document>
            
        </div>
        <div class="col-3" id="meta-section">
            <div class="container box rounded p-3">
                
                    <p>
                        <strong>Licence:</strong>
                        BSD3
                    </p>
                

                
                    <p> <a href="https://github.com/euantorano/migrate.nim">Project website</a> </p>
                

                
            </div>
        </div>
    </div>
</div>
</div>

<footer class="pt-10 px-3">
  <div class="container pt-4">
    <div class="row mb-4">
      <div class="col-lg-3">
        <h4 class="h5">Getting started with Nim</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://learnxinyminutes.com/docs/nim/">Learn Nim in 5 minutes</a></li>
          <li><a class="text-decoration-none" href="https://nim-by-example.github.io/">Nim by Example</a></li>
          <li><a class="text-decoration-none" href="https://play.nim-lang.org/">Official Playground</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Official Tutorials</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut1.html">General Tutorial</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut2.html">Advanced Features</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tut3.html">Macros and Metaprogramming</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Nim for...</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-C-programmers">C programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-Python-Programmers">Python programmers</a></li>
          <li><a class="text-decoration-none" href="https://github.com/nim-lang/Nim/wiki/Nim-for-TypeScript-Programmers">TypeScript programmers</a></li>
        </ul>
      </div>
      <div class="col-lg-3">
        <h4 class="h5">Documentation</h4>
        <ul>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/lib.html">Standard Library</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/manual.html">Language Manual</a></li>
          <li><a class="text-decoration-none" href="https://nim-lang.org/docs/tools.html">Tools Documentation</a></li>
        </ul>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12 text-center mt-4 mx-auto">
        <a href="#" class="d-block mb-3 mx-auto bw"></a>
        <p class="text-muted">
        Created in <a href="https://nim-lang.org/">Nim</a> on <a href="https://pages.github.com/">GitHub Pages</a>.
        <a href="https://github.com/gabbhack/nimidirectory">Available</a>
        under <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License#Version_3">GPLv3</a>
        </p>
        <p class="text-muted">
        Builded at 2023-07-14T01:49:11Z
        </p>
      </div>
    </div>
  </div>
</footer>
<script>
</script>
</body>
</html>
